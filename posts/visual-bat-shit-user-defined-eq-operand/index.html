<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-8HTK24ZVY8');
        }
      </script>
    
  


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"> 
<link rel="stylesheet" type="text/css" href="/css/styles.css?v=0.1.3">
<link rel="stylesheet" href="/css/highlight.css?v=1.0.1">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<script src="/js/main.js?v=0.1.1" defer></script>





    <title>
VBA: Categorizing Bunch of Rows with Bitwise Operators &ndash; dumb by default
</title>
  </head>

  <body>
    <div id="navbar">
  
  <ul class="nav-col">
    
      <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
    
      <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
    
      <li class="nav-item"><a class="nav-link" href="/posts/">Posts</a></li>
    
      <li class="nav-item"><a class="nav-link" href="/resources/">Resources</a></li>
    
  </ul>

  
</div>
    <div class="wrapper">
      
<article>
  <header class="single">
<nav class="crumb">
  <ol style="padding-left: 0;">
    
  
    
  
    
  
  <li class="crumb ">
    
    <a href="/">Home</a>
    
  </li>

  
  <li class="crumb ">
    
    <a href="/posts/">Posts</a>
    
  </li>

  
  <li class="crumb active">
    
    VBA: Categorizing Bunch of Rows with Bitwise Operators
    
  </li>

  </ol>
</nav>



    <h1 class="header-title">VBA: Categorizing Bunch of Rows with Bitwise Operators</h1>
    <pre style="margin: 0;">published-date: 19 Jan 2023 21:12 &#43;0700</pre>
    

     
  <pre style="margin: 0">categories: <a href="http://localhost:1313/categories/code-snippets/">code-snippets</a></pre>

     
  <pre style="margin: 0">tags: <a href="http://localhost:1313/tags/vba/">vba</a></pre>
  

  </header>
  
  <hr>

  <h1 id="synopsis">Synopsis</h1>
<blockquote>
<p>Keep in mind this might be a bad practice!</p>
</blockquote>
<p>I had this problem where I needed to keep track of <em>diffs</em> from two different versions Excel workbooks. Each workbook have bunch if rows in the order of thousands, with 7-8 different parameters to keep an eye on.</p>
<p>To illustrate, imagine this two table of Employees.</p>





<table class="table-default">
<thead>
<tr>
<th>Name</th>
<th>IDNumber</th>
<th>Height</th>
<th>Weight</th>
<th>Cuh</th>
</tr>
</thead>
<tbody>
<tr>
<td>Foo</td>
<td>00420</td>
<td>120</td>
<td>128</td>
<td>No</td>
</tr>
<tr>
<td>Bar</td>
<td>00069</td>
<td>180</td>
<td>72</td>
<td>No</td>
</tr>
<tr>
<td>Baz</td>
<td>01337</td>
<td>72</td>
<td>40</td>
<td>Yes</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
</tbody>
</table>






<table class="table-default">
<thead>
<tr>
<th>Name</th>
<th>IDNumber</th>
<th>Height</th>
<th>Weight</th>
<th>Cuh</th>
</tr>
</thead>
<tbody>
<tr>
<td>Foo</td>
<td>00420</td>
<td>121</td>
<td>127</td>
<td>No</td>
</tr>
<tr>
<td>Bar</td>
<td>00069</td>
<td>179</td>
<td>72</td>
<td>No</td>
</tr>
<tr>
<td>Fuzz</td>
<td>01336</td>
<td>72</td>
<td>45</td>
<td>No</td>
</tr>
<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>
</tbody>
</table>

<p>Simple enough, right? The caveat comes when:</p>
<ul>
<li>You need to report on <em>which row and column the changes happened</em> and point out the row <em>why it happened</em>.</li>
<li>Some changes is ignored or combined altogether for specific reason or among other thing. For example if both <code>height</code> and <code>weight</code> changes, then it would be alright.</li>
<li>As an added bonus, this diff searching program also need to detect <em>dupes</em>!</li>
</ul>
<p>In this case you might think using <code>HLOOKUP</code>s with <code>IF</code>s or <code>SWITCH</code>es coupled with <code>COUNTIFS</code>s is more than enough (And you&rsquo;re right!). Or if you&rsquo;re a sadist, you might implement Myers into your program. But I&rsquo;ve found a way to collate this comparison categorization by transforming resulting comparison as bytes of an integer.</p>
<h1 id="serialization-of-rows">Serialization of Rows</h1>
<p>On thing to note, again, is the rows of both table needed to be iterated <em>twice</em> to find duplicates. Problem being accessing cell values from VBA can be very slow, at least that I&rsquo;m aware of. The better way is to compare both table is to turn each row in a form of an object instance then put this objects inside an <code>Array</code> or <code>Collection</code> where we can iterate each items.</p>
<h1 id="del">Del</h1>
<p>create <code>User-Defined Type</code> in VBA to store and access, in this case, <code>Employee</code> properties as sets of variables.</p>
<p>Why? Initially everything is stored as a range of cells from sets of columns, which is annoying to debug since access to property is as per index basis just like searching values using <code>VLOOKUP</code>. My goal is to store these items as array of type/instances, where theoretically it&rsquo;d have much smaller size in ram using primitives like <code>Single</code> or <code>Integer</code> instead of default value <code>String</code> or <code>Variant</code> at runtime.</p>
<p>The proper way would be using a class module and utilize set-get method from class instance to containerize these properties alongside some operand overloads. Which in the case I was doing, a little bit overkill.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vb.net" data-lang="vb.net"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Type</span> <span class="n">MyEmployee</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">empName</span> <span class="ow">As</span> <span class="kt">String</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">empNumber</span> <span class="ow">As</span> <span class="kt">String</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">empHeight</span> <span class="ow">As</span> <span class="kt">Integer</span> 
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="n">empWeight</span> <span class="ow">As</span> <span class="kt">Long</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">End</span> <span class="n">Type</span>
</span></span></code></pre></div><p>Defining a <code>type</code> is quite different than <code>struct</code> in other statically typed languages such as C or TypeScript.</p>

</article>

    </div>
    <div id="footer">
  <div style="display: flex; justify-content: center;">
    <small>Built with <a a target="_blank" class="extern" href="https://gohugo.io/">Hugo</a> | previoip &copy;2022</small>
  </div>
</div>
  </body>
</html>


