<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HTK24ZVY8")}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="/css/highlight.css?v=1.0.0"><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}a{color:#2d6ed7;text-decoration:underline}a:hover{color:#104db0;text-decoration:none}a:active{color:#2d6ed7;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--tx-c-tp-primary-quarter);border-radius:3px}::-webkit-scrollbar-thumb{background:var(--tx-c-primary-half);border-radius:3px}</style><title>How I Built A Simple (Horrible) 3D Graphics Engine in python matplotlib - Part 5: Afterword &ndash; dumb by default</title></head><body><div style=background-color:#69696969><br><h1 class=tc>dumb by default</h1><nav class=tc>[<a href=/>Home</a>]&nbsp;[<a href=/about/>About</a>]&nbsp;[<a href=/posts/>Posts</a>]&nbsp;[<a href=/resources/>Resources</a>]&nbsp;</nav><hr></div><p style=padding:0><span>dir: <i><a href=/>Home</a> /
<a href=/posts/>Posts</a> /
<span>How I Built A Simple (Horrible) 3D Graphics â€¦</span></i></span><br><span>published-date: 18 Feb 2023 16:58 +0700</span><br><span>categories: [<a href=http://previoip.github.io/categories/dumber-day-by-day/>dumber-day-by-day</a>] [<a href=http://previoip.github.io/categories/python-hijinks/>python-hijinks</a>]</span><br><span>tags: [<a href=http://previoip.github.io/tags/python/>python</a>] [<a href=http://previoip.github.io/tags/matplotlib/>matplotlib</a>]</span><br></p><h1 class=tc>How I Built A Simple (Horrible) 3D Graphics Engine in python matplotlib - Part 5: Afterword</h1><hr><div><h3 id=posts-in-this-series>Posts in This Series</h3><ul><li><a href=../../posts/building-3d-graphic-engine-in-matplotlib/>Part 1 - Intro</a></li><li><a href=../../posts/building-3d-graphic-engine-in-matplotlib-2/>Part 2 - Plotting with plt</a></li><li><a href=../../posts/building-3d-graphic-engine-in-matplotlib-3/>Part 3 - Square but 3D</a></li><li><a href=../../posts/building-3d-graphic-engine-in-matplotlib-4/>Part 4 - Speen!</a></li><li><a href=../../posts/building-3d-graphic-engine-in-matplotlib-5/>Afterword</a></li></ul><hr><p>There will be long texts below. If you to play around with the code I used to generate the graphics in this blog, then the link is as follows. I&rsquo;ve modified it a little bit so hopefully it&rsquo;d be easier to read.</p><h6 id=colab-notebookhttpscolabresearchgooglecomdrive1wjeuohgh0myldvg2zkni0orvzd5tiqfzuspsharing><a target=_blank class=extern href="https://colab.research.google.com/drive/1wJEuoHGh0mYLdVG2zknI0oRVZd5TiqFZ?usp=sharing">Colab Notebook</a></h6><p>Without further ado, there are few things I want to clarify.</p><h1 id=why-is-it-terrible-though class=tc>Why is it terrible though?</h1><img src=./images/Figure_1.gif alt="Figure 1"><p>I&rsquo;ll be honest, this way of doing 3D graphics is not very practical. One of the main reason why I did that in my previous job was the limitation on what I can use at the time, where colabs came in my mind since it was the only IDE environment coupled with interpreter that was <em>not</em> blocked by company&rsquo;s proxy. During making of the proposal I need some visualization but I could not work with 3D modelling software (i.e Blender) unless I bring my own laptop to the workflow, which was a no go.</p><p>There are few limitation in the &ldquo;library&rdquo; i made, which is z-buffering. It would be possible to render object on the top of another object by simply carefully putting each <code>ax.plot( ... )</code> in ordered fashion, but it would be bad in the long run of you have a lot of objects. I believe it is actually possible to implement such thing, but for my purposes and the timeframe the project was given, it was not feasible. Not to mention a whole lot of other functionalities that was not implemented, like poly, faces, shaders, UV mapping, to name a few.</p><p>There are one aspect from the source code you can open in the first post which I didn&rsquo;t cover in the posts, which is &ldquo;archaic&rdquo; vertex grouping. It works by splicing the vertex buffer/array with a known length, treating the array as memory. Another array stores the &ldquo;pointer&rdquo; and the length of the vertex group (in this case cube has 8 verts). Imagine in C you&rsquo;re pointing into memory then fetching the values based on the sizeof(vertex) * n. There are better ways but this is simple enough for me to go wild writing the aforementioned code.</p><h1 id=can-i-import-vertices-from-blender class=tc>Can I import vertices from Blender?</h1><img src=./images/Figure_2.gif alt="Figure 2"><p>Importing verts from Blender can be done by plugging this simple script into Blender&rsquo;s script tab then run the script. In this case is just exporting vert coordinates into csv format. Be careful of vert/poly count though.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=kn>import</span> <span class=nn>bpy</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=n>obj_name</span> <span class=o>=</span> <span class=s1>&#39;Cube&#39;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=n>export_path</span> <span class=o>=</span> <span class=s1>&#39;C:/tmp/mesh_verts&#39;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=n>delimiter</span> <span class=o>=</span> <span class=s1>&#39;;&#39;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>def</span> <span class=nf>get_vert_as_list</span><span class=p>(</span><span class=n>obj</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=c1># this one get the coordinates straight from the vert</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=n>temp</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=k>for</span> <span class=n>vert</span> <span class=ow>in</span> <span class=n>obj</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>vertices</span><span class=p>:</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=n>temp</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>vert</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=k>return</span> <span class=n>temp</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=k>def</span> <span class=nf>get_vert_as_tris_list</span><span class=p>(</span><span class=n>obj</span><span class=p>):</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=c1># this method loops over tris of the mesh faces</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=n>temp</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=c1># calcs tris</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=n>obj</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>calc_loop_triangles</span><span class=p>()</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>
</span></span><span class=line><span class=ln>22</span><span class=cl>  <span class=c1># loop over vertices with tri_n as index</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>  <span class=k>for</span> <span class=n>tris</span> <span class=ow>in</span> <span class=n>obj</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>loop_triangles</span><span class=p>:</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=k>for</span> <span class=n>tri_n</span> <span class=ow>in</span> <span class=n>tris</span><span class=o>.</span><span class=n>vertices</span><span class=p>:</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>      <span class=n>temp</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>obj</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>vertices</span><span class=p>[</span><span class=n>tri_n</span><span class=p>])</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>  <span class=k>return</span> <span class=n>temp</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=c1># you can use your own method on getting the desired object</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=n>obj_target</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>name</span><span class=o>==</span><span class=n>obj_name</span><span class=p>,</span> <span class=n>bpy</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>objects</span><span class=p>))</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>  <span class=k>if</span> <span class=ow>not</span> <span class=n>obj_target</span><span class=p>:</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Object </span><span class=se>\&#34;</span><span class=si>{</span><span class=n>obj_name</span><span class=si>}</span><span class=se>\&#34;</span><span class=s1> is not found.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=n>obj_target</span> <span class=o>=</span> <span class=n>obj_target</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>
</span></span><span class=line><span class=ln>40</span><span class=cl>  <span class=c1># convert into list using one of our function above  </span>
</span></span><span class=line><span class=ln>41</span><span class=cl>  <span class=n>verts</span> <span class=o>=</span> <span class=n>get_vert_as_list</span><span class=p>(</span><span class=n>obj_target</span><span class=p>)</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  
</span></span><span class=line><span class=ln>43</span><span class=cl>  <span class=c1># you can export in any format you like. In this case its just a semicolon delimited txt file.</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>  <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>export_path</span> <span class=o>+</span> <span class=s1>&#39;.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fp</span><span class=p>:</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=k>for</span> <span class=n>vert</span> <span class=ow>in</span> <span class=n>verts</span><span class=p>:</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>      <span class=n>fp</span><span class=o>.</span><span class=n>writelines</span><span class=p>(</span><span class=n>delimiter</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=p>[</span><span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>vert</span><span class=o>.</span><span class=n>co</span><span class=p>])))</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>      <span class=n>fp</span><span class=o>.</span><span class=n>writelines</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>
</span></span><span class=line><span class=ln>49</span><span class=cl>
</span></span><span class=line><span class=ln>50</span><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>  <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>Now you can unpack this txt file into numpy array on your colab (once you upload the txt file of course). You can get my exported txt file <a href=./resources/mesh_verts.txt>here</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=k>def</span> <span class=nf>unpack_txt</span><span class=p>(</span><span class=n>fpath</span><span class=p>,</span> <span class=n>delim</span><span class=o>=</span><span class=s1>&#39;;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>fpath</span><span class=p>)</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>fpath</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=n>temp</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>fpath</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fp</span><span class=p>:</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>fp</span><span class=o>.</span><span class=n>readlines</span><span class=p>():</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>      <span class=c1># you can use float instead, whatever floats your boat (HAHAHAHAHAH GOTEM)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>      <span class=n>temp</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>,</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>delim</span><span class=p>)))</span> <span class=o>+</span> <span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>temp</span><span class=p>)</span>
</span></span></code></pre></div><p>Then you can unpack the txt just like so.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fpath</span> <span class=o>=</span> <span class=s1>&#39;mesh_verts.txt&#39;</span>
</span></span><span class=line><span class=cl><span class=n>imported_vert</span> <span class=o>=</span> <span class=n>unpack_txt</span><span class=p>(</span><span class=n>fpath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>imported_vert</span><span class=o>.</span><span class=n>any</span><span class=p>():</span>
</span></span><span class=line><span class=cl>  <span class=n>wireframes</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>((</span><span class=n>wireframes</span><span class=p>,</span> <span class=n>imported_vert</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></div><h1 id=so-whats-next class=tc>So what&rsquo;s next?</h1><img src=images/noiath.gif alt=me><p>idk honestly. I have Power Query stuff I want to share probably I&rsquo;ll stick with that. Along with Visual Basic stuff I have in my backlog. These posts are fun to tinker with albeit my poor writing skills. Hopefully that will change in the future.</p><h1 id=what-about-ffmpeg-stuff-you-mentioned class=tc>What about ffmpeg stuff you mentioned?</h1><p>Ah, here&rsquo;s a quick pics-to-gif snippet that doesn&rsquo;t jank. I had difficulty with jittering initially, but <code>-filter_complex</code> with a lot of stack overflow browsing comes this monstrosity.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ffmpeg -f image2 -i <span class=s2>&#34;frame_%03d.png&#34;</span> -r <span class=m>30</span> -filter_complex <span class=s2>&#34;crop=iw-150:ih-150,fps=30,scale=480:-1:flags=lanczos,split[s0][s1];[s0]palettegen=max_colors=16[p];[s1][p]paletteuse=dither=bayer&#34;</span> result.gif
</span></span></code></pre></div><p>Mind the file suffix though, in this case frames filenames are made in such a way there will always prepend with 3 digits of leading zeroes.</p><p>Also <code>-r 30</code> flag is redundant, since its already described in the filter argument.</p><p>glhf!</p></div><br><br><br><br><p class=tc>Built with <a a target=_blank class=extern href=https://gohugo.io/>Hugo</a> | previoip (c) 2024</p></body></html>