<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HTK24ZVY8")}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="/css/highlight.css?v=1.0.0"><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><style>:root{--f:1.2em;--w:30}html{margin:0 2em;padding:0 var(--f);max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}*{font-size:inherit}p{line-height:calc(var(--f)*1.2);padding-left:calc(var(--f)*1.6)}a{color:#4079d5;text-decoration:underline}a:hover{color:#1c6be9;text-decoration:none}a:active{color:#2555a1;text-decoration:none;background-color:var(--tx-c-hover)}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(calc(100vw - var(--f) * 2),calc(var(--f)*var(--w)));min-width:200px}code:not([class]){background-color:#4d4f500f;padding:.1em .4rem;border-radius:.2rem}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--tx-c-tp-primary-quarter);border-radius:3px}::-webkit-scrollbar-thumb{background:var(--tx-c-primary-half);border-radius:3px}</style><title>powershell - Merge CSVs &ndash; dumb by default</title></head><body><div style=background-color:#d5d5d569><br><h1 class=tc>dumb by default</h1><nav class=tc>[<a href=/>Home</a>]&nbsp;[<a href=/about/>About</a>]&nbsp;[<a href=/posts/>Posts</a>]&nbsp;[<a href=/resources/>Resources</a>]&nbsp;</nav><hr></div><p style=padding:0><span>dir: <i><a href=/>Home</a> /
<a href=/posts/>Posts</a> /
<span>powershell - Merge CSVs</span></i></span><br><span>published-date: 02 Feb 2023 19:45 +0700</span><br><span>categories: [<a href=http://previoip.github.io/categories/dumber-day-by-day/>dumber-day-by-day</a>] [<a href=http://previoip.github.io/categories/snippets/>snippets</a>]</span><br><span>tags: [<a href=http://previoip.github.io/tags/powershell/>powershell</a>]</span><br></p><h1 class=tc>powershell - Merge CSVs</h1><hr><h1 id=preface class=tc>Preface</h1><p>CSV is a tabular data exchange format and is used <em>dangerously</em> <strong>extensively</strong> by data scientists, engineers, or analyst alike. Looking at the wiki, its feature is actually quite limited as a format for exchanging tabular data in plain-text. There are various alternatives such as to <code>xml</code> which supports schema, <code>json</code> with their inherit javascript object semantics, and various other formats which I don&rsquo;t mention because I&rsquo;m too tired of writing preface just to fill the post summary and is just hunk of bs at this point. sorry.</p><p>There might be times where you&rsquo;d need to join bunch of csv fils with common headers, and copy-pasting everything or building a parsing and writer script is waay too much to ask. Turns out, <code>powershell</code> do have built-in command just to do CSV utility command!</p><h1 id=first-and-foremost class=tc>First and Foremost</h1><p>Assuming you&rsquo;re using windows, of course. And powershell at least version 5.1</p><h1 id=one-liners-snippet class=tc>One Liners Snippet</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=ln>1</span><span class=cl><span class=nb>Get-ChildItem</span> <span class=s2>&#34;path/to/folder&#34;</span> <span class=n>-Filter</span> <span class=p>*.</span><span class=n>csv</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=n>FullName</span> <span class=p>|</span> <span class=nb>Import-Csv</span> <span class=p>|</span> <span class=nb>Export-Csv</span> <span class=s2>&#34;path/to/merge.csv&#34;</span> <span class=n>-NoTypeInformation</span> <span class=n>-Append</span>
</span></span></code></pre></div><p>The cmdlet pipes that took place are:</p><ol><li><code>Get-ChildItem</code> iterates over a directory, if flag <code>-Filter</code> is declared, then it will do some pattern-matching with the child items in that directory. Which is not only important, but you can do fancy stuff with it.</li><li><code>Select-Object -ExpandProperty FullName</code> takes previous stream and returns full absolute path to current child item.</li><li><code>Import-Csv</code> imports the csv into the stream and</li><li><code>Export-Csv</code> with <code>-Append</code> flag creates (if the file does not exist) and append previous CSV import from the stream.</li></ol><blockquote><p>Keep in mind that if you call this command repeatedly, it will bloat target path. <code>-Append</code> flag does not overwrite.</p></blockquote><h1 id=variations class=tc>Variations</h1><p>Say few of you CSVs fragment are updated quite frequently and you need to remove previous merge versions, just <code>rm</code> (or <code>Remove-File</code> if you prefer) previous file!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=ln>1</span><span class=cl><span class=nv>$mergedFileName</span> <span class=p>=</span> <span class=s2>&#34;conc.csv&#34;</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nv>$targetDir</span> <span class=p>=</span> <span class=s2>&#34;.&#34;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>TestPath</span> <span class=nv>$mergedFileName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=nb>Remove-Item</span> <span class=nv>$mergedFileName</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>}</span> 
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=nb>Get-ChildItem</span> <span class=nv>$targetDir</span> <span class=n>-Filter</span> <span class=p>*.</span><span class=n>csv</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=n>FullName</span> <span class=p>|</span> <span class=nb>Import-Csv</span> <span class=p>|</span> <span class=nb>Export-Csv</span> <span class=nv>$mergedFileName</span> <span class=n>-NoTypeInformation</span> <span class=n>-Append</span>
</span></span></code></pre></div><p>Or only merge specific CSVs with prefix in its filename</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=ln>1</span><span class=cl><span class=nb>Get-ChildItem</span> <span class=p>.</span> <span class=n>-Filter</span> <span class=s2>&#34;prefix_somethingsomething*.csv&#34;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=n>FullName</span> <span class=p>|</span> <span class=nb>Import-Csv</span> <span class=p>|</span> <span class=nb>Export-Csv</span> <span class=s2>&#34;conc.csv&#34;</span> <span class=n>-NoTypeInformation</span> <span class=n>-Append</span>
</span></span></code></pre></div><p>And you can add flag <code>-Recurse</code> into <code>Get-ChildItem</code> to recursively get child item within subfolders.</p><p>And <code>-Delimiter [your-csv-delimiter]</code> into <code>Import-Csv</code> in case you were&rsquo;nt using comma as delimiter. Make sure to refer the <a target=_blank class=extern href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/import-csv?view=powershell-5.1#-delimiter">Documentation
</a>, also keep in mind different powershell version might have different flags available to them.</p><p>And that&rsquo;s all.</p><p class=tc>Built with <a a target=_blank class=extern href=https://gohugo.io/>Hugo</a> | previoip &copy; 2024</p></body></html>