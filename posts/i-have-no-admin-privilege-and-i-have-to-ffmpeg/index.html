<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HTK24ZVY8")}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="/css/highlight.css?v=1.0.0"><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}small{font-size:calc(var(--f)*.82)}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}p canvas{outline:1px solid #000;width:calc(100% - var(--f)*1.6)}a{color:#1c69e5;text-decoration:underline}a:hover{color:#2072f5;text-decoration:none}a:active{color:#0062ff;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:#43454ce6;border-radius:3px}::-webkit-scrollbar-thumb{background:#c1cdf6e6;border-radius:3px}input,select,textarea{font:inherit}#control div{display:flex;align-items:center;margin-top:.6em}#control input,#control select,#control textarea{display:inline-block;margin:0 .5em}#control textarea{resize:vertical}#control p{margin:0;width:2rem}</style><title>ffmpeg - I Have No Admin Privilege and I Have To Transcode &ndash; dumb by default</title></head><body><div style=background-color:#69696969><br><h1 class=tc>dumb by default</h1><nav class=tc>[<a href=/>Home</a>]&nbsp;[<a href=/about/>About</a>]&nbsp;[<a href=/posts/>Posts</a>]&nbsp;[<a href=/resources/>Resources</a>]&nbsp;[<a href=/applets/>Applets</a>]&nbsp;</nav><hr></div><p style=padding:0><span>dir: <i><a href=/>Home</a> /
<a href=/posts/>Posts</a> /
<span>ffmpeg - I Have No Admin Privilege â€¦</span></i></span><br><span>published-date: 29 Nov 2024 13:22 +0700</span><br><span>categories: [<a href=http://previoip.github.io/categories/misc/>misc</a>]</span><br><span>tags: [<a href=http://previoip.github.io/tags/ffmpeg/>ffmpeg</a>]</span><br></p><h1 class=tc>ffmpeg - I Have No Admin Privilege and I Have To Transcode</h1><hr><div><p>A bit of background. A while ago I had to make a powerpoint slides with sets of video and audio sequence for certain event backdrop. Low-cost, readily available software (powerpoint), and easy handover to operators. Problem was, one video with only 3 min runtime, is a humongous 13gb .mov file. On playback it freezes my workstation, and then goes blank indefinitely with no sound playing.</p><p>I might&rsquo;ve bid my adieu from any video production long long ago and my knowledge to the matter is still fairly limited. But a quick glance it&rsquo;s already telling something clearly had gone wrong on post. Or it might be deliberate for high fidelity viewing on high-end player? Let&rsquo;s find out.</p><p>Needless to say I need to bring the size down to a reasonable number and make it playable on low spec devices. And here&rsquo;s the catch:</p><ul><li>The deadline was nigh (less than a day)</li><li>I could&rsquo;t request for smaller version because the work was done by a vendor (too much hassle)</li><li>No online tool since the file was way too big</li><li>Flash drive file transfer to my personal pc is prohibited due to policy</li><li>I need to request through IT if I want to install additional softwares on my workstation<ul><li>and had to go through 3rd party vendor, not some random sourceforge download unless approved by IT</li><li>with lead time up to a month for proceedings</li><li>which means a goto such as <a target=_blank class=extern href=https://handbrake.fr>handbrake</a> is a big fuckoff thrown at my face.</li></ul></li></ul><p>Palms began to sweat, knees weak, arms heavy as I sip cold bitter coffee I brewed that morning. &ldquo;is 3 PM man you&rsquo;re done fuuucked&rdquo; the clock humiliated me as I only have till noon the next day before handover. As I close my eyes I muttered o&rsquo; lord x264 AVC codec, <a target=_blank class=extern href="https://news.ycombinator.com/user?id=DarkShikari">dark shikari</a> with <a target=_blank class=extern href=https://twitter.com/darkshikari>yukari pfp</a> god of gensokyo, please give me wisdom on fast reliable portable free handwritten in assembly transcoder. Then it struck me: ffmpeg.</p><p>Jest aside I think ffmpeg is underrated, especially it&rsquo;s most likely lives in most streaming services backends such as youtube (or at least until <a target=_blank class=extern href=https://multimedia.cx/eggs/googles-youtube-uses-ffmpeg>certain point</a>). No other person I know ever use the command line tool at least once.</p><p>That&rsquo;s why I want to share 2 case where ffmpeg could be useful.</p><h3 id=1-general-transcoding-on-your-desktop>1. General transcoding on your desktop</h3><p>This is the scenario I had to deal with as in previous story, where I can&rsquo;t install shit on my work computer.</p><p>You may notice on the ffmpeg website (<a target=_blank class=extern href=https://ffmpeg.org>https://ffmpeg.org</a>) that the windows release is on another website as prebuilt binary. I&rsquo;m using gyan.dev essentials build. If you&rsquo;re being paranoid on running random .exe on your computer, you can check the hash in powershell</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=ln>1</span><span class=cl><span class=nb>Get-FileHash</span> <span class=n>path</span><span class=p>/</span><span class=n>to</span><span class=p>/</span><span class=n>ffmpeg</span><span class=p>-&lt;</span><span class=n>version</span><span class=p>&gt;</span><span class=n>-essentials_build</span><span class=p>.</span><span class=py>7z</span> <span class=c># or zip</span>
</span></span></code></pre></div><p>and validate the sha256 accordingly. No malware or any malicious program is being distributed from the site (so far). But hey I trust my sources.</p><p>Extract the archive wherever, most conveniently on root C: drive under subfolder. If you have the privilege then add to environment variables. But if you don&rsquo;t (me) then we&rsquo;d have to refer the program using full path whenever we need them.</p><p>In this example I extracted ffmpeg under directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln>1</span><span class=cl>C:/ffmpeg/bin/ffmpeg.exe
</span></span></code></pre></div><p>with other program inside such as ffprobe and and ffplay, but we don&rsquo;t need those at the moment.</p><p>A little tangent with ffprobe, we can fetch media info to check the metrics and possibly answer our first question.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=c1># a little snippet to extract info into a txt file</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># note stderr also piped into the file, I had a</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1># problem before that error raised while fetching</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1># and the info is being printed out instead</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>ffprobe redacted.mov &gt; redacted_info.txt 2&gt; <span class=p>&amp;</span><span class=m>1</span>
</span></span></code></pre></div><p>Here are the excerpt of the 13 gig video I mentioned before</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln> 1</span><span class=cl>Input #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;redacted.mov&#39;:
</span></span><span class=line><span class=ln> 2</span><span class=cl>  Metadata:
</span></span><span class=line><span class=ln> 3</span><span class=cl>    major_brand     : qt  
</span></span><span class=line><span class=ln> 4</span><span class=cl>    minor_version   : 537199360
</span></span><span class=line><span class=ln> 5</span><span class=cl>    compatible_brands: qt  
</span></span><span class=line><span class=ln> 6</span><span class=cl>    creation_time   : 2024-10-07T09:19:55.000000Z
</span></span><span class=line><span class=ln> 7</span><span class=cl>  Duration: 00:03:08.24, start: 0.000000, bitrate: 593979 kb/s
</span></span><span class=line><span class=ln> 8</span><span class=cl>  Stream #0:0[0x1](eng): Video: prores (HQ) (apch / 0x68637061), yuv422p10le(bt709, progressive), 3840x2160, 592398 kb/s, SAR 1:1 DAR 16:9, 25 fps, 25 tbr, 25 tbn (default)  
</span></span><span class=line><span class=ln> 9</span><span class=cl>    Metadata:
</span></span><span class=line><span class=ln>10</span><span class=cl>      creation_time   : 2024-10-07T09:19:55.000000Z
</span></span><span class=line><span class=ln>11</span><span class=cl>      handler_name    : Apple Video Media Handler
</span></span><span class=line><span class=ln>12</span><span class=cl>      vendor_id       : appl
</span></span><span class=line><span class=ln>13</span><span class=cl>      encoder         : Apple ProRes 422 HQ
</span></span><span class=line><span class=ln>14</span><span class=cl>      timecode        : 00:00:00:00
</span></span><span class=line><span class=ln>15</span><span class=cl>  Stream #0:1[0x2](eng): Audio: pcm_s16le (sowt / 0x74776F73), 48000 Hz, stereo, s16, 1536 kb/s (default)
</span></span><span class=line><span class=ln>16</span><span class=cl>    Metadata:
</span></span><span class=line><span class=ln>17</span><span class=cl>      creation_time   : 2024-10-07T09:19:55.000000Z
</span></span><span class=line><span class=ln>18</span><span class=cl>      handler_name    : Apple Sound Media Handler
</span></span><span class=line><span class=ln>19</span><span class=cl>      vendor_id       :     
</span></span><span class=line><span class=ln>20</span><span class=cl>      timecode        : 00:00:00:00
</span></span><span class=line><span class=ln>21</span><span class=cl>  Stream #0:2[0x3](eng): Data: none (tmcd / 0x64636D74) (default)
</span></span><span class=line><span class=ln>22</span><span class=cl>    Metadata:
</span></span><span class=line><span class=ln>23</span><span class=cl>      creation_time   : 2024-10-07T09:19:55.000000Z
</span></span><span class=line><span class=ln>24</span><span class=cl>      handler_name    : Time Code Media Handler
</span></span><span class=line><span class=ln>25</span><span class=cl>      timecode        : 00:00:00:00
</span></span><span class=line><span class=ln>26</span><span class=cl>Unsupported codec with id 0 for input stream 2
</span></span></code></pre></div><p>We can get some interesting insights, mainly:</p><ul><li>4k res</li><li>25 fps</li><li>ProRes 422 HQ codec !!</li><li>up to 500mb bitrate !!!!</li></ul><p>To put into perspective, a generic 4k x265/HEVC rip would&rsquo;t need to exceed 60mb/s.</p><p>I presumed to the whole ordeal was this is a version to be displayed under high-res displays. But now I firmly believe we asked the vendor to export with ultra high preset, and instead we got bloated lossy mpeg-4 media.</p><p>To change file format while delegating optimization to ffmpeg, just run the following from your preferred terminal.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=c1># substitute C:/ffmpeg/bin/ffmpeg.exe with ffmpeg if you have it in env variable</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># also enclosing double quote on path is optional, i think it renders better with quote  </span>
</span></span><span class=line><span class=ln>3</span><span class=cl>
</span></span><span class=line><span class=ln>4</span><span class=cl>C:/ffmpeg/bin/ffmpeg.exe -y -i <span class=s2>&#34;path/to/target/video.mov&#34;</span> <span class=s2>&#34;path/to/target/video.mp4&#34;</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=c1># where:</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=c1>#   -y : overwrite output file if already exists</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=c1>#   -i : input url</span>
</span></span></code></pre></div><p>This was the whole setup I used to compress the video.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>C:/ffmpeg/bin/ffmpeg.exe <span class=se>\
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=se></span>    -i <span class=s2>&#34;path/to/target/redacted.mov&#34;</span> <span class=se>\ </span>     <span class=c1># input filepath</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    -y <span class=se>\ </span>                                   <span class=c1># set overwrite</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    -vf <span class=s2>&#34;setsar=1:1,scale=1920:-2&#34;</span> <span class=se>\ </span>       <span class=c1># set video stream filter; downsize 1920 width infer height with -2 while preserving aspect ratio of 16:9, the set aspect ratio &#34;setsar&#34; is optional afaik  </span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    -c:v libx264 <span class=se>\ </span>                         <span class=c1># set video encoder to x264</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>    -c:a aac <span class=se>\ </span>                             <span class=c1># set audio encoder to aac</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>    -crf <span class=m>28</span> <span class=se>\ </span>                              <span class=c1># for x264, you can specify constant quality &#34;index&#34;?? ranging from 0-51, where 0 is lossless and 51 is equivalent to youtubepoop deepfried videos  </span>
</span></span><span class=line><span class=ln>8</span><span class=cl>    <span class=s2>&#34;path/to/target/redacted.mp4&#34;</span>           <span class=c1># output filepath</span>
</span></span></code></pre></div><p>The resulting transcoded video eats my storage with ONLY 90mb.</p><p>In case anyone wondering, here&rsquo;s ffprobe output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln> 1</span><span class=cl>Input #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;redacted.mp4&#39;:
</span></span><span class=line><span class=ln> 2</span><span class=cl>  Metadata:
</span></span><span class=line><span class=ln> 3</span><span class=cl>    major_brand     : isom
</span></span><span class=line><span class=ln> 4</span><span class=cl>    minor_version   : 512
</span></span><span class=line><span class=ln> 5</span><span class=cl>    compatible_brands: isomiso2avc1mp41
</span></span><span class=line><span class=ln> 6</span><span class=cl>    encoder         : Lavf61.9.100
</span></span><span class=line><span class=ln> 7</span><span class=cl>  Duration: 00:03:09.06, start: 0.000000, bitrate: 3784 kb/s
</span></span><span class=line><span class=ln> 8</span><span class=cl>  Stream #0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 3651 kb/s, 25 fps, 25 tbr, 12800 tbn (default)  
</span></span><span class=line><span class=ln> 9</span><span class=cl>    Metadata:
</span></span><span class=line><span class=ln>10</span><span class=cl>      handler_name    : VideoHandler
</span></span><span class=line><span class=ln>11</span><span class=cl>      vendor_id       : [0][0][0][0]
</span></span><span class=line><span class=ln>12</span><span class=cl>      encoder         : Lavc61.22.100 libx264
</span></span><span class=line><span class=ln>13</span><span class=cl>  Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, stereo, fltp, 127 kb/s (default)
</span></span><span class=line><span class=ln>14</span><span class=cl>    Metadata:
</span></span><span class=line><span class=ln>15</span><span class=cl>      handler_name    : SoundHandler
</span></span><span class=line><span class=ln>16</span><span class=cl>      vendor_id     Â Â :Â [0][0][0][0]
</span></span></code></pre></div><p>It could be better optimized but at this point I&rsquo;ll take it.</p><h3 id=2-batch-transcoding-from-google-drive-with-colab>2. Batch transcoding from google drive with colab</h3><p>Lots of linux distribution is shipped with ffmpeg as far as I know, and vm under google colab is no exception.</p><p>The nice thing about colab is that you can mount your google drive to it. With a quick script + subprocess or even with a <a target=_blank class=extern href=https://github.com/kkroening/ffmpeg-python>ffmpeg wrapper</a>, we can get those videos into colab, transcode/demux it, and put it back to drive seamlessly.</p><p>This is a trick that I used a few months ago, where I need to re-encode raws into batches of smaller-ish stocks uniformly which I can later efficiently edit them on my pc. Peers who were taking these footages already uploaded theirs to my drive. Problem is that sometimes the raw file sizes can be gigs big, and different phone can have varying quality, resolution, frame-rate, formats, and so on. Transcoding into one agreeable format saves a lot of production time. Moreover it can reduce headaches if suddenly the video editor (Premiere) refuses to work with mov-quicktime due to missing proprietary codecs installed on my system.</p><p>The following is a simple script I made to scan a directory on a drive, dupes it, do stuff, and spits back out into destination folder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln> 1</span><span class=cl><span class=c1># I had to rewrite from the original notebook</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1># and I may have miss something, this might not run.</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># but the gist still stays the same</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kn>import</span> <span class=nn>cv2</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=kn>import</span> <span class=nn>shutil</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=kn>import</span> <span class=nn>traceback</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=kn>from</span> <span class=nn>glob</span> <span class=kn>import</span> <span class=n>glob</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kn>from</span> <span class=nn>google.colab</span> <span class=kn>import</span> <span class=n>drive</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=n>drive_dir</span> <span class=o>=</span> <span class=s1>&#39;/content/drive&#39;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=n>drive</span><span class=o>.</span><span class=n>mount</span><span class=p>(</span><span class=n>drive_dir</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=n>src_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>drive_dir</span><span class=p>,</span> <span class=s1>&#39;vidyas/raws&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=n>res_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>drive_dir</span><span class=p>,</span> <span class=s1>&#39;vidyas/preprocessed&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1># use mkdtemp from tempfile if you prefer</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=n>tmp_src_dir</span> <span class=o>=</span> <span class=s1>&#39;temp_src&#39;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=n>tmp_dst_dir</span> <span class=o>=</span> <span class=s1>&#39;temp_res&#39;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>tmp_src_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>tmp_dst_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=k>for</span> <span class=n>src</span> <span class=ow>in</span> <span class=n>glob</span><span class=p>(</span><span class=n>src_dir</span> <span class=o>+</span> <span class=s1>&#39;/*.*&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>  <span class=n>filename</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>src</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[:</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>  <span class=n>dst</span> <span class=o>=</span> <span class=n>filename</span> <span class=o>+</span> <span class=s1>&#39;.mp4&#39;</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>  <span class=n>dst_temp</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tmp_dst_dir</span><span class=p>,</span> <span class=n>dst</span><span class=p>)</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>  <span class=c1># this is bad practice but I only need this to run successfully once so I&#39;m leaving this here</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=n>src_temp</span> <span class=o>=</span> <span class=n>src</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>  <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=n>src_temp</span> <span class=o>=</span> <span class=n>shutil</span><span class=o>.</span><span class=n>copy2</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>tmp_src_dir</span><span class=p>)</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>())</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=k>continue</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl>  <span class=c1># optional, in a way this is very much overkill but footages comes from phone and people often record vertically, so...  </span>
</span></span><span class=line><span class=ln>36</span><span class=cl>  <span class=n>probe</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>VideoCapture</span><span class=p>(</span><span class=n>src</span><span class=p>)</span> <span class=c1># overkill because this part scans the whole media, and it takes time</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=n>height</span> <span class=o>=</span> <span class=n>probe</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cv2</span><span class=o>.</span><span class=n>CAP_PROP_FRAME_HEIGHT</span><span class=p>)</span> <span class=c1># at this point you may be wondering why not use opencv for the whole ordeal  </span>
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=n>width</span> <span class=o>=</span> <span class=n>probe</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>cv2</span><span class=o>.</span><span class=n>CAP_PROP_FRAME_WIDTH</span><span class=p>)</span> <span class=c1># to this day I&#39;m asking myself the same question too</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=n>is_vertical</span> <span class=o>=</span> <span class=n>height</span> <span class=o>&gt;</span> <span class=n>width</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>
</span></span><span class=line><span class=ln>41</span><span class=cl>  <span class=n>command</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;ffmpeg&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=n>command</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;-y&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>  <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-i&#39;</span><span class=p>,</span> <span class=s1>&#39;&#34;</span><span class=si>{}</span><span class=s1>&#34;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>src_temp</span><span class=p>)])</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>  <span class=k>if</span> <span class=n>is_vertical</span><span class=p>:</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;found vertical&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-vf&#39;</span><span class=p>,</span> <span class=s1>&#39;&#34;setsar=1:1,scale=-2:1280&#34;&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>  <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-vf&#39;</span><span class=p>,</span> <span class=s1>&#39;&#34;setsar=1:1,scale=1280:-2&#34;&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>  <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-r&#39;</span><span class=p>,</span> <span class=s1>&#39;30&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>  <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-c:v&#39;</span><span class=p>,</span> <span class=s1>&#39;libx264&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>  <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-c:a&#39;</span><span class=p>,</span> <span class=s1>&#39;copy&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>  <span class=n>command</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s1>&#39;-crf&#39;</span><span class=p>,</span> <span class=s1>&#39;24&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=n>command</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;&#34;</span><span class=si>{}</span><span class=s1>&#34;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>dst_temp</span><span class=p>))</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>  <span class=n>errno</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>command</span><span class=p>))</span> <span class=c1># or use subprocess, whatever suits you</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>  
</span></span><span class=line><span class=ln>56</span><span class=cl>  <span class=k>if</span> <span class=n>errno</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;success:&#39;</span><span class=p>,</span> <span class=n>dst_temp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>    <span class=n>shutil</span><span class=o>.</span><span class=n>copy2</span><span class=p>(</span><span class=n>dst_temp</span><span class=p>,</span> <span class=n>res_dir</span><span class=p>)</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>  <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>    <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s1>&#39;somethign had gone horribly wrong: </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>command</span><span class=p>)))</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>
</span></span><span class=line><span class=ln>62</span><span class=cl><span class=c1># once you&#39;re done, flush and unmount</span>
</span></span><span class=line><span class=ln>63</span><span class=cl><span class=n>drive</span><span class=o>.</span><span class=n>flush_and_unmount</span><span class=p>()</span>
</span></span></code></pre></div><p>I&rsquo;m just scratching the surface here, and no way I can memorize all flags and parameter ffmpeg provides. And also other uses other than transcoder to use ffmpeg to its fullest potential. It&rsquo;s an awesome tool and it deserves more love. You can donate to the project <a target=_blank class=extern href=https://ffmpeg.org/donations.html>here</a>.</p></div><br><br><br><br><p class=tc>Built with <a a target=_blank class=extern href=https://gohugo.io/>Hugo</a> | previoip (c) 2025</p></body></html>