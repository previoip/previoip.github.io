<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HTK24ZVY8")}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="/css/highlight.css?v=1.0.0"><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}small{font-size:calc(var(--f)*.82)}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}p canvas{outline:1px solid #000;width:calc(100% - var(--f)*1.6)}a{color:#1c69e5;text-decoration:underline}a:hover{color:#2072f5;text-decoration:none}a:active{color:#0062ff;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:#43454ce6;border-radius:3px}::-webkit-scrollbar-thumb{background:#c1cdf6e6;border-radius:3px}#control div{display:flex;align-items:center;margin-top:.6em}#control input,#control select{font:inherit;display:inline-block;margin:0 .5em}#control p{margin:0;width:2rem}</style><title>Polyfitting Colormap &ndash; dumb by default</title></head><body><div style=background-color:#69696969><br><h1 class=tc>dumb by default</h1><nav class=tc>[<a href=/>Home</a>]&nbsp;[<a href=/about/>About</a>]&nbsp;[<a href=/posts/>Posts</a>]&nbsp;[<a href=/resources/>Resources</a>]&nbsp;[<a href=/applets/>Applets</a>]&nbsp;</nav><hr></div><p style=padding:0><span>dir: <i><a href=/>Home</a> /
<a href=/posts/>Posts</a> /
<span>Polyfitting Colormap</span></i></span><br><span>published-date: 25 May 2025 21:16 +0700</span><br><span>categories: [<a href=http://previoip.github.io/categories/quickie/>quickie</a>] [<a href=http://previoip.github.io/categories/python-hijinks/>python-hijinks</a>]</span><br><span>tags: [<a href=http://previoip.github.io/tags/python/>python</a>]</span><br></p><h1 class=tc>Polyfitting Colormap</h1><hr><div><p>This one&rsquo;s a quick writeup on how to encode/decode matplotlib colormap (CC0 license for due diligence) while avoiding using external dependencies.</p><p>Why not use a library or pasting predefined lookup table you may ask? With polyfit we can reduce lookup table into only n-ths degree polynomial coefficients! And generate lookup table (or even sample singular value) at compile time or at boot! Also I want to show other uses case of polyfit outside statistics.</p><p>You can obtain cmap lookup table from the following link. The following example uses inferno variant.</p><p><a target=_blank class=extern href=https://github.com/BIDS/colormap/blob/master/colormaps.py>https://github.com/BIDS/colormap/blob/master/colormaps.py</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=ln>  1</span><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>
</span></span><span class=line><span class=ln>  4</span><span class=cl><span class=n>N_POLY</span> <span class=o>=</span> <span class=mi>4</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>_inferno_data</span><span class=p>)</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl><span class=n>xs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>512</span><span class=p>)</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>
</span></span><span class=line><span class=ln>  8</span><span class=cl><span class=c1># generator function to decode sample at array x from polynomial coef array</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl><span class=k>def</span> <span class=nf>fp</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>  <span class=k>def</span> <span class=nf>fp_i</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>      <span class=n>s</span> <span class=o>+=</span> <span class=p>(</span><span class=n>v</span> <span class=o>**</span> <span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span> <span class=o>*</span> <span class=n>p</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>    <span class=k>return</span> <span class=n>s</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>  <span class=n>buf</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>))]</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl>  <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>)):</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>    <span class=n>buf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>fp_i</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>  <span class=k>return</span> <span class=n>buf</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>
</span></span><span class=line><span class=ln> 21</span><span class=cl><span class=c1># cleaner numpy version</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl><span class=k>def</span> <span class=nf>fp_np</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>  <span class=n>n</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>flip</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>p</span><span class=p>)))</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>  <span class=n>a</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>expand_dims</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>  <span class=n>a</span> <span class=o>=</span> <span class=n>a</span> <span class=o>**</span> <span class=n>n</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>  <span class=n>a</span> <span class=o>=</span> <span class=n>a</span> <span class=o>*</span> <span class=n>p</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl>  <span class=n>a</span> <span class=o>=</span> <span class=n>a</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl>  <span class=n>a</span><span class=p>[</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>  <span class=n>a</span><span class=p>[</span><span class=n>a</span><span class=o>&gt;</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>  <span class=k>return</span> <span class=n>a</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>
</span></span><span class=line><span class=ln> 32</span><span class=cl><span class=n>xx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>data</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl><span class=n>p_r</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>polyfit</span><span class=p>(</span><span class=n>xx</span><span class=p>,</span> <span class=n>data</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>N_POLY</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl><span class=n>p_g</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>polyfit</span><span class=p>(</span><span class=n>xx</span><span class=p>,</span> <span class=n>data</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>],</span> <span class=n>N_POLY</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl><span class=n>p_b</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>polyfit</span><span class=p>(</span><span class=n>xx</span><span class=p>,</span> <span class=n>data</span><span class=p>[:,</span> <span class=mi>2</span><span class=p>],</span> <span class=n>N_POLY</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>
</span></span><span class=line><span class=ln> 37</span><span class=cl><span class=n>repr_ps</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>p</span><span class=p>:</span> <span class=s1>&#39;[&#39;</span> <span class=o>+</span> <span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>v</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>v</span><span class=si>:</span><span class=s1>.16e</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>p</span><span class=p>))</span> <span class=o>+</span> <span class=s1>&#39;]&#39;</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl><span class=n>str_p_r</span> <span class=o>=</span> <span class=n>repr_ps</span><span class=p>(</span><span class=n>p_r</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl><span class=n>str_p_g</span> <span class=o>=</span> <span class=n>repr_ps</span><span class=p>(</span><span class=n>p_g</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl><span class=n>str_p_b</span> <span class=o>=</span> <span class=n>repr_ps</span><span class=p>(</span><span class=n>p_b</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>
</span></span><span class=line><span class=ln> 42</span><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;copy the following each channel p coef:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;p_r =&#39;</span><span class=p>,</span> <span class=n>str_p_r</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;p_g =&#39;</span><span class=p>,</span> <span class=n>str_p_g</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;p_b =&#39;</span><span class=p>,</span> <span class=n>str_p_b</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>
</span></span><span class=line><span class=ln> 47</span><span class=cl><span class=c1># the rest is optional, but allows us to see how decoded</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl><span class=c1># values may differ from source.</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>
</span></span><span class=line><span class=ln> 50</span><span class=cl><span class=c1># here we re-parse from string we generate previously </span>
</span></span><span class=line><span class=ln> 51</span><span class=cl><span class=c1># to simulate possible precision losses from pasted values.</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl><span class=n>p_r</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>str_p_r</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl><span class=n>p_g</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>str_p_g</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl><span class=n>p_b</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>str_p_b</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>
</span></span><span class=line><span class=ln> 56</span><span class=cl><span class=n>src</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>  <span class=n>np</span><span class=o>.</span><span class=n>interp</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>xx</span><span class=p>,</span> <span class=n>data</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>]),</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>  <span class=n>np</span><span class=o>.</span><span class=n>interp</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>xx</span><span class=p>,</span> <span class=n>data</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]),</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>  <span class=n>np</span><span class=o>.</span><span class=n>interp</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>xx</span><span class=p>,</span> <span class=n>data</span><span class=p>[:,</span> <span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl><span class=p>])</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl>
</span></span><span class=line><span class=ln> 62</span><span class=cl><span class=n>dec</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>  <span class=n>fp_np</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>p_r</span><span class=p>),</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>  <span class=n>fp_np</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>p_g</span><span class=p>),</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>  <span class=n>fp_np</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>p_b</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl><span class=p>])</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>
</span></span><span class=line><span class=ln> 68</span><span class=cl><span class=n>diff</span> <span class=o>=</span> <span class=n>src</span> <span class=o>-</span> <span class=n>dec</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl><span class=n>diff01</span> <span class=o>=</span> <span class=p>(</span><span class=n>diff</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl><span class=n>err</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>diff</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>
</span></span><span class=line><span class=ln> 72</span><span class=cl><span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>
</span></span><span class=line><span class=ln> 74</span><span class=cl><span class=n>sfig</span> <span class=o>=</span> <span class=n>fig</span><span class=o>.</span><span class=n>subfigures</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>height_ratios</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>
</span></span><span class=line><span class=ln> 76</span><span class=cl><span class=n>xt</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>  <span class=n>ax</span> <span class=o>=</span> <span class=n>sfig</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>  <span class=n>ax</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>xt</span><span class=p>,</span> <span class=n>fp_np</span><span class=p>(</span><span class=n>xt</span><span class=p>,</span> <span class=p>[</span><span class=n>p_r</span><span class=p>,</span> <span class=n>p_g</span><span class=p>,</span> <span class=n>p_b</span><span class=p>][</span><span class=n>i</span><span class=p>]),</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>  <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>src</span><span class=p>[:,</span> <span class=n>i</span><span class=p>],</span> <span class=n>c</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=s1>&#39;g&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>],</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>  <span class=k>if</span> <span class=n>i</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>:</span> <span class=n>ax</span><span class=o>.</span><span class=n>get_yaxis</span><span class=p>()</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl>  <span class=n>ax</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>((</span><span class=o>-</span><span class=mf>.01</span><span class=p>,</span> <span class=mf>1.01</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>  <span class=n>ax</span><span class=o>.</span><span class=n>set_title</span><span class=p>([</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=s1>&#39;green&#39;</span><span class=p>,</span> <span class=s1>&#39;blue&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>
</span></span><span class=line><span class=ln> 85</span><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sfig</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([[</span><span class=n>src</span><span class=p>],</span> <span class=p>[</span><span class=n>src</span><span class=p>]]),</span> <span class=n>aspect</span><span class=o>=</span><span class=s1>&#39;auto&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=o>-</span><span class=mf>.02</span><span class=p>,</span> <span class=mf>.5</span><span class=p>,</span> <span class=s1>&#39;source&#39;</span><span class=p>,</span> <span class=n>va</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>ha</span><span class=o>=</span><span class=s1>&#39;right&#39;</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=n>ax</span><span class=o>.</span><span class=n>transAxes</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_axis_off</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>
</span></span><span class=line><span class=ln> 90</span><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sfig</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([[</span><span class=n>dec</span><span class=p>],</span> <span class=p>[</span><span class=n>dec</span><span class=p>]]),</span> <span class=n>aspect</span><span class=o>=</span><span class=s1>&#39;auto&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=o>-</span><span class=mf>.02</span><span class=p>,</span> <span class=mf>.5</span><span class=p>,</span> <span class=s1>&#39;poly</span><span class=se>\n</span><span class=s1>decoded&#39;</span><span class=p>,</span> <span class=n>va</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>ha</span><span class=o>=</span><span class=s1>&#39;right&#39;</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=n>ax</span><span class=o>.</span><span class=n>transAxes</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_axis_off</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>
</span></span><span class=line><span class=ln> 95</span><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sfig</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([[</span><span class=n>diff01</span><span class=p>],</span> <span class=p>[</span><span class=n>diff01</span><span class=p>]]),</span> <span class=n>aspect</span><span class=o>=</span><span class=s1>&#39;auto&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=o>-</span><span class=mf>.02</span><span class=p>,</span> <span class=mf>.5</span><span class=p>,</span> <span class=s1>&#39;diff&#39;</span><span class=p>,</span> <span class=n>va</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>ha</span><span class=o>=</span><span class=s1>&#39;right&#39;</span><span class=p>,</span> <span class=n>transform</span><span class=o>=</span><span class=n>ax</span><span class=o>.</span><span class=n>transAxes</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_axis_off</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>
</span></span><span class=line><span class=ln>100</span><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sfig</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>add_subplot</span><span class=p>()</span>
</span></span><span class=line><span class=ln>101</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;diff each channel, rmse:</span><span class=si>{</span><span class=n>err</span><span class=si>:</span><span class=s1>.02e</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>102</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>103</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=n>err</span><span class=p>,</span> <span class=n>err</span><span class=p>],</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>104</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=o>-</span><span class=n>err</span><span class=p>,</span> <span class=o>-</span><span class=n>err</span><span class=p>],</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>105</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>diff</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>106</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>diff</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>],</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;g&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>107</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>xs</span><span class=p>,</span> <span class=n>diff</span><span class=p>[:,</span> <span class=mi>2</span><span class=p>],</span> <span class=n>c</span><span class=o>=</span><span class=s1>&#39;b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>108</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>((</span><span class=n>xs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>xs</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=ln>109</span><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>grid</span><span class=p>()</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>
</span></span><span class=line><span class=ln>111</span><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p>The code above will create this graph.</p><img src=./images/graph.png alt=image><p>The first three graph shows each channel value distribution with the dotted lines being the decoded values. Here we can see polyfit does not &ldquo;fit&rdquo; fully to sampled source.</p><p>The second three are the rendered version with diff. If you look closely with only 4 coef you can see bands of lightblue tint.</p><p>The third one visualizes each channel differences.</p><p>With inferno color table, which contains large amount of values, can be represented with only these coef (assuming we generate only 4).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>p_r</span> <span class=o>=</span> <span class=p>[</span><span class=mf>1.6557762312002666e+00</span><span class=p>,</span> <span class=o>-</span><span class=mf>5.0765628176037012e+00</span><span class=p>,</span> <span class=mf>3.6114437522600484e+00</span><span class=p>,</span> <span class=mf>7.5501780705212251e-01</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.0159038301211065e-02</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>p_g</span> <span class=o>=</span> <span class=p>[</span><span class=o>-</span><span class=mf>2.0627850606099467e+00</span><span class=p>,</span> <span class=mf>4.4300104345314564e+00</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.8488324386347577e+00</span><span class=p>,</span> <span class=mf>5.0539609607001779e-01</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.5872300948496232e-03</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>p_b</span> <span class=o>=</span> <span class=p>[</span><span class=mf>7.0917066940883133e+00</span><span class=p>,</span> <span class=o>-</span><span class=mf>6.6777021038402200e+00</span><span class=p>,</span> <span class=o>-</span><span class=mf>2.3104640769293701e+00</span><span class=p>,</span> <span class=mf>2.5883795816309192e+00</span><span class=p>,</span> <span class=mf>2.6268954622100660e-03</span><span class=p>]</span>
</span></span></code></pre></div><p>You can minimize the error increasing the number of coef globally or on each channel on line <code>33-35</code></p><p>Tangent: you can create or edit matplotlib colormap using <a target=_blank class=extern href=https://github.com/matplotlib/viscm>viscm</a>.</p></div><br><br><br><br><p class=tc>Built with <a a target=_blank class=extern href=https://gohugo.io/>Hugo</a> | previoip (c) 2025</p></body></html>