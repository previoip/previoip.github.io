<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-8HTK24ZVY8');
        }
      </script>
    
  


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/highlight.css?v=1.0.0">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">







<style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}small{font-size:calc(var(--f)*.82)}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}p canvas{outline:1px solid #000;width:calc(100% - var(--f)*1.6)}a{color:#1c69e5;text-decoration:underline}a:hover{color:#2072f5;text-decoration:none}a:active{color:#0062ff;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:#43454ce6;border-radius:3px}::-webkit-scrollbar-thumb{background:#c1cdf6e6;border-radius:3px}#control div{display:flex;align-items:center}#control input{display:inline-block;margin:0 .5em}#control p{margin:0}</style>


  <title>
Audio Histogram &ndash; dumb by default
</title>
</head>

<body><div style="background-color: #69696969;">
  <br>
  <h1 class="tc">dumb by default</h1>
  
<nav class="tc">
[<a href="/">Home</a>]&nbsp;[<a href="/about/">About</a>]&nbsp;[<a href="/posts/">Posts</a>]&nbsp;[<a href="/resources/">Resources</a>]&nbsp;[<a href="/applets/">Applets</a>]&nbsp;
</nav><hr>
</div><p style="padding: 0;">


<span>dir: <i>








<a href="/">Home</a> &sol;






<a href="/applets/">Applets</a> &sol;






<span>Audio Histogram</span>

</i></span>




      <br>
      
      
      
      <span>published-date: 21 May 2025 16:58 &#43;0700</span><br>
      
      
      
       
<span>
  categories: [<a href="http://localhost:1313/categories/misc/">misc</a>]</span>
<br>
       
<span>
  tags: [<a href="http://localhost:1313/tags/"></a>]</span>
<br>    
    </p>
  <h1 class="tc">Audio Histogram</h1>
  <hr>
  <div>
    

<p><canvas id="viewport" width=512 height=256></canvas></p>

<div class="highlight" id="code" inject="true"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="ln">  1</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl">
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;viewport&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&#34;2d&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;alpha&#34;</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="kr">const</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="kr">const</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="kr">const</span> <span class="nx">buf</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="kr">const</span> <span class="nx">ftoi</span> <span class="o">=</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">~~</span><span class="nx">v</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">x1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">y0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="kd">function</span> <span class="nx">cTimer</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">fps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">pt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">t</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">pt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">pt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">fps</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">ftoi</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">:</span> <span class="kc">NaN</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">progress</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n_loop</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">%</span> <span class="nx">n_loop</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">n_loop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cTimer</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">
</span></span><span class="line"><span class="ln"> 30</span><span class="cl"><span class="kd">function</span> <span class="nx">cInputElementValuesProxy</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">_default</span><span class="o">=</span><span class="kc">null</span><span class="p">,</span> <span class="nx">cast</span><span class="o">=</span><span class="p">(</span><span class="nx">v</span><span class="p">)=&gt;</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;#&#34;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&#34;_value&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;input&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">_default</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="nx">_default</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="kr">const</span> <span class="nx">p_inputs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cInputElementValuesProxy</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">
</span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;black&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="nx">timer</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="nx">canvasClear</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;green&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">215</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">update</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">
</span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasClear</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;white&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">
</span></span><span class="line"><span class="ln"> 77</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDraw</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="kr">const</span> <span class="nx">imd</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">    <span class="nx">x</span> <span class="o">=</span> <span class="nx">i</span><span class="o">/</span><span class="mi">4</span><span class="o">%</span><span class="nx">w</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">    <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="nx">w</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="nx">w</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[(</span><span class="nx">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="nx">y</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">      <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">imd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">
</span></span><span class="line"><span class="ln"> 98</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDrawInfo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  <span class="kr">const</span> <span class="nx">iw</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;black&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">h</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="nx">iw</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;white&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s2">&#34;12px monospace&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span> <span class="o">=</span> <span class="s2">&#34;middle&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">timer</span><span class="p">.</span><span class="nx">dt</span> <span class="o">+</span> <span class="s2">&#34;ms&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">h</span><span class="o">-</span><span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&#34;fps:&#34;</span> <span class="o">+</span> <span class="nx">timer</span><span class="p">.</span><span class="nx">fps</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="nx">h</span><span class="o">-</span><span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">timer</span><span class="p">.</span><span class="nx">f</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="nx">h</span><span class="o">-</span><span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">
</span></span><span class="line"><span class="ln">112</span><span class="cl">
</span></span><span class="line"><span class="ln">113</span><span class="cl"><span class="kd">function</span> <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="nx">timer</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">  <span class="nx">canvasDraw</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="nx">canvasDrawInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">  <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">update</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">
</span></span><span class="line"><span class="ln">120</span><span class="cl"><span class="nx">init</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">
</span></span><span class="line"><span class="ln">122</span><span class="cl"><span class="p">}</span></span></span></code></pre></div>

<script defer>{

const canvas = document.getElementById("viewport");
const ctx = canvas.getContext("2d", {"alpha":false});
const w = canvas.width;
const h = canvas.height;
const buf = [255,255,255,255]
const ftoi = (v) => ~~v;
var i=0, j=0, x=0, y=0, x1=0, y0=0, r=0;


function cTimer () {
  this.f = 0;
  this.fps = 0;
  this.t = 0;
  this.pt = 0;
  this.dt = 0;
  this.update = () => {
    this.f += 1;
    this.t = Date.now();
    this.dt = this.t - this.pt;
    this.pt = this.t;
    this.fps = this.dt > 0 ? ftoi(1 / this.dt * 1000) : NaN;
  }
  this.progress = (n_loop) => this.f % n_loop / Math.max(n_loop-1, 1)
}
const timer = new cTimer();


function cInputElementValuesProxy () {
  this.values = {};
  this.target = {};
  this.display = {};
  this.register = (name, _default=null, cast=(v)=>v) => {
    this.values[name] = null;
    this.target[name] = document.getElementById(name);
    this.display[name] = this.target[name].parentElement.querySelector("#" + name + "_value");

    this.target[name].addEventListener("input", (event) => {
      this.values[name] = cast(event.target.value);
      if (this.display[name] !== null) {
        this.display[name].innerHTML = "" + event.target.value;
      }
    });

    if (_default !== null) {
      this.target[name].value = _default;
      this.values[name] = cast(_default);
      this.display[name].innerHTML = "" + _default;
    }
  };
}
const p_inputs = new cInputElementValuesProxy();



function init() {
  ctx.fillStyle = "black";
  timer.update();
  canvasClear();
  ctx.fillStyle = "green";
  ctx.fillRect(215,50,100,100);

  window.requestAnimationFrame(update);
}


function canvasClear() {
  ctx.save();
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle = "white";
  ctx.fillRect(0,0,w,h);
  ctx.restore();
}


function canvasDraw() {
  const imd = ctx.getImageData(0,0,w,h);
  for (i=0; i<imd.data.length; i+=4) {
    x = i/4%w;
    y = Math.floor(i/4/w);
    if (x+1<w) {
      imd.data[x*4+y*4*w+0] = imd.data[(x+1)*4+y*4*w+0];
      imd.data[x*4+y*4*w+1] = imd.data[(x+1)*4+y*4*w+1];
      imd.data[x*4+y*4*w+2] = imd.data[(x+1)*4+y*4*w+2];
      imd.data[x*4+y*4*w+3] = imd.data[(x+1)*4+y*4*w+3];
    } else {
      imd.data[i+0] = ftoi(255 * Math.random());
      imd.data[i+1] = ftoi(255 * Math.random());
      imd.data[i+2] = ftoi(255 * Math.random());
      imd.data[i+3] = ftoi(255 * Math.random());
    }
  }
  ctx.putImageData(imd, 0, 0);
}


function canvasDrawInfo() {
  const iw = 150;
  ctx.save();
  ctx.fillStyle = "black";
  ctx.fillRect(0, h-16, iw, 16);
  ctx.fillStyle = "white";
  ctx.font = "12px monospace";
  ctx.textBaseline = "middle";
  ctx.fillText(timer.dt + "ms", 4, h-7);
  ctx.fillText("fps:" + timer.fps, 44, h-7);
  ctx.fillText("" + timer.f, 92, h-7);
  ctx.restore();
}


function update() {
  timer.update();
  canvasDraw();
  canvasDrawInfo();
  window.requestAnimationFrame(update);
}

init();

}</script>




  </div>
  

  
  <br>
  <br>
  <br>
  <br>
  <p class="tc">Built with <a a target="_blank" class="extern" href="https://gohugo.io/">Hugo</a> | previoip (c) 2025</p>
</body>

</html>


