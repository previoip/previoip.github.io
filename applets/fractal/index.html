<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HTK24ZVY8")}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="/css/highlight.css?v=1.0.0"><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}small{font-size:calc(var(--f)*.82)}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}p canvas{outline:1px solid #000;width:calc(100% - var(--f)*1.6)}a{color:#1c69e5;text-decoration:underline}a:hover{color:#2072f5;text-decoration:none}a:active{color:#0062ff;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:#43454ce6;border-radius:3px}::-webkit-scrollbar-thumb{background:#c1cdf6e6;border-radius:3px}input,select,textarea{font:inherit}#control div{display:flex;align-items:center;margin-top:.6em}#control input,#control select,#control textarea{display:inline-block;margin:0 .5em}#control textarea{resize:vertical}#control p{margin:0;width:2rem}</style><title>Fractal &ndash; dumb by default</title></head><body><div style=background-color:#69696969><br><h1 class=tc>dumb by default</h1><nav class=tc>[<a href=/>Home</a>]&nbsp;[<a href=/about/>About</a>]&nbsp;[<a href=/posts/>Posts</a>]&nbsp;[<a href=/resources/>Resources</a>]&nbsp;[<a href=/applets/>Applets</a>]&nbsp;</nav><hr></div><p style=padding:0><span>dir: <i><a href=/>Home</a> /
<a href=/applets/>Applets</a> /
<span>Fractal</span></i></span><br><span>published-date: 20 Jun 2025 14:14 +0700</span><br></p><h1 class=tc>Fractal</h1><hr><div><p><canvas id=viewport width=1080 height=1080></canvas></p><div id=control><div><label for=OffsetX>offset: re</label>
<input id=OffsetX type=number value=0 step=0.00000001>
<label for=OffsetY>im</label>
<input id=OffsetY type=number value=0 step=0.00000001></div><div><label for=OffsetX>zoom:</label>
<input id=Zoom type=number value=0 min=0.1></div><div><label for=Iter>max iter:</label>
<input id=Iter type=number value=0></div><div><input id=Compute type=button value=compute>
<input id=Reset type=button value=reset></div></div><div class=highlight inject=true><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>  1</span><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>
</span></span><span class=line><span class=ln>  4</span><span class=cl><span class=kr>const</span> <span class=nx>canvas</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;viewport&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl><span class=kr>const</span> <span class=nx>ctx</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>getContext</span><span class=p>(</span><span class=s1>&#39;2d&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;alpha&#39;</span><span class=o>:</span><span class=kc>false</span><span class=p>});</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl><span class=kr>const</span> <span class=nx>ftoi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>v</span><span class=p>)=&gt;</span><span class=o>~~</span><span class=nx>v</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl><span class=kd>var</span> <span class=nx>frame</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl><span class=kd>var</span> <span class=nx>fractals</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl><span class=kd>var</span> <span class=nx>inputProxy</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span> 
</span></span><span class=line><span class=ln> 10</span><span class=cl>
</span></span><span class=line><span class=ln> 11</span><span class=cl>
</span></span><span class=line><span class=ln> 12</span><span class=cl><span class=kr>class</span> <span class=nx>Complex</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>re</span><span class=p>,</span> <span class=nx>im</span><span class=p>)</span> <span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>re</span><span class=o>=</span><span class=nx>re</span><span class=o>||</span><span class=mi>0</span><span class=p>;</span><span class=k>this</span><span class=p>.</span><span class=nx>im</span><span class=o>=</span><span class=nx>im</span><span class=o>||</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>  <span class=nx>addc</span><span class=p>(</span><span class=nx>z</span><span class=p>){</span><span class=k>this</span><span class=p>.</span><span class=nx>re</span><span class=o>+=</span><span class=nx>z</span><span class=p>.</span><span class=nx>re</span><span class=p>;</span><span class=k>this</span><span class=p>.</span><span class=nx>im</span><span class=o>+=</span><span class=nx>z</span><span class=p>.</span><span class=nx>im</span><span class=p>;</span><span class=k>return</span> <span class=k>this</span><span class=p>};</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>  <span class=nx>mulc</span><span class=p>(</span><span class=nx>z</span><span class=p>){</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>    <span class=kd>let</span> <span class=nx>re</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>re</span> <span class=o>*</span> <span class=nx>z</span><span class=p>.</span><span class=nx>re</span><span class=p>)</span> <span class=o>-</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>im</span> <span class=o>*</span> <span class=nx>z</span><span class=p>.</span><span class=nx>im</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl>    <span class=kd>let</span> <span class=nx>im</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>re</span> <span class=o>*</span> <span class=nx>z</span><span class=p>.</span><span class=nx>im</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>im</span> <span class=o>*</span> <span class=nx>z</span><span class=p>.</span><span class=nx>re</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>re</span> <span class=o>=</span> <span class=nx>re</span><span class=p>;</span> <span class=k>this</span><span class=p>.</span><span class=nx>im</span> <span class=o>=</span> <span class=nx>im</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>    <span class=k>return</span> <span class=k>this</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>  <span class=nx>divc</span><span class=p>(</span><span class=nx>z</span><span class=p>){</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>    <span class=kd>let</span> <span class=nx>t_re</span> <span class=o>=</span> <span class=nx>z</span><span class=p>.</span><span class=nx>re</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>    <span class=kd>let</span> <span class=nx>t_im</span> <span class=o>=</span> <span class=nx>z</span><span class=p>.</span><span class=nx>im</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>    <span class=nx>z</span><span class=p>.</span><span class=nx>inverse_i</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>mulc</span><span class=p>(</span><span class=nx>z</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>    <span class=nx>z</span><span class=p>.</span><span class=nx>re</span> <span class=o>=</span> <span class=nx>t_re</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl>    <span class=nx>z</span><span class=p>.</span><span class=nx>im</span> <span class=o>=</span> <span class=nx>t_im</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>  <span class=nx>square</span><span class=p>()</span> <span class=p>{</span><span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>re</span><span class=o>**</span><span class=mi>2</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>im</span><span class=o>**</span><span class=mi>2</span><span class=p>};</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>  <span class=nx>conjugate_i</span><span class=p>(){</span><span class=k>this</span><span class=p>.</span><span class=nx>im</span> <span class=o>*=-</span><span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl>  <span class=nx>inverse_i</span><span class=p>(){</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>    <span class=kd>let</span> <span class=nx>l</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>square</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>re</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>re</span><span class=o>/</span><span class=nx>l</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>im</span> <span class=o>=</span> <span class=o>-</span><span class=k>this</span><span class=p>.</span><span class=nx>im</span><span class=o>/</span><span class=nx>l</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>    <span class=k>return</span> <span class=k>this</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>  <span class=nx>inverse</span><span class=p>(){</span><span class=k>return</span> <span class=k>new</span> <span class=nx>Complex</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>re</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>im</span><span class=p>).</span><span class=nx>inverse_i</span><span class=p>()};</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>  <span class=nx>magnitude</span><span class=p>(){</span><span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>square</span><span class=p>())};</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>
</span></span><span class=line><span class=ln> 42</span><span class=cl>
</span></span><span class=line><span class=ln> 43</span><span class=cl><span class=kd>function</span> <span class=nx>cInputProxy</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>values</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>target</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>display</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>defaults</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>register</span> <span class=o>=</span> <span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>_default</span><span class=o>=</span><span class=kc>null</span><span class=p>,</span> <span class=nx>cast</span><span class=o>=</span><span class=p>(</span><span class=nx>v</span><span class=p>)=&gt;</span><span class=nx>v</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>parentElement</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;#&#34;</span> <span class=o>+</span> <span class=nx>name</span> <span class=o>+</span> <span class=s2>&#34;_value&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>values</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>cast</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>defaults</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>_default</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;input&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>values</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>cast</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>!==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>_default</span> <span class=o>!==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span> <span class=o>+</span> <span class=nx>_default</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>values</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>cast</span><span class=p>(</span><span class=nx>_default</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>!==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span> <span class=o>+</span> <span class=nx>_default</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>
</span></span><span class=line><span class=ln> 70</span><span class=cl>
</span></span><span class=line><span class=ln> 71</span><span class=cl><span class=kr>class</span> <span class=nx>Interp</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>
</span></span><span class=line><span class=ln> 73</span><span class=cl>  <span class=kr>static</span> <span class=nx>_bi_loop</span><span class=p>(</span><span class=nx>aw</span><span class=p>,</span> <span class=nx>ah</span><span class=p>,</span> <span class=nx>bw</span><span class=p>,</span> <span class=nx>bh</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>    <span class=kd>let</span> <span class=nx>cx</span><span class=p>,</span> <span class=nx>cy</span><span class=p>,</span> <span class=nx>rx</span><span class=p>,</span> <span class=nx>ry</span><span class=p>,</span> <span class=nx>ax</span><span class=p>,</span> <span class=nx>ay</span><span class=p>,</span> <span class=nx>bx</span><span class=p>,</span> <span class=nx>by</span><span class=p>,</span> <span class=nx>axl</span><span class=p>,</span> <span class=nx>axh</span><span class=p>,</span> <span class=nx>ayl</span><span class=p>,</span> <span class=nx>ayh</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>    <span class=nx>rx</span> <span class=o>=</span> <span class=p>(</span><span class=nx>aw</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=nx>bw</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl>    <span class=nx>ry</span> <span class=o>=</span> <span class=p>(</span><span class=nx>ah</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=nx>bh</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=nx>bx</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>bx</span><span class=o>&lt;</span><span class=nx>bw</span><span class=p>;</span> <span class=nx>bx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=nx>by</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>by</span><span class=o>&lt;</span><span class=nx>bh</span><span class=p>;</span> <span class=nx>by</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>        <span class=nx>axl</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>rx</span> <span class=o>*</span> <span class=nx>bx</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>        <span class=nx>axh</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>ceil</span> <span class=p>(</span><span class=nx>rx</span> <span class=o>*</span> <span class=nx>bx</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>        <span class=nx>ayl</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>ry</span> <span class=o>*</span> <span class=nx>by</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl>        <span class=nx>ayh</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>ceil</span> <span class=p>(</span><span class=nx>ry</span> <span class=o>*</span> <span class=nx>by</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>        <span class=nx>cb</span><span class=p>(</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>          <span class=nx>bx</span><span class=p>,</span> <span class=nx>by</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>          <span class=nx>axl</span><span class=p>,</span> <span class=nx>axh</span><span class=p>,</span> <span class=nx>ayl</span><span class=p>,</span> <span class=nx>ayh</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl>          <span class=nx>rx</span><span class=o>*</span><span class=nx>bx</span><span class=o>-</span><span class=nx>axl</span><span class=p>,</span> <span class=nx>ry</span><span class=o>*</span><span class=nx>by</span><span class=o>-</span><span class=nx>ayl</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl>
</span></span><span class=line><span class=ln> 92</span><span class=cl>  <span class=kr>static</span> <span class=nx>_bi_inv</span><span class=p>(</span><span class=nx>ms</span><span class=p>,</span> <span class=nx>md</span><span class=p>,</span> <span class=nx>bi_method</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl>    <span class=nx>Interp</span><span class=p>.</span><span class=nx>_bi_loop</span><span class=p>(</span><span class=nx>ms</span><span class=p>.</span><span class=nx>w</span><span class=p>,</span> <span class=nx>ms</span><span class=p>.</span><span class=nx>h</span><span class=p>,</span> <span class=nx>md</span><span class=p>.</span><span class=nx>w</span><span class=p>,</span> <span class=nx>md</span><span class=p>.</span><span class=nx>h</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>      <span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>xl</span><span class=p>,</span> <span class=nx>xh</span><span class=p>,</span> <span class=nx>yl</span><span class=p>,</span> <span class=nx>yh</span><span class=p>,</span> <span class=nx>xt</span><span class=p>,</span> <span class=nx>yt</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>x</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=nx>x</span><span class=o>&gt;=</span><span class=nx>md</span><span class=p>.</span><span class=nx>w</span> <span class=o>||</span> <span class=nx>y</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=nx>y</span><span class=o>&gt;=</span><span class=nx>md</span><span class=p>.</span><span class=nx>h</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>xl</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=nx>xl</span><span class=o>&gt;=</span><span class=nx>ms</span><span class=p>.</span><span class=nx>w</span> <span class=o>||</span> <span class=nx>yl</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=nx>yl</span><span class=o>&gt;=</span><span class=nx>ms</span><span class=p>.</span><span class=nx>h</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>xh</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=nx>xh</span><span class=o>&gt;=</span><span class=nx>ms</span><span class=p>.</span><span class=nx>w</span> <span class=o>||</span> <span class=nx>yh</span><span class=o>&lt;</span><span class=mi>0</span> <span class=o>||</span> <span class=nx>yh</span><span class=o>&gt;=</span><span class=nx>ms</span><span class=p>.</span><span class=nx>h</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>        <span class=nx>md</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>bi_method</span><span class=p>(</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>          <span class=nx>ms</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>xl</span><span class=p>,</span> <span class=nx>yl</span><span class=p>),</span> <span class=nx>ms</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>xh</span><span class=p>,</span> <span class=nx>yl</span><span class=p>),</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>          <span class=nx>ms</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>xl</span><span class=p>,</span> <span class=nx>yh</span><span class=p>),</span> <span class=nx>ms</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>xh</span><span class=p>,</span> <span class=nx>yh</span><span class=p>),</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>          <span class=nx>xt</span><span class=p>,</span> <span class=nx>yt</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>        <span class=p>));</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=ln>105</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>
</span></span><span class=line><span class=ln>107</span><span class=cl>  <span class=kr>static</span> <span class=nx>nearest</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>    <span class=k>return</span> <span class=nx>t</span> <span class=o>&gt;=</span> <span class=p>.</span><span class=mi>5</span> <span class=o>?</span> <span class=nx>b</span> <span class=o>:</span> <span class=nx>a</span><span class=p>;</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>
</span></span><span class=line><span class=ln>111</span><span class=cl>  <span class=kr>static</span> <span class=nx>binearest</span><span class=p>(</span><span class=nx>a1</span><span class=p>,</span> <span class=nx>b1</span><span class=p>,</span> <span class=nx>a2</span><span class=p>,</span> <span class=nx>b2</span><span class=p>,</span> <span class=nx>t1</span><span class=p>,</span> <span class=nx>t2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>112</span><span class=cl>    <span class=k>return</span> <span class=nx>Interp</span><span class=p>.</span><span class=nx>nearest</span><span class=p>(</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>      <span class=nx>Interp</span><span class=p>.</span><span class=nx>nearest</span><span class=p>(</span><span class=nx>a1</span><span class=p>,</span> <span class=nx>b1</span><span class=p>,</span> <span class=nx>t1</span><span class=p>),</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>      <span class=nx>Interp</span><span class=p>.</span><span class=nx>nearest</span><span class=p>(</span><span class=nx>a2</span><span class=p>,</span> <span class=nx>b2</span><span class=p>,</span> <span class=nx>t1</span><span class=p>),</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>      <span class=nx>t2</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>
</span></span><span class=line><span class=ln>119</span><span class=cl>  <span class=kr>static</span> <span class=nx>binearest_m</span><span class=p>(</span><span class=nx>ms</span><span class=p>,</span> <span class=nx>md</span><span class=p>)</span> <span class=p>{</span><span class=nx>Interp</span><span class=p>.</span><span class=nx>_bi_inv</span><span class=p>(</span><span class=nx>ms</span><span class=p>,</span> <span class=nx>md</span><span class=p>,</span> <span class=nx>Interp</span><span class=p>.</span><span class=nx>binearest</span><span class=p>);};</span>
</span></span><span class=line><span class=ln>120</span><span class=cl>
</span></span><span class=line><span class=ln>121</span><span class=cl>  <span class=kr>static</span> <span class=nx>linear</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>122</span><span class=cl>    <span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=p>(</span><span class=nx>b</span> <span class=o>-</span> <span class=nx>a</span><span class=p>)</span> <span class=o>*</span> <span class=nx>t</span>
</span></span><span class=line><span class=ln>123</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>124</span><span class=cl>
</span></span><span class=line><span class=ln>125</span><span class=cl>  <span class=kr>static</span> <span class=nx>bilinear</span><span class=p>(</span><span class=nx>a1</span><span class=p>,</span> <span class=nx>b1</span><span class=p>,</span> <span class=nx>a2</span><span class=p>,</span> <span class=nx>b2</span><span class=p>,</span> <span class=nx>t1</span><span class=p>,</span> <span class=nx>t2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>126</span><span class=cl>    <span class=k>return</span> <span class=nx>Interp</span><span class=p>.</span><span class=nx>linear</span><span class=p>(</span>
</span></span><span class=line><span class=ln>127</span><span class=cl>      <span class=nx>Interp</span><span class=p>.</span><span class=nx>linear</span><span class=p>(</span><span class=nx>a1</span><span class=p>,</span> <span class=nx>b1</span><span class=p>,</span> <span class=nx>t1</span><span class=p>),</span>
</span></span><span class=line><span class=ln>128</span><span class=cl>      <span class=nx>Interp</span><span class=p>.</span><span class=nx>linear</span><span class=p>(</span><span class=nx>a2</span><span class=p>,</span> <span class=nx>b2</span><span class=p>,</span> <span class=nx>t1</span><span class=p>),</span>
</span></span><span class=line><span class=ln>129</span><span class=cl>      <span class=nx>t2</span>
</span></span><span class=line><span class=ln>130</span><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=ln>131</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>132</span><span class=cl>
</span></span><span class=line><span class=ln>133</span><span class=cl>  <span class=kr>static</span> <span class=nx>bilinear_m</span><span class=p>(</span><span class=nx>ms</span><span class=p>,</span> <span class=nx>md</span><span class=p>)</span> <span class=p>{</span><span class=nx>Interp</span><span class=p>.</span><span class=nx>_bi_inv</span><span class=p>(</span><span class=nx>ms</span><span class=p>,</span> <span class=nx>md</span><span class=p>,</span> <span class=nx>Interp</span><span class=p>.</span><span class=nx>bilinear</span><span class=p>)};</span>
</span></span><span class=line><span class=ln>134</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>135</span><span class=cl>
</span></span><span class=line><span class=ln>136</span><span class=cl>
</span></span><span class=line><span class=ln>137</span><span class=cl><span class=kr>class</span> <span class=nx>ac2DMatrix</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>138</span><span class=cl>  <span class=nx>itox</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span> <span class=p>{</span><span class=k>return</span> <span class=nx>i</span> <span class=o>%</span> <span class=k>this</span><span class=p>.</span><span class=nx>w</span><span class=p>};</span>
</span></span><span class=line><span class=ln>139</span><span class=cl>  <span class=nx>itoy</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span> <span class=p>{</span><span class=k>return</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>i</span> <span class=o>/</span> <span class=k>this</span><span class=p>.</span><span class=nx>w</span><span class=p>)};</span>
</span></span><span class=line><span class=ln>140</span><span class=cl>  <span class=nx>ctoi</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>{</span><span class=k>return</span> <span class=nx>x</span> <span class=o>+</span> <span class=p>(</span><span class=nx>y</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>w</span><span class=p>)};</span>
</span></span><span class=line><span class=ln>141</span><span class=cl>  <span class=nx>get</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>{</span><span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>ctoi</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)]};</span>
</span></span><span class=line><span class=ln>142</span><span class=cl>  <span class=nx>set</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>v</span><span class=p>)</span> <span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>ctoi</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)]</span> <span class=o>=</span> <span class=nx>v</span><span class=p>;};</span>
</span></span><span class=line><span class=ln>143</span><span class=cl>  <span class=nx>map</span><span class=p>(</span><span class=nx>cb</span><span class=p>)</span> <span class=p>{</span><span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>){</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>cb</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>])}};</span>
</span></span><span class=line><span class=ln>144</span><span class=cl>  <span class=nx>zeros</span><span class=p>()</span> <span class=p>{</span><span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>}};</span>
</span></span><span class=line><span class=ln>145</span><span class=cl>  <span class=nx>sum</span><span class=p>()</span> <span class=p>{</span><span class=kd>let</span> <span class=nx>s</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span><span class=nx>s</span><span class=o>+=</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>]};</span> <span class=k>return</span> <span class=nx>s</span><span class=p>};</span>
</span></span><span class=line><span class=ln>146</span><span class=cl>  <span class=nx>count</span><span class=p>(</span><span class=nx>o</span><span class=p>)</span> <span class=p>{</span><span class=kd>let</span> <span class=nx>s</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span><span class=k>if</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=o>===</span><span class=nx>o</span><span class=p>){</span><span class=nx>s</span><span class=o>+=</span><span class=mi>1</span><span class=p>}};</span> <span class=k>return</span> <span class=nx>s</span><span class=p>};</span>
</span></span><span class=line><span class=ln>147</span><span class=cl>  <span class=nx>load2DArray</span><span class=p>(</span><span class=nx>arr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>148</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>x</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>x</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>w</span><span class=p>;</span> <span class=nx>x</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>149</span><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>y</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>y</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>h</span><span class=p>;</span> <span class=nx>y</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>150</span><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>y</span><span class=p>][</span><span class=nx>x</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>151</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln>152</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln>153</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>154</span><span class=cl>  <span class=nx>to2DArray</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>155</span><span class=cl>    <span class=kd>let</span> <span class=nx>r</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=ln>156</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>y</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>y</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>h</span><span class=p>;</span> <span class=nx>y</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>157</span><span class=cl>      <span class=nx>r</span><span class=p>.</span><span class=nx>push</span><span class=p>([]);</span>
</span></span><span class=line><span class=ln>158</span><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>x</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>x</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>w</span><span class=p>;</span> <span class=nx>x</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>159</span><span class=cl>        <span class=nx>r</span><span class=p>[</span><span class=nx>y</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>));</span>
</span></span><span class=line><span class=ln>160</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln>161</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln>162</span><span class=cl>    <span class=k>return</span> <span class=nx>r</span><span class=p>;</span>
</span></span><span class=line><span class=ln>163</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>164</span><span class=cl>  <span class=nx>queryKernel</span><span class=p>(</span><span class=nx>mk</span><span class=p>,</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>wrap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>165</span><span class=cl>    <span class=kr>const</span> <span class=nx>lx</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>mk</span><span class=p>.</span><span class=nx>w</span><span class=o>/</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=ln>166</span><span class=cl>    <span class=kr>const</span> <span class=nx>ly</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>mk</span><span class=p>.</span><span class=nx>h</span><span class=o>/</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=ln>167</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>kx</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>kx</span><span class=o>&lt;</span><span class=nx>mk</span><span class=p>.</span><span class=nx>w</span><span class=p>;</span> <span class=nx>kx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>168</span><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>ky</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>ky</span><span class=o>&lt;</span><span class=nx>mk</span><span class=p>.</span><span class=nx>h</span><span class=p>;</span> <span class=nx>ky</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>169</span><span class=cl>        <span class=kd>let</span> <span class=nx>dx</span> <span class=o>=</span> <span class=nx>x</span><span class=o>+</span><span class=nx>kx</span><span class=o>-</span><span class=nx>lx</span><span class=p>;</span>
</span></span><span class=line><span class=ln>170</span><span class=cl>        <span class=kd>let</span> <span class=nx>dy</span> <span class=o>=</span> <span class=nx>y</span><span class=o>+</span><span class=nx>ky</span><span class=o>-</span><span class=nx>ly</span><span class=p>;</span>
</span></span><span class=line><span class=ln>171</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>wrap</span><span class=o>||</span><span class=kc>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>172</span><span class=cl>          <span class=nx>dx</span> <span class=o>=</span> <span class=nx>iwrap</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>w</span><span class=p>)</span>
</span></span><span class=line><span class=ln>173</span><span class=cl>          <span class=nx>dy</span> <span class=o>=</span> <span class=nx>iwrap</span><span class=p>(</span><span class=nx>dy</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>h</span><span class=p>)</span>
</span></span><span class=line><span class=ln>174</span><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=ln>175</span><span class=cl>        <span class=nx>mk</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>kx</span><span class=p>,</span> <span class=nx>ky</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span> <span class=nx>dy</span><span class=p>)</span> <span class=o>||</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=ln>176</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln>177</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln>178</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>179</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>180</span><span class=cl>
</span></span><span class=line><span class=ln>181</span><span class=cl>
</span></span><span class=line><span class=ln>182</span><span class=cl><span class=kr>class</span> <span class=nx>cFloat32Matrix</span> <span class=kr>extends</span> <span class=nx>ac2DMatrix</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>183</span><span class=cl>  <span class=nx>constructor</span> <span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>184</span><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=ln>185</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>w</span> <span class=o>=</span> <span class=nx>w</span><span class=p>;</span> <span class=k>this</span><span class=p>.</span><span class=nx>h</span> <span class=o>=</span> <span class=nx>h</span><span class=p>;</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>=</span> <span class=nx>w</span><span class=o>*</span><span class=nx>h</span><span class=p>;</span>
</span></span><span class=line><span class=ln>186</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>buf</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Float32Array</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=ln>187</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>188</span><span class=cl>  <span class=nx>unloadImageData</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>189</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=nx>data</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>+=</span><span class=mi>4</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>190</span><span class=cl>      <span class=kd>let</span> <span class=nx>p</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>ftoi</span><span class=p>(</span><span class=nx>i</span><span class=o>/</span><span class=mi>4</span><span class=p>)];</span>
</span></span><span class=line><span class=ln>191</span><span class=cl>      <span class=nx>p</span> <span class=o>=</span> <span class=nx>p</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=nx>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>192</span><span class=cl>      <span class=nx>p</span> <span class=o>=</span> <span class=nx>p</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>193</span><span class=cl>      <span class=nx>p</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>p</span> <span class=o>*</span> <span class=mi>255</span><span class=p>);</span>
</span></span><span class=line><span class=ln>194</span><span class=cl>      <span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>195</span><span class=cl>      <span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=nx>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>196</span><span class=cl>      <span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=nx>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>197</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln>198</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>199</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>200</span><span class=cl>
</span></span><span class=line><span class=ln>201</span><span class=cl><span class=kr>class</span> <span class=nx>cComplexMatrix</span> <span class=kr>extends</span> <span class=nx>ac2DMatrix</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>202</span><span class=cl>  <span class=nx>constructor</span> <span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>203</span><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=ln>204</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>w</span> <span class=o>=</span> <span class=nx>w</span><span class=p>;</span> <span class=k>this</span><span class=p>.</span><span class=nx>h</span> <span class=o>=</span> <span class=nx>h</span><span class=p>;</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>=</span> <span class=nx>w</span><span class=o>*</span><span class=nx>h</span><span class=p>;</span>
</span></span><span class=line><span class=ln>205</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>buf</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>206</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>y</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>y</span><span class=o>&lt;</span><span class=nx>h</span><span class=p>;</span> <span class=nx>y</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>207</span><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>x</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>x</span><span class=o>&lt;</span><span class=nx>w</span><span class=p>;</span> <span class=nx>x</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>208</span><span class=cl>        <span class=c1>// this.buf.push(new Complex(x/(w-1)-.5, y/(h-1)-.5))
</span></span></span><span class=line><span class=ln>209</span><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>new</span> <span class=nx>Complex</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=ln>210</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln>211</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln>212</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>213</span><span class=cl>  <span class=nx>set</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>im</span><span class=p>,</span> <span class=nx>re</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>214</span><span class=cl>    <span class=kd>let</span> <span class=nx>c</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>ctoi</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)];</span>
</span></span><span class=line><span class=ln>215</span><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>im</span> <span class=o>=</span> <span class=nx>im</span><span class=o>||</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>216</span><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>re</span> <span class=o>=</span> <span class=nx>re</span><span class=o>||</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>217</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>218</span><span class=cl>  <span class=nx>zeros</span><span class=p>()</span> <span class=p>{</span><span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>im</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>re</span><span class=o>=</span><span class=mi>0</span><span class=p>;}};</span>
</span></span><span class=line><span class=ln>219</span><span class=cl>  <span class=nx>sum</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>220</span><span class=cl>    <span class=kd>let</span> <span class=nx>s</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Complex</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>221</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span><span class=nx>s</span><span class=p>.</span><span class=nx>addc</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>])};</span>
</span></span><span class=line><span class=ln>222</span><span class=cl>    <span class=k>return</span> <span class=nx>s</span>
</span></span><span class=line><span class=ln>223</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>224</span><span class=cl>  <span class=nx>count</span><span class=p>(</span><span class=nx>o</span><span class=p>)</span> <span class=p>{</span><span class=k>throw</span> <span class=s2>&#34;matrix count method is not defined&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=ln>225</span><span class=cl>  <span class=nx>load2DArray</span><span class=p>(</span><span class=nx>arr</span><span class=p>)</span> <span class=p>{</span><span class=k>throw</span> <span class=s2>&#34;matrix load2DArray method is not defined&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=ln>226</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>227</span><span class=cl>
</span></span><span class=line><span class=ln>228</span><span class=cl>
</span></span><span class=line><span class=ln>229</span><span class=cl><span class=kr>class</span> <span class=nx>MandelbrotSet</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>230</span><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>h</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>231</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>buffer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>cFloat32Matrix</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>h</span><span class=p>);</span>
</span></span><span class=line><span class=ln>232</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>z</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Complex</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>233</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>c</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Complex</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>234</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>thresh_re</span> <span class=o>=</span> <span class=mf>1e3</span><span class=p>;</span>
</span></span><span class=line><span class=ln>235</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>thresh_im</span> <span class=o>=</span> <span class=mf>1e3</span><span class=p>;</span>
</span></span><span class=line><span class=ln>236</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>237</span><span class=cl>  <span class=nx>is_oob</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>238</span><span class=cl>    <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>abs</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>.</span><span class=nx>re</span><span class=p>)</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>thresh_re</span> <span class=o>||</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>abs</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>.</span><span class=nx>im</span><span class=p>)</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>thresh_im</span>
</span></span><span class=line><span class=ln>239</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>240</span><span class=cl>  <span class=nx>compute</span><span class=p>(</span><span class=nx>iter</span><span class=p>,</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>scale</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>241</span><span class=cl>    <span class=nx>scale</span> <span class=o>=</span> <span class=nx>scale</span><span class=o>||</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>242</span><span class=cl>    <span class=nx>x</span> <span class=o>=</span> <span class=nx>x</span><span class=o>||</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>243</span><span class=cl>    <span class=nx>y</span> <span class=o>=</span> <span class=nx>y</span><span class=o>||</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>244</span><span class=cl>    <span class=nx>iter</span> <span class=o>=</span> <span class=nx>iter</span><span class=o>||</span><span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=ln>245</span><span class=cl>    <span class=kd>let</span> <span class=nx>cv</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=nx>pv</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=nx>dv</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>246</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=k>this</span><span class=p>.</span><span class=nx>buffer</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>247</span><span class=cl>      <span class=kd>let</span> <span class=nx>rx</span><span class=o>=</span><span class=k>this</span><span class=p>.</span><span class=nx>buffer</span><span class=p>.</span><span class=nx>itox</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span><span class=o>/</span><span class=k>this</span><span class=p>.</span><span class=nx>buffer</span><span class=p>.</span><span class=nx>w</span><span class=o>-</span><span class=p>.</span><span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=ln>248</span><span class=cl>      <span class=kd>let</span> <span class=nx>ry</span><span class=o>=</span><span class=k>this</span><span class=p>.</span><span class=nx>buffer</span><span class=p>.</span><span class=nx>itoy</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span><span class=o>/</span><span class=k>this</span><span class=p>.</span><span class=nx>buffer</span><span class=p>.</span><span class=nx>h</span><span class=o>-</span><span class=p>.</span><span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=ln>249</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>c</span><span class=p>.</span><span class=nx>re</span> <span class=o>=</span> <span class=nx>rx</span><span class=o>*</span><span class=nx>scale</span><span class=o>+</span><span class=nx>x</span><span class=p>;</span>
</span></span><span class=line><span class=ln>250</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>c</span><span class=p>.</span><span class=nx>im</span> <span class=o>=</span> <span class=nx>ry</span><span class=o>*</span><span class=nx>scale</span><span class=o>+</span><span class=nx>y</span><span class=p>;</span>
</span></span><span class=line><span class=ln>251</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>.</span><span class=nx>re</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>252</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>.</span><span class=nx>im</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>253</span><span class=cl>      <span class=kd>let</span> <span class=nx>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>254</span><span class=cl>      <span class=nx>cv</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>pv</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>dv</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>255</span><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=nx>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>j</span><span class=o>&lt;</span><span class=nx>iter</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=ln>256</span><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>.</span><span class=nx>mulc</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>);</span>
</span></span><span class=line><span class=ln>257</span><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>.</span><span class=nx>addc</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>c</span><span class=p>);</span>
</span></span><span class=line><span class=ln>258</span><span class=cl>        <span class=nx>pv</span> <span class=o>=</span> <span class=nx>cv</span><span class=p>;</span>
</span></span><span class=line><span class=ln>259</span><span class=cl>        <span class=nx>cv</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=p>.</span><span class=nx>magnitude</span><span class=p>();</span>
</span></span><span class=line><span class=ln>260</span><span class=cl>        <span class=nx>dv</span> <span class=o>=</span> <span class=nx>cv</span> <span class=o>-</span> <span class=nx>pv</span><span class=p>;</span>
</span></span><span class=line><span class=ln>261</span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>is_oob</span><span class=p>())</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>262</span><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=ln>263</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>buffer</span><span class=p>.</span><span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>dv</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>j</span><span class=o>/</span><span class=nx>iter</span><span class=p>;</span>
</span></span><span class=line><span class=ln>264</span><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=ln>265</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>266</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>267</span><span class=cl>
</span></span><span class=line><span class=ln>268</span><span class=cl><span class=c1>// ===========================================
</span></span></span><span class=line><span class=ln>269</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>270</span><span class=cl><span class=kd>function</span> <span class=nx>renderCanvas</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>271</span><span class=cl>  <span class=kd>let</span> <span class=nx>imd</span> <span class=o>=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>getImageData</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>height</span><span class=p>);</span>
</span></span><span class=line><span class=ln>272</span><span class=cl>  <span class=nx>Interp</span><span class=p>.</span><span class=nx>bilinear_m</span><span class=p>(</span><span class=nx>fractals</span><span class=p>[</span><span class=s1>&#39;mandelbrot&#39;</span><span class=p>].</span><span class=nx>buffer</span><span class=p>,</span> <span class=nx>frame</span><span class=p>);</span>
</span></span><span class=line><span class=ln>273</span><span class=cl>  <span class=nx>frame</span><span class=p>.</span><span class=nx>unloadImageData</span><span class=p>(</span><span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=ln>274</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>putImageData</span><span class=p>(</span><span class=nx>imd</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>275</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>276</span><span class=cl>
</span></span><span class=line><span class=ln>277</span><span class=cl>
</span></span><span class=line><span class=ln>278</span><span class=cl><span class=kd>function</span> <span class=nx>appInit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>279</span><span class=cl>  <span class=nx>frame</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>cFloat32Matrix</span><span class=p>(</span><span class=nx>canvas</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>height</span><span class=p>);</span>
</span></span><span class=line><span class=ln>280</span><span class=cl>  <span class=nx>fractals</span><span class=p>[</span><span class=s1>&#39;mandelbrot&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MandelbrotSet</span><span class=p>(</span><span class=mi>800</span><span class=p>,</span> <span class=mi>800</span><span class=p>);</span>
</span></span><span class=line><span class=ln>281</span><span class=cl>  <span class=nx>inputProxy</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>cInputProxy</span><span class=p>();</span>
</span></span><span class=line><span class=ln>282</span><span class=cl>  <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;OffsetX&#39;</span><span class=p>,</span> <span class=o>-</span><span class=p>.</span><span class=mi>743643887037151</span><span class=p>,</span> <span class=nb>parseFloat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>283</span><span class=cl>  <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;OffsetY&#39;</span><span class=p>,</span> <span class=p>.</span><span class=mi>131825904205330</span><span class=p>,</span> <span class=nb>parseFloat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>284</span><span class=cl>  <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;Zoom&#39;</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=nb>parseFloat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>285</span><span class=cl>  <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;Iter&#39;</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=nb>parseInt</span><span class=p>);</span>
</span></span><span class=line><span class=ln>286</span><span class=cl>  <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;Compute&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=ln>287</span><span class=cl>    <span class=nx>appUpdate</span><span class=p>();</span>
</span></span><span class=line><span class=ln>288</span><span class=cl>    <span class=nx>renderCanvas</span><span class=p>();</span>
</span></span><span class=line><span class=ln>289</span><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=ln>290</span><span class=cl>  <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;Reset&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=ln>291</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>Iter</span> <span class=o>=</span> <span class=mi>50</span><span class=p>;</span>
</span></span><span class=line><span class=ln>292</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>OffsetX</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>293</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>OffsetY</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>294</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>Zoom</span> <span class=o>=</span> <span class=mf>0.33</span><span class=p>;</span>
</span></span><span class=line><span class=ln>295</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>Iter</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>50</span><span class=p>;</span>
</span></span><span class=line><span class=ln>296</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>OffsetX</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>297</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>OffsetY</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>298</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>Zoom</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=mf>0.33</span><span class=p>;</span>
</span></span><span class=line><span class=ln>299</span><span class=cl>    <span class=nx>appUpdate</span><span class=p>();</span>
</span></span><span class=line><span class=ln>300</span><span class=cl>    <span class=nx>renderCanvas</span><span class=p>();</span>
</span></span><span class=line><span class=ln>301</span><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=ln>302</span><span class=cl>  <span class=nx>appUpdate</span><span class=p>();</span>
</span></span><span class=line><span class=ln>303</span><span class=cl>  <span class=nx>renderCanvas</span><span class=p>();</span>
</span></span><span class=line><span class=ln>304</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>305</span><span class=cl>
</span></span><span class=line><span class=ln>306</span><span class=cl><span class=kd>function</span> <span class=nx>appUpdate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>307</span><span class=cl>  <span class=nx>fractals</span><span class=p>[</span><span class=s1>&#39;mandelbrot&#39;</span><span class=p>].</span><span class=nx>compute</span><span class=p>(</span>
</span></span><span class=line><span class=ln>308</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>Iter</span><span class=p>,</span>
</span></span><span class=line><span class=ln>309</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>OffsetX</span><span class=p>,</span>
</span></span><span class=line><span class=ln>310</span><span class=cl>    <span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>OffsetY</span><span class=p>,</span>
</span></span><span class=line><span class=ln>311</span><span class=cl>    <span class=mi>1</span><span class=o>/</span><span class=nx>inputProxy</span><span class=p>.</span><span class=nx>values</span><span class=p>.</span><span class=nx>Zoom</span>
</span></span><span class=line><span class=ln>312</span><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=ln>313</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>314</span><span class=cl>
</span></span><span class=line><span class=ln>315</span><span class=cl>
</span></span><span class=line><span class=ln>316</span><span class=cl><span class=nx>appInit</span><span class=p>()</span>
</span></span><span class=line><span class=ln>317</span><span class=cl><span class=c1>// fractals[&#39;mandelbrot&#39;].compute(ii, -.743643887037151, .131825904205330, 1/50);
</span></span></span><span class=line><span class=ln>318</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>319</span><span class=cl><span class=p>};</span></span></span></code></pre></div><script defer>window.onload=function(){const o=document.getElementById("viewport"),l=o.getContext("2d",{alpha:!1}),n=e=>~~e;var a=null,i={},e=null;class s{constructor(e,t){this.re=e||0,this.im=t||0}addc(e){return this.re+=e.re,this.im+=e.im,this}mulc(e){let t=this.re*e.re-this.im*e.im,n=this.re*e.im+this.im*e.re;return this.re=t,this.im=n,this}divc(e){let t=e.re,n=e.im;return e.inverse_i(),this.mulc(e),e.re=t,e.im=n,this}square(){return this.re**2+this.im**2}conjugate_i(){this.im*=-1}inverse_i(){let e=this.square();return this.re=this.re/e,this.im=-this.im/e,this}inverse(){return new s(this.re,this.im).inverse_i()}magnitude(){return Math.sqrt(this.square())}}function h(){this.values={},this.target={},this.display={},this.defaults={},this.register=(e,t=null,n=e=>e)=>(this.target[e]=document.getElementById(e),this.display[e]=this.target[e].parentElement.querySelector("#"+e+"_value"),this.values[e]=n(this.target[e].value),this.defaults[e]=t,this.target[e].addEventListener("input",t=>{this.values[e]=n(t.target.value),this.display[e]!==null&&(this.display[e].innerHTML=""+t.target.value)}),t!==null&&(this.target[e].value=""+t,this.values[e]=n(t),this.display[e]!==null&&(this.display[e].innerHTML=""+t)),this.target[e])}class t{static _bi_loop(e,t,n,s,o){let m,f,r,c,p,g,i,a,l,u,d,h;r=(e-2)/(n-1),c=(t-2)/(s-1);for(i=0;i<n;i++)for(a=0;a<s;a++)l=Math.floor(r*i),u=Math.ceil(r*i),d=Math.floor(c*a),h=Math.ceil(c*a),o(i,a,l,u,d,h,r*i-l,c*a-d)}static _bi_inv(e,n,s){t._bi_loop(e.w,e.h,n.w,n.h,(t,o,i,a,r,c,l,d)=>{if(t<0||t>=n.w||o<0||o>=n.h)return;if(i<0||i>=e.w||r<0||r>=e.h)return;if(a<0||a>=e.w||c<0||c>=e.h)return;n.set(t,o,s(e.get(i,r),e.get(a,r),e.get(i,c),e.get(a,c),l,d))})}static nearest(e,t,n){return n>=.5?t:e}static binearest(e,n,s,o,i,a){return t.nearest(t.nearest(e,n,i),t.nearest(s,o,i),a)}static binearest_m(e,n){t._bi_inv(e,n,t.binearest)}static linear(e,t,n){return e+(t-e)*n}static bilinear(e,n,s,o,i,a){return t.linear(t.linear(e,n,i),t.linear(s,o,i),a)}static bilinear_m(e,n){t._bi_inv(e,n,t.bilinear)}}class d{itox(e){return e%this.w}itoy(e){return n(e/this.w)}ctoi(e,t){return e+t*this.w}get(e,t){return this.buf[this.ctoi(e,t)]}set(e,t,n){this.buf[this.ctoi(e,t)]=n}map(e){for(let t=0;t<this.length;t++)this.buf[t]=e(this.buf[t])}zeros(){for(let e=0;e<this.length;e++)this.buf[e]=0}sum(){let e=0;for(let t=0;t<this.length;t++)e+=this.buf[t];return e}count(e){let t=0;for(let n=0;n<this.length;n++)this.buf[n]===e&&(t+=1);return t}load2DArray(e){for(let t=0;t<this.w;t++)for(let n=0;n<this.h;n++)this.set(t,n,e[n][t])}to2DArray(){let e=[];for(let t=0;t<this.h;t++){e.push([]);for(let n=0;n<this.w;n++)e[t].push(this.get(n,t))}return e}queryKernel(e,t,s,o){const i=n(e.w/2),a=n(e.h/2);for(let n=0;n<e.w;n++)for(let r=0;r<e.h;r++){let c=t+n-i,l=s+r-a;(o||!1)&&(c=iwrap(c,this.w),l=iwrap(l,this.h)),e.set(n,r,this.get(c,l)||null)}}}class u extends d{constructor(e,t){super(),this.w=e,this.h=t,this.length=e*t,this.buf=new Float32Array(this.length)}unloadImageData(e){for(let s=0;s<e.length;s+=4){let t=this.buf[n(s/4)];t=t>1?1:t,t=t<0?0:t,t=n(t*255),e[s+0]=t,e[s+1]=t,e[s+2]=t}}}class p extends d{constructor(e,t){super(),this.w=e,this.h=t,this.length=e*t,this.buf=[];for(let n=0;n<t;n++)for(let t=0;t<e;t++)this.buf.push(new s(0,0))}set(e,t,n,s){let o=this.buf[this.ctoi(e,t)];o.im=n||0,o.re=s||0}zeros(){for(let e=0;e<this.length;e++)this.buf[e].im=0,this.buf[e].re=0}sum(){let e=new s(0,0);for(let t=0;t<this.length;t++)e.addc(this.buf[t]);return e}count(){throw"matrix count method is not defined"}load2DArray(){throw"matrix load2DArray method is not defined"}}class m{constructor(e,t){this.buffer=new u(e,t),this.z=new s(0,0),this.c=new s(0,0),this.thresh_re=1e3,this.thresh_im=1e3}is_oob(){return Math.abs(this.z.re)>this.thresh_re||Math.abs(this.z.im)>this.thresh_im}compute(e,t,n,s){s=s||1,t=t||0,n=n||0,e=e||10;let o=0,i=0,a=0;for(let r=0;r<this.buffer.length;r++){let l=this.buffer.itox(r)/this.buffer.w-.5,d=this.buffer.itoy(r)/this.buffer.h-.5;this.c.re=l*s+t,this.c.im=d*s+n,this.z.re=0,this.z.im=0;let c=0;o=0,i=0,a=0;for(c=0;c<e;c++)if(this.z.mulc(this.z),this.z.addc(this.c),i=o,o=this.z.magnitude(),a=o-i,this.is_oob())break;this.buffer.buf[r]=a<2?0:c/e}}}function r(){let e=l.getImageData(0,0,o.width,o.height);t.bilinear_m(i.mandelbrot.buffer,a),a.unloadImageData(e.data),l.putImageData(e,0,0)}function f(){a=new u(o.width,o.height),i.mandelbrot=new m(800,800),e=new h,e.register("OffsetX",-.743643887037151,parseFloat),e.register("OffsetY",.13182590420533,parseFloat),e.register("Zoom",50,parseFloat),e.register("Iter",80,parseInt),e.register("Compute").addEventListener("click",e=>{c(),r()}),e.register("Reset").addEventListener("click",t=>{e.values.Iter=50,e.values.OffsetX=-1,e.values.OffsetY=0,e.values.Zoom=.33,e.target.Iter.value=50,e.target.OffsetX.value=-1,e.target.OffsetY.value=0,e.target.Zoom.value=.33,c(),r()}),c(),r()}function c(){i.mandelbrot.compute(e.values.Iter,e.values.OffsetX,e.values.OffsetY,1/e.values.Zoom)}f()}</script></div><br><br><br><br><p class=tc>Built with <a a target=_blank class=extern href=https://gohugo.io/>Hugo</a> | previoip (c) 2025</p></body></html>