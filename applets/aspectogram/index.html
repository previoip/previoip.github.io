<!doctype html><html lang=en><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HTK24ZVY8")}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href="/css/highlight.css?v=1.0.0"><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}small{font-size:calc(var(--f)*.82)}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}p canvas{outline:1px solid #000;width:calc(100% - var(--f)*1.6)}a{color:#1c69e5;text-decoration:underline}a:hover{color:#2072f5;text-decoration:none}a:active{color:#0062ff;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:#43454ce6;border-radius:3px}::-webkit-scrollbar-thumb{background:#c1cdf6e6;border-radius:3px}#control div{display:flex;align-items:center}#control input{display:inline-block;margin:0 .5em}#control p{margin:0}</style><title>audio spectogram &ndash; dumb by default</title></head><body><div style=background-color:#69696969><br><h1 class=tc>dumb by default</h1><nav class=tc>[<a href=/>Home</a>]&nbsp;[<a href=/about/>About</a>]&nbsp;[<a href=/posts/>Posts</a>]&nbsp;[<a href=/resources/>Resources</a>]&nbsp;[<a href=/applets/>Applets</a>]&nbsp;</nav><hr></div><p style=padding:0><span>dir: <i><a href=/>Home</a> /
<a href=/applets/>Applets</a> /
<span>audio spectogram</span></i></span><br><span>published-date: 23 May 2025 16:58 +0700</span><br></p><h1 class=tc>audio spectogram</h1><hr><div><p><canvas id=viewport width=720 height=512></canvas></p><div id=control><div><input id=clearCanvas type=button value=clear></div></div><div class=highlight id=code inject=true><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=ln>  1</span><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>
</span></span><span class=line><span class=ln>  4</span><span class=cl><span class=kr>const</span> <span class=nx>ftoi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>v</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=o>~~</span><span class=nx>v</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl><span class=kr>const</span> <span class=nx>canvas</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;viewport&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl><span class=kr>const</span> <span class=nx>ctx</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>getContext</span><span class=p>(</span><span class=s2>&#34;2d&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;alpha&#34;</span><span class=o>:</span><span class=kc>false</span><span class=p>});</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl><span class=kr>const</span> <span class=nx>w</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl><span class=kr>const</span> <span class=nx>h</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl><span class=kr>const</span> <span class=nx>buf</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>({</span><span class=nx>length</span><span class=o>:</span><span class=nx>h</span><span class=p>},</span> <span class=nx>_</span><span class=p>=&gt;[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl><span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>cTimer</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl><span class=kr>const</span> <span class=nx>inputElProxy</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>cInputElementValuesProxy</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>
</span></span><span class=line><span class=ln> 13</span><span class=cl>
</span></span><span class=line><span class=ln> 14</span><span class=cl><span class=kd>function</span> <span class=nx>f_p</span><span class=p>(</span><span class=nx>samples</span><span class=p>,</span> <span class=nx>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>  <span class=kr>const</span> <span class=nx>n</span> <span class=o>=</span> <span class=nx>p</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>  <span class=kd>let</span> <span class=nx>sums</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl>  <span class=k>return</span> <span class=nx>samples</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>    <span class=p>(</span><span class=nx>s</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>        <span class=nx>sums</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>m</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>m</span><span class=o>&lt;</span><span class=nx>n</span><span class=p>;</span> <span class=nx>m</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>          <span class=nx>sums</span> <span class=o>+=</span> <span class=nx>s</span><span class=o>**</span><span class=p>(</span><span class=nx>n</span><span class=o>-</span><span class=nx>m</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=nx>p</span><span class=p>[</span><span class=nx>m</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>        <span class=nx>sums</span> <span class=o>=</span> <span class=nx>sums</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=nx>sums</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>        <span class=nx>sums</span> <span class=o>=</span> <span class=nx>sums</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>sums</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>        <span class=k>return</span> <span class=nx>sums</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>
</span></span><span class=line><span class=ln> 30</span><span class=cl><span class=kr>class</span> <span class=nx>cColorMap</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>p_r</span><span class=p>,</span> <span class=nx>p_g</span><span class=p>,</span> <span class=nx>p_b</span><span class=p>,</span> <span class=nx>n_samples</span><span class=o>=</span><span class=mi>512</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>n_samples</span> <span class=o>=</span> <span class=nx>n_samples</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>samples</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>({</span><span class=nx>length</span><span class=o>:</span><span class=nx>n_samples</span><span class=p>},</span> <span class=p>(</span><span class=nx>_</span><span class=p>,</span> <span class=nx>k</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>k</span><span class=o>/</span><span class=p>(</span><span class=nx>n_samples</span><span class=o>-</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>cmap</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl>      <span class=nx>f_p</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>samples</span><span class=p>,</span> <span class=nx>p_r</span><span class=p>),</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>      <span class=nx>f_p</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>samples</span><span class=p>,</span> <span class=nx>p_g</span><span class=p>),</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>      <span class=nx>f_p</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>samples</span><span class=p>,</span> <span class=nx>p_b</span><span class=p>),</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>samples</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>_</span><span class=p>=&gt;</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>  <span class=nx>c</span><span class=p>(</span><span class=nx>v</span><span class=p>,</span> <span class=nx>pbuf</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>    <span class=nx>pbuf</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>arrLinterp</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>cmap</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>v</span><span class=p>)</span><span class=o>*</span><span class=mi>255</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>    <span class=nx>pbuf</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>arrLinterp</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>cmap</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>v</span><span class=p>)</span><span class=o>*</span><span class=mi>255</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl>    <span class=nx>pbuf</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>arrLinterp</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>cmap</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nx>v</span><span class=p>)</span><span class=o>*</span><span class=mi>255</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>    <span class=nx>pbuf</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>arrLinterp</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>cmap</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=nx>v</span><span class=p>)</span><span class=o>*</span><span class=mi>255</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl>
</span></span><span class=line><span class=ln> 49</span><span class=cl><span class=kr>const</span> <span class=nx>p_r</span> <span class=o>=</span> <span class=p>[</span> <span class=mf>1.6557762312002666</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span> <span class=o>-</span><span class=mf>5.0765628176037012</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span>  <span class=mf>3.6114437522600484</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span> <span class=mf>7.5501780705212251</span><span class=nx>e</span><span class=o>-</span><span class=mi>01</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.0159038301211065</span><span class=nx>e</span><span class=o>-</span><span class=mi>02</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl><span class=kr>const</span> <span class=nx>p_g</span> <span class=o>=</span> <span class=p>[</span><span class=o>-</span><span class=mf>2.0627850606099467</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span>  <span class=mf>4.4300104345314564</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.8488324386347577</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span> <span class=mf>5.0539609607001779</span><span class=nx>e</span><span class=o>-</span><span class=mi>01</span><span class=p>,</span> <span class=o>-</span><span class=mf>1.5872300948496232</span><span class=nx>e</span><span class=o>-</span><span class=mi>03</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl><span class=kr>const</span> <span class=nx>p_b</span> <span class=o>=</span> <span class=p>[</span> <span class=mf>7.0917066940883133</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span> <span class=o>-</span><span class=mf>6.6777021038402200</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span> <span class=o>-</span><span class=mf>2.3104640769293701</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span> <span class=mf>2.5883795816309192</span><span class=nx>e</span><span class=o>+</span><span class=mi>00</span><span class=p>,</span>  <span class=mf>2.6268954622100660</span><span class=nx>e</span><span class=o>-</span><span class=mi>03</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl><span class=kr>const</span> <span class=nx>cmap</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>cColorMap</span><span class=p>(</span><span class=nx>p_r</span><span class=p>,</span> <span class=nx>p_g</span><span class=p>,</span> <span class=nx>p_b</span><span class=p>,</span> <span class=mi>512</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl><span class=kd>var</span> <span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=nx>x</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=nx>y</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=nx>l</span><span class=p>,</span> <span class=nx>f</span><span class=p>,</span> <span class=nx>n</span><span class=p>,</span> <span class=nx>d</span><span class=p>,</span> <span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl><span class=kd>var</span> <span class=nx>audioCtx</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl><span class=kd>var</span> <span class=nx>audioSource</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl><span class=kd>var</span> <span class=nx>audioAnalyzer</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>
</span></span><span class=line><span class=ln> 58</span><span class=cl><span class=nx>navigator</span><span class=p>.</span><span class=nx>mediaDevices</span><span class=p>.</span><span class=nx>getUserMedia</span><span class=p>({</span><span class=nx>audio</span><span class=o>:</span> <span class=kc>true</span><span class=p>})</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>stream</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl>    <span class=nx>audioCtx</span> <span class=o>=</span> <span class=k>new</span> <span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>AudioContext</span> <span class=o>||</span> <span class=nb>window</span><span class=p>.</span><span class=nx>webkitAudioContext</span><span class=p>)();</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl>    <span class=nx>audioSource</span> <span class=o>=</span> <span class=nx>audioCtx</span><span class=p>.</span><span class=nx>createMediaStreamSource</span><span class=p>(</span><span class=nx>stream</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>    <span class=nx>audioAnalyzer</span> <span class=o>=</span> <span class=nx>audioCtx</span><span class=p>.</span><span class=nx>createAnalyser</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>    <span class=nx>audioSource</span><span class=p>.</span><span class=nx>connect</span><span class=p>(</span><span class=nx>audioAnalyzer</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>    <span class=nx>audioAnalyzer</span><span class=p>.</span><span class=nx>fftSize</span> <span class=o>=</span> <span class=nx>h</span><span class=o>*</span><span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>    <span class=nx>audioAnalyzer</span><span class=p>.</span><span class=nx>smoothingTimeConstant</span> <span class=o>=</span> <span class=p>.</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>    <span class=nx>audioAnalyzer</span><span class=p>.</span><span class=nx>minDecibels</span> <span class=o>=</span> <span class=o>-</span><span class=mi>120</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>    <span class=nx>audioAnalyzer</span><span class=p>.</span><span class=nx>maxDecibels</span> <span class=o>=</span> <span class=o>-</span><span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>
</span></span><span class=line><span class=ln> 69</span><span class=cl>    <span class=kr>const</span> <span class=nx>audioBufLen</span> <span class=o>=</span> <span class=nx>audioAnalyzer</span><span class=p>.</span><span class=nx>frequencyBinCount</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>    <span class=kr>const</span> <span class=nx>audioAnlBuf</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>(</span><span class=nx>audioBufLen</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>    <span class=kd>function</span> <span class=nx>canvasUpdate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>      <span class=nx>audioAnalyzer</span><span class=p>.</span><span class=nx>getByteFrequencyData</span><span class=p>(</span><span class=nx>audioAnlBuf</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>k</span><span class=o>&lt;</span><span class=nx>h</span><span class=p>;</span> <span class=nx>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>        <span class=nx>cmap</span><span class=p>.</span><span class=nx>c</span><span class=p>(</span><span class=nx>arrLinterp</span><span class=p>(</span><span class=nx>audioAnlBuf</span><span class=p>,</span> <span class=nx>k</span><span class=o>/</span><span class=p>(</span><span class=nx>h</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=p>.</span><span class=mi>6</span><span class=p>)</span><span class=o>/</span><span class=mi>255</span><span class=p>,</span> <span class=nx>buf</span><span class=p>[</span><span class=nx>h</span><span class=o>-</span><span class=nx>k</span><span class=o>-</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl>      <span class=nx>timer</span><span class=p>.</span><span class=nx>update</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>      <span class=nx>canvasDraw</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>      <span class=nx>canvasDrawInfo</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>      <span class=nb>window</span><span class=p>.</span><span class=nx>requestAnimationFrame</span><span class=p>(</span><span class=nx>canvasUpdate</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>    <span class=nx>canvasInit</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl>    <span class=nx>canvasUpdate</span><span class=p>();</span> 
</span></span><span class=line><span class=ln> 83</span><span class=cl>  <span class=p>}).</span><span class=k>catch</span><span class=p>((</span><span class=nx>err</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl>
</span></span><span class=line><span class=ln> 87</span><span class=cl><span class=c1>// custom math func - linear interpolation
</span></span></span><span class=line><span class=ln> 88</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln> 89</span><span class=cl><span class=kd>function</span> <span class=nx>linterp</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>  <span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=p>((</span><span class=nx>b</span> <span class=o>-</span> <span class=nx>a</span><span class=p>)</span> <span class=o>*</span> <span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>
</span></span><span class=line><span class=ln> 93</span><span class=cl><span class=kd>function</span> <span class=nx>arrLinterp</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>  <span class=nx>l</span> <span class=o>=</span> <span class=nx>arr</span><span class=p>.</span><span class=nx>length</span> <span class=o>||</span> <span class=nx>arr</span><span class=p>.</span><span class=nx>byteLength</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>  <span class=nx>f</span> <span class=o>=</span> <span class=p>(</span><span class=nx>l</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=nx>t</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>  <span class=nx>n</span> <span class=o>=</span> <span class=nx>ftoi</span><span class=p>(</span><span class=nx>f</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>  <span class=nx>d</span> <span class=o>=</span> <span class=nx>f</span> <span class=o>%</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>  <span class=nx>a</span> <span class=o>=</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>n</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>  <span class=nx>b</span> <span class=o>=</span> <span class=nx>n</span><span class=o>+</span><span class=mi>1</span> <span class=o>&gt;</span> <span class=nx>l</span><span class=o>-</span><span class=mi>1</span> <span class=o>?</span> <span class=nx>a</span> <span class=o>:</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>n</span><span class=o>+</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>  <span class=k>return</span> <span class=nx>linterp</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>,</span> <span class=nx>d</span><span class=p>);</span>
</span></span><span class=line><span class=ln>101</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>
</span></span><span class=line><span class=ln>103</span><span class=cl><span class=c1>// custom structs/classes
</span></span></span><span class=line><span class=ln>104</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>105</span><span class=cl><span class=kd>function</span> <span class=nx>cTimer</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>f</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>107</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>fps</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>t</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>pt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>dt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>111</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>update</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>112</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>f</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>t</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>dt</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>t</span> <span class=o>-</span> <span class=k>this</span><span class=p>.</span><span class=nx>pt</span><span class=p>;</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>pt</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>t</span><span class=p>;</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>fps</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>dt</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=nx>ftoi</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=k>this</span><span class=p>.</span><span class=nx>dt</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>:</span> <span class=kc>NaN</span><span class=p>;</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>progress</span> <span class=o>=</span> <span class=p>(</span><span class=nx>n_loop</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>f</span> <span class=o>%</span> <span class=nx>n_loop</span> <span class=o>/</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>n_loop</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>119</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>progress_t</span> <span class=o>=</span> <span class=p>(</span><span class=nx>t_loop</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>t</span> <span class=o>%</span> <span class=nx>t_loop</span> <span class=o>/</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>t_loop</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>120</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>121</span><span class=cl>
</span></span><span class=line><span class=ln>122</span><span class=cl>
</span></span><span class=line><span class=ln>123</span><span class=cl><span class=kd>function</span> <span class=nx>cInputElementValuesProxy</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>124</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>values</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln>125</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>target</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln>126</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>display</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln>127</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>register</span> <span class=o>=</span> <span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>_default</span><span class=o>=</span><span class=kc>null</span><span class=p>,</span> <span class=nx>cast</span><span class=o>=</span><span class=p>(</span><span class=nx>v</span><span class=p>)=&gt;</span><span class=nx>v</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>128</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>values</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=ln>129</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=ln>130</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>parentElement</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;#&#34;</span> <span class=o>+</span> <span class=nx>name</span> <span class=o>+</span> <span class=s2>&#34;_value&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>131</span><span class=cl>
</span></span><span class=line><span class=ln>132</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;input&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>133</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>values</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>cast</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=ln>134</span><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>!==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>135</span><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=ln>136</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>137</span><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=ln>138</span><span class=cl>
</span></span><span class=line><span class=ln>139</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>_default</span> <span class=o>!==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>140</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>_default</span><span class=p>;</span>
</span></span><span class=line><span class=ln>141</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>values</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>cast</span><span class=p>(</span><span class=nx>_default</span><span class=p>);</span>
</span></span><span class=line><span class=ln>142</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>display</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span> <span class=o>+</span> <span class=nx>_default</span><span class=p>;</span>
</span></span><span class=line><span class=ln>143</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>144</span><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>target</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
</span></span><span class=line><span class=ln>145</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln>146</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>147</span><span class=cl>
</span></span><span class=line><span class=ln>148</span><span class=cl><span class=c1>// other funcs
</span></span></span><span class=line><span class=ln>149</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>150</span><span class=cl>
</span></span><span class=line><span class=ln>151</span><span class=cl><span class=kd>function</span> <span class=nx>canvasInit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>152</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillStyle</span> <span class=o>=</span> <span class=s2>&#34;black&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>153</span><span class=cl>  <span class=nx>timer</span><span class=p>.</span><span class=nx>update</span><span class=p>();</span>
</span></span><span class=line><span class=ln>154</span><span class=cl>  <span class=nx>canvasClear</span><span class=p>();</span>
</span></span><span class=line><span class=ln>155</span><span class=cl>  <span class=nx>inputElProxy</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;clearCanvas&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;click&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=ln>156</span><span class=cl>    <span class=nx>canvasClear</span><span class=p>();</span>
</span></span><span class=line><span class=ln>157</span><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=ln>158</span><span class=cl>
</span></span><span class=line><span class=ln>159</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>160</span><span class=cl>
</span></span><span class=line><span class=ln>161</span><span class=cl>
</span></span><span class=line><span class=ln>162</span><span class=cl><span class=kd>function</span> <span class=nx>canvasClear</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>163</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span>
</span></span><span class=line><span class=ln>164</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>clearRect</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=nx>w</span><span class=p>,</span><span class=nx>h</span><span class=p>);</span>
</span></span><span class=line><span class=ln>165</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillStyle</span> <span class=o>=</span> <span class=s2>&#34;black&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>166</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillRect</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=nx>w</span><span class=p>,</span><span class=nx>h</span><span class=p>);</span>
</span></span><span class=line><span class=ln>167</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>restore</span><span class=p>();</span>
</span></span><span class=line><span class=ln>168</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>169</span><span class=cl>
</span></span><span class=line><span class=ln>170</span><span class=cl>
</span></span><span class=line><span class=ln>171</span><span class=cl><span class=kd>function</span> <span class=nx>canvasDraw</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>172</span><span class=cl>  <span class=kr>const</span> <span class=nx>imd</span> <span class=o>=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>getImageData</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=nx>w</span><span class=p>,</span><span class=nx>h</span><span class=p>);</span>
</span></span><span class=line><span class=ln>173</span><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=nx>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>&lt;</span><span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>+=</span><span class=mi>4</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>174</span><span class=cl>    <span class=nx>x</span> <span class=o>=</span> <span class=nx>i</span><span class=o>/</span><span class=mi>4</span><span class=o>%</span><span class=nx>w</span><span class=p>;</span>
</span></span><span class=line><span class=ln>175</span><span class=cl>    <span class=nx>y</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>i</span><span class=o>/</span><span class=mi>4</span><span class=o>/</span><span class=nx>w</span><span class=p>);</span>
</span></span><span class=line><span class=ln>176</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>x</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=nx>w</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>177</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>x</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[(</span><span class=nx>x</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>178</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>x</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[(</span><span class=nx>x</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>179</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>x</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[(</span><span class=nx>x</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln>180</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>x</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[(</span><span class=nx>x</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=nx>y</span><span class=o>*</span><span class=mi>4</span><span class=o>*</span><span class=nx>w</span><span class=o>+</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=ln>181</span><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>182</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>buf</span><span class=p>[</span><span class=nx>y</span><span class=p>][</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>183</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=nx>buf</span><span class=p>[</span><span class=nx>y</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>184</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=nx>buf</span><span class=p>[</span><span class=nx>y</span><span class=p>][</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln>185</span><span class=cl>      <span class=nx>imd</span><span class=p>.</span><span class=nx>data</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=nx>buf</span><span class=p>[</span><span class=nx>y</span><span class=p>][</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=ln>186</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>187</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>188</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>putImageData</span><span class=p>(</span><span class=nx>imd</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>189</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>190</span><span class=cl>
</span></span><span class=line><span class=ln>191</span><span class=cl>
</span></span><span class=line><span class=ln>192</span><span class=cl><span class=kd>function</span> <span class=nx>canvasDrawInfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>193</span><span class=cl>  <span class=kr>const</span> <span class=nx>iw</span> <span class=o>=</span> <span class=mi>300</span><span class=p>;</span>
</span></span><span class=line><span class=ln>194</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span>
</span></span><span class=line><span class=ln>195</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillStyle</span> <span class=o>=</span> <span class=s2>&#34;black&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>196</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillRect</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>iw</span><span class=p>,</span> <span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=ln>197</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillStyle</span> <span class=o>=</span> <span class=s2>&#34;white&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>198</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>font</span> <span class=o>=</span> <span class=s2>&#34;24px monospace&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>199</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>textBaseline</span> <span class=o>=</span> <span class=s2>&#34;middle&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>200</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillText</span><span class=p>(</span><span class=nx>timer</span><span class=p>.</span><span class=nx>dt</span> <span class=o>+</span> <span class=s2>&#34;ms&#34;</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>14</span><span class=p>);</span>
</span></span><span class=line><span class=ln>201</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillText</span><span class=p>(</span><span class=s2>&#34;fps:&#34;</span> <span class=o>+</span> <span class=nx>timer</span><span class=p>.</span><span class=nx>fps</span><span class=p>,</span> <span class=mi>88</span><span class=p>,</span> <span class=mi>14</span><span class=p>);</span>
</span></span><span class=line><span class=ln>202</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fillText</span><span class=p>(</span><span class=s2>&#34;&#34;</span> <span class=o>+</span> <span class=nx>timer</span><span class=p>.</span><span class=nx>f</span><span class=p>,</span> <span class=mi>184</span><span class=p>,</span> <span class=mi>14</span><span class=p>);</span>
</span></span><span class=line><span class=ln>203</span><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>restore</span><span class=p>();</span>
</span></span><span class=line><span class=ln>204</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>205</span><span class=cl>
</span></span><span class=line><span class=ln>206</span><span class=cl>
</span></span><span class=line><span class=ln>207</span><span class=cl><span class=p>}</span></span></span></code></pre></div><script defer>window.onload=function(){const r=e=>~~e,f=document.getElementById("viewport"),e=f.getContext("2d",{alpha:!1}),t=f.width,i=f.height,l=Array.from({length:i},e=>[0,0,0,0]),d=new A,C=new S;function h(e,t){const s=t.length;let n=0;return e.map(e=>{n=0;for(let o=0;o<s;o++)n+=e**(s-o-1)*t[o];return n=n>1?1:n,n=n<0?0:n,n})}class F{constructor(e,t,n,s=512){this.n_samples=s,this.samples=Array.from({length:s},(e,t)=>t/(s-1)),this.cmap=[h(this.samples,e),h(this.samples,t),h(this.samples,n),this.samples.map(e=>1)]}c(e,t){t[0]=r(c(this.cmap[0],e)*255),t[1]=r(c(this.cmap[1],e)*255),t[2]=r(c(this.cmap[2],e)*255),t[3]=r(c(this.cmap[3],e)*255)}}const E=[1.6557762312002666,-5.0765628176037012,3.6114437522600484,.75501780705212251,-.010159038301211065],x=[-2.0627850606099467,4.4300104345314564,-1.8488324386347577,.50539609607001779,-.0015872300948496232],k=[7.0917066940883133,-6.67770210384022,-2.3104640769293701,2.5883795816309192,.002626895462210066],O=new F(E,x,k,512);var u,p,g,v,b,y,o=0,s=0,n=0,m=null,_=null,a=null;navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{m=new(window.AudioContext||window.webkitAudioContext),_=m.createMediaStreamSource(e),a=m.createAnalyser(),_.connect(a),a.fftSize=i*4,a.smoothingTimeConstant=0,a.minDecibels=-120,a.maxDecibels=-20;const s=a.frequencyBinCount,t=new Uint8Array(s);function n(){a.getByteFrequencyData(t);for(let e=0;e<i;e++)O.c(c(t,e/(i-1)*.6)/255,l[i-e-1]);d.update(),T(),z(),window.requestAnimationFrame(n)}M(),n()}).catch(e=>{console.error(e)});function w(e,t,n){return e+(t-e)*n}function c(e,t){return v=e.length||e.byteLength,g=(v-1)*t,u=r(g),y=g%1,p=e[u],b=u+1>v-1?p:e[u+1],w(p,b,y)}function A(){this.f=0,this.fps=0,this.t=0,this.pt=0,this.dt=0,this.update=()=>{this.f+=1,this.t=Date.now(),this.dt=this.t-this.pt,this.pt=this.t,this.fps=this.dt>0?r(1/this.dt*1e3):NaN},this.progress=e=>this.f%e/Math.max(e-1,1),this.progress_t=e=>this.t%e/Math.max(e-1,1)}function S(){this.values={},this.target={},this.display={},this.register=(e,t=null,n=e=>e)=>(this.values[e]=null,this.target[e]=document.getElementById(e),this.display[e]=this.target[e].parentElement.querySelector("#"+e+"_value"),this.target[e].addEventListener("input",t=>{this.values[e]=n(t.target.value),this.display[e]!==null&&(this.display[e].innerHTML=""+t.target.value)}),t!==null&&(this.target[e].value=t,this.values[e]=n(t),this.display[e].innerHTML=""+t),this.target[e])}function M(){e.fillStyle="black",d.update(),j(),C.register("clearCanvas").addEventListener("click",e=>{j()})}function j(){e.save(),e.clearRect(0,0,t,i),e.fillStyle="black",e.fillRect(0,0,t,i),e.restore()}function T(){const a=e.getImageData(0,0,t,i);for(o=0;o<a.data.length;o+=4)s=o/4%t,n=Math.floor(o/4/t),s+1<t?(a.data[s*4+n*4*t+0]=a.data[(s+1)*4+n*4*t+0],a.data[s*4+n*4*t+1]=a.data[(s+1)*4+n*4*t+1],a.data[s*4+n*4*t+2]=a.data[(s+1)*4+n*4*t+2],a.data[s*4+n*4*t+3]=a.data[(s+1)*4+n*4*t+3]):(a.data[o+0]=l[n][0],a.data[o+1]=l[n][1],a.data[o+2]=l[n][2],a.data[o+3]=l[n][3]);e.putImageData(a,0,0)}function z(){const t=300;e.save(),e.fillStyle="black",e.fillRect(0,0,t,32),e.fillStyle="white",e.font="24px monospace",e.textBaseline="middle",e.fillText(d.dt+"ms",8,14),e.fillText("fps:"+d.fps,88,14),e.fillText(""+d.f,184,14),e.restore()}}</script></div><br><br><br><br><p class=tc>Built with <a a target=_blank class=extern href=https://gohugo.io/>Hugo</a> | previoip (c) 2025</p></body></html>