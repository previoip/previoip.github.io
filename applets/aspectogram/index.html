<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-8HTK24ZVY8');
        }
      </script>
    
  


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/highlight.css?v=1.0.0">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">







<style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}small{font-size:calc(var(--f)*.82)}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}p canvas{outline:1px solid #000;width:calc(100% - var(--f)*1.6)}a{color:#1c69e5;text-decoration:underline}a:hover{color:#2072f5;text-decoration:none}a:active{color:#0062ff;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:#43454ce6;border-radius:3px}::-webkit-scrollbar-thumb{background:#c1cdf6e6;border-radius:3px}input,select{font:inherit}#control div{display:flex;align-items:center;margin-top:.6em}#control input,#control select{display:inline-block;margin:0 .5em}#control p{margin:0;width:2rem}</style>


  <title>
audio spectrogram &ndash; dumb by default
</title>
</head>

<body><div style="background-color: #69696969;">
  <br>
  <h1 class="tc">dumb by default</h1>
  
<nav class="tc">
[<a href="/">Home</a>]&nbsp;[<a href="/about/">About</a>]&nbsp;[<a href="/posts/">Posts</a>]&nbsp;[<a href="/resources/">Resources</a>]&nbsp;[<a href="/applets/">Applets</a>]&nbsp;
</nav><hr>
</div><p style="padding: 0;">


<span>dir: <i>








<a href="/">Home</a> &sol;






<a href="/applets/">Applets</a> &sol;






<span>audio spectrogram</span>

</i></span>




      <br>
      
      
      
      <span>published-date: 23 May 2025 16:58 &#43;0700</span><br>
      
      
      
      
          
    </p>
  <h1 class="tc">audio spectrogram</h1>
  <hr>
  <div>
    

<input id="appInitControl" type="button" value="loading">
<p><canvas id="viewport" width=720 height=720></canvas></p>
<div id="control">
  <div>
    <input id="clearCanvas" type="button" value="clear">
    <input id="pauseCanvas" type="button" value="pause">
    <input id="captureCanvas" type="button" value="download image">
    <input id="showStatsCanvas" type="button" value="hide stats">
  </div>
  <div>
    <label for="cmapSelect">cmap</label>
    <select name="cmapSelect" id="cmapSelect">
      <option value="inferno">inferno</option>
      <option value="viridis">viridis</option>
      <option value="plasma">plasma</option>
      <option value="jet">jet</option>
      <option value="hot">hot</option>
      <option value="gnuplot">gnuplot</option>
      <option value="turbo">turbo</option>
      <option value="cubehelix">cubehelix</option>
    </select>
  </div>
  <div>
    <label for="pingDisplay">show second interval marker</label>
    <input id="pingDisplay" type="checkbox">
  </div>
  <div>
    <label for="canvasSpeedDouble">double speed</label>
    <input id="canvasSpeedDouble" type="checkbox">
  </div>
  <div>
    <label for="yZoom">yscale</label>
    <input type="range" id="yZoom" name="yZoom" min="10" max="500" step="1" />
    <p id="yZoom_value"><p>
    <input id="yZoomReset" type="button" value="reset">
  </div>
  <div>
    <label for="mindB">min dB</label>
    <input type="range" id="mindB" name="mindB" min="-200" max="-30" step="1" />
    <p id="mindB_value"><p>
    <input id="dBReset" type="button" value="reset">
  </div>
  <div>
    <label for="maxdB">max dB</label>
    <input type="range" id="maxdB" name="maxdB" min="-120" max="20" step="1" />
    <p id="maxdB_value"><p>
  </div>
</div>

<div class="highlight" id="code" inject="true"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="ln">  1</span><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;viewport&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&#34;2d&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;alpha&#34;</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="kr">const</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="kr">const</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="kr">const</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">({</span><span class="nx">length</span><span class="o">:</span><span class="nx">h</span><span class="p">},</span> <span class="nx">_</span><span class="p">=&gt;[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cTimer</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="kr">const</span> <span class="nx">inputProxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cInputProxy</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="kr">const</span> <span class="nx">states</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="kr">const</span> <span class="nx">ftoi</span> <span class="o">=</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">~~</span><span class="nx">v</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="kd">var</span> <span class="nx">audioCtx</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="kd">var</span> <span class="nx">audioSource</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="kd">var</span> <span class="nx">audioAnalyzer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="kd">var</span> <span class="nx">audioAnalyzerBuffer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="nx">states</span><span class="p">.</span><span class="nx">ping_flag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="nx">states</span><span class="p">.</span><span class="nx">ping_toggle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="nx">states</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="nx">states</span><span class="p">.</span><span class="nx">speed_double</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="nx">states</span><span class="p">.</span><span class="nx">stats_visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="kr">const</span> <span class="nx">y_ax_width</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">
</span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="kd">function</span> <span class="nx">f_p</span><span class="p">(</span><span class="nx">samples</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">  <span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">  <span class="kd">let</span> <span class="nx">sums</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">  <span class="k">return</span> <span class="nx">samples</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">    <span class="p">(</span><span class="nx">s</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">        <span class="nx">sums</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">m</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">m</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">;</span> <span class="nx">m</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">          <span class="nx">sums</span> <span class="o">+=</span> <span class="nx">s</span><span class="o">**</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="nx">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">p</span><span class="p">[</span><span class="nx">m</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">        <span class="nx">sums</span> <span class="o">=</span> <span class="nx">sums</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="nx">sums</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">        <span class="nx">sums</span> <span class="o">=</span> <span class="nx">sums</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">sums</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">return</span> <span class="nx">sums</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="kr">class</span> <span class="nx">cColorMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">p_r</span><span class="p">,</span> <span class="nx">p_g</span><span class="p">,</span> <span class="nx">p_b</span><span class="p">,</span> <span class="nx">n_samples</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">n_samples</span> <span class="o">=</span> <span class="nx">n_samples</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">samples</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">({</span><span class="nx">length</span><span class="o">:</span><span class="nx">n_samples</span><span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">k</span><span class="o">/</span><span class="p">(</span><span class="nx">n_samples</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">cmap</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">      <span class="nx">f_p</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">samples</span><span class="p">,</span> <span class="nx">p_r</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">      <span class="nx">f_p</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">samples</span><span class="p">,</span> <span class="nx">p_g</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">      <span class="nx">f_p</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">samples</span><span class="p">,</span> <span class="nx">p_b</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">      <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">  <span class="nx">c</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">pbuf</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">    <span class="nx">pbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">arrLinterp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">v</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">    <span class="nx">pbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">arrLinterp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cmap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">v</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">    <span class="nx">pbuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">arrLinterp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cmap</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">v</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">    <span class="nx">pbuf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">arrLinterp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cmap</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">v</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">
</span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="kr">const</span> <span class="nx">cmaps</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;inferno&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="p">[</span> <span class="mf">1.6557762312002666</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0765628176037012</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">3.6114437522600484</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">7.5501780705212251</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0159038301211065</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">2.0627850606099467</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">4.4300104345314564</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8488324386347577</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">5.0539609607001779</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5872300948496232</span><span class="nx">e</span><span class="o">-</span><span class="mi">03</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">  <span class="p">[</span> <span class="mf">7.0917066940883133</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.6777021038402200</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3104640769293701</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.5883795816309192</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.6268954622100660</span><span class="nx">e</span><span class="o">-</span><span class="mi">03</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;viridis&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">4.1531892247064173</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.1181547457244568</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4602078643667138</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.2239095368718611</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.3595679795613189</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">1.2192037749060591</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.2674937766924388</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7332559429197238</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.5827705985707894</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.7022394516756911</span><span class="nx">e</span><span class="o">-</span><span class="mi">03</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="p">[</span> <span class="mf">8.9964455707624591</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6228840302847096</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.5542585551383983</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">9.7008011432531771</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">3.5734815371570305</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;plasma&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">9.6273453788123020</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">1.5159757165361241</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7631980996589673</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.0864096598141320</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">6.4327924293011707</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="p">[</span> <span class="mf">2.0752391227084925</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.1505954072860423</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">5.0866969551198995</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0903805618152209</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">5.8351240571633545</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">4.8259898901274623</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">3.2492644170332690</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.6331725031006119</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.4881970078755509</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">5.1847720178966550</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;jet&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">8.2849271833795886</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">7.0881885991722209</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.9846822373834803</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4354238409364075</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">7.5255535550637132</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="p">[</span> <span class="mf">2.3359465451418828</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.7806657343420532</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">2.6510474721705169</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0878131237437185</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.1843610455975373</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">8.2849271833794944</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.6051520134345967</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5460315065377277</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">7.3412023021711059</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">4.2777534779034276</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;gnuplot&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">1.9535174042023593</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">4.8319508808781322</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4768773653099547</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.4924728468434454</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">9.5225312839073650</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">1.3250959501781973</span><span class="nx">e</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span>  <span class="mf">1.0000000000000027</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8564461224891389</span><span class="nx">e</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span>  <span class="mf">4.3224304427169264</span><span class="nx">e</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7755575615628914</span><span class="nx">e</span><span class="o">-</span><span class="mi">17</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">2.6572077195938601</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">6.4671486770697314</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.1953117837091135</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">1.4049166004537248</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4144312918029698</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;hot&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  <span class="p">[</span> <span class="mf">3.6222211750231050</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.6076535867206063</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4142170137358256</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">3.4563502219789628</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2580126325212908</span><span class="nx">e</span><span class="o">-</span><span class="mi">03</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">6.9729705138142206</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">8.0851782013482758</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">5.3252185214198289</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1979054130229345</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">5.0279492097186518</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  <span class="p">[</span> <span class="mf">5.0265294088989556</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.2167995225531216</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.3223930853779435</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6971718038553192</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.6372020237642770</span><span class="nx">e</span><span class="o">-</span><span class="mi">03</span><span class="p">],</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;turbo&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">  <span class="p">[</span> <span class="mf">5.8137453451132089</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5056663492057038</span><span class="nx">e</span><span class="o">+</span><span class="mi">02</span><span class="p">,</span>  <span class="mf">1.3058871182450739</span><span class="nx">e</span><span class="o">+</span><span class="mi">02</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2327689751909915</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">4.5973637196275892</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.3572137988693811</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">  <span class="p">[</span> <span class="mf">2.7747311504642140</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">4.2108563550809315</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4019450960349118</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">4.8052047964775859</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">2.1856173378635897</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">9.1402612359582219</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">  <span class="p">[</span> <span class="mf">2.6818260967508394</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.8506582506478409</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">1.0907449945380316</span><span class="nx">e</span><span class="o">+</span><span class="mi">02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0109675515821372</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">1.2592563476452922</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">1.0667330048676682</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="nx">cmaps</span><span class="p">[</span><span class="s2">&#34;cubehelix&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cColorMap</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">  <span class="p">[</span> <span class="mf">4.8656254248331940</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1125717035559705</span><span class="nx">e</span><span class="o">+</span><span class="mi">02</span><span class="p">,</span>  <span class="mf">8.3775484585921745</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2283644630448034</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">2.2214657823001218</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.2622588239722177</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">  <span class="p">[</span><span class="o">-</span><span class="mf">3.0829519810075045</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">7.5036654525369528</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2165754730774651</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">1.9757491405838131</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.7008357867253394</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">2.2104721942214134</span><span class="nx">e</span><span class="o">-</span><span class="mi">02</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">  <span class="p">[</span> <span class="mf">3.2660119095476965</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.9042334615301982</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">1.0495732857887293</span><span class="nx">e</span><span class="o">+</span><span class="mi">02</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5198901073315973</span><span class="nx">e</span><span class="o">+</span><span class="mi">01</span><span class="p">,</span>  <span class="mf">7.6992286492741036</span><span class="nx">e</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5298769585405037</span><span class="nx">e</span><span class="o">-</span><span class="mi">01</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">  <span class="mi">512</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">
</span></span><span class="line"><span class="ln">113</span><span class="cl">
</span></span><span class="line"><span class="ln">114</span><span class="cl"><span class="c1">// custom math func - linear interpolation
</span></span></span><span class="line"><span class="ln">115</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="kd">function</span> <span class="nx">linterp</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">  <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="p">((</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">a</span><span class="p">)</span> <span class="o">*</span> <span class="nx">t</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">
</span></span><span class="line"><span class="ln">120</span><span class="cl">
</span></span><span class="line"><span class="ln">121</span><span class="cl"><span class="kd">function</span> <span class="nx">arrLinterp</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">  <span class="nx">l</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">  <span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="nx">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">t</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">  <span class="nx">n</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="nx">d</span> <span class="o">=</span> <span class="nx">f</span> <span class="o">%</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">  <span class="nx">a</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">  <span class="nx">b</span> <span class="o">=</span> <span class="nx">n</span><span class="o">+</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="nx">l</span><span class="o">-</span><span class="mi">1</span> <span class="o">?</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">  <span class="k">return</span> <span class="nx">linterp</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">
</span></span><span class="line"><span class="ln">131</span><span class="cl"><span class="c1">// custom structs/classes
</span></span></span><span class="line"><span class="ln">132</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">
</span></span><span class="line"><span class="ln">134</span><span class="cl"><span class="kd">function</span> <span class="nx">cTimer</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">fps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">pt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">t</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">pt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">pt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">t</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">fps</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">ftoi</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">dt</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">:</span> <span class="kc">NaN</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">progress</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n_loop</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">%</span> <span class="nx">n_loop</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">n_loop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">progress_t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">t_loop</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">t</span> <span class="o">%</span> <span class="nx">t_loop</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">t_loop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">
</span></span><span class="line"><span class="ln">151</span><span class="cl">
</span></span><span class="line"><span class="ln">152</span><span class="cl"><span class="kd">function</span> <span class="nx">cInputProxy</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">_default</span><span class="o">=</span><span class="kc">null</span><span class="p">,</span> <span class="nx">cast</span><span class="o">=</span><span class="p">(</span><span class="nx">v</span><span class="p">)=&gt;</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;#&#34;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&#34;_value&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;input&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">_default</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="nx">_default</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">178</span><span class="cl">
</span></span><span class="line"><span class="ln">179</span><span class="cl">
</span></span><span class="line"><span class="ln">180</span><span class="cl"><span class="c1">// routines
</span></span></span><span class="line"><span class="ln">181</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">182</span><span class="cl"><span class="kd">function</span> <span class="nx">appInit</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;black&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">184</span><span class="cl">  <span class="nx">timer</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">185</span><span class="cl">  <span class="nx">canvasClear</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">  <span class="nx">canvasDrawYAx</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;appInitControl&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">running</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">189</span><span class="cl">      <span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">appInitControl</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;connect device&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">191</span><span class="cl">      <span class="nx">appClose</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">192</span><span class="cl">      
</span></span><span class="line"><span class="ln">193</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">194</span><span class="cl">      <span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">195</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">appInitControl</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;disconnect device&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">196</span><span class="cl">      <span class="nx">appConnectDevice</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">197</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">198</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">199</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">appInitControl</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;connect device&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">200</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;clearCanvas&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">201</span><span class="cl">    <span class="nx">canvasClear</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">202</span><span class="cl">    <span class="nx">canvasDrawYAx</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">yZoom</span> <span class="o">/</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">203</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">204</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;pauseCanvas&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">205</span><span class="cl">    <span class="nx">states</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="o">!</span><span class="nx">states</span><span class="p">.</span><span class="nx">pause</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">206</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">pause</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">207</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">pauseCanvas</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;resume&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">208</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">audioCtx</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">209</span><span class="cl">        <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">suspend</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">210</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln">211</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">212</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">pauseCanvas</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;pause&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">213</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">audioCtx</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">214</span><span class="cl">        <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">resume</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">215</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln">216</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">217</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">218</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;showStatsCanvas&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">219</span><span class="cl">    <span class="nx">states</span><span class="p">.</span><span class="nx">stats_visible</span> <span class="o">=</span> <span class="o">!</span><span class="nx">states</span><span class="p">.</span><span class="nx">stats_visible</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">220</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">stats_visible</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">221</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">showStatsCanvas</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;hide stats&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">222</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">223</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">showStatsCanvas</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;show stats&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">224</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">225</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">226</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;captureCanvas&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">227</span><span class="cl">    <span class="kd">let</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">228</span><span class="cl">    <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s1">&#39;image/png&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">229</span><span class="cl">    <span class="nx">link</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="s1">&#39;spectrogram.png&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">230</span><span class="cl">    <span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">231</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">232</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;yZoom&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;input&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">233</span><span class="cl">    <span class="nx">canvasDrawYAx</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">yZoom</span> <span class="o">/</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">234</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">235</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;yZoomReset&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">236</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">yZoom</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">237</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">yZoom</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">238</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">yZoom</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;100&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">239</span><span class="cl">    <span class="nx">canvasDrawYAx</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">yZoom</span> <span class="o">/</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">240</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">241</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;mindB&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;input&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">242</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">mindB</span> <span class="o">&gt;</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">maxdB</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">243</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">mindB</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">244</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">245</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">246</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">247</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;maxdB&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;input&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">248</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">mindB</span> <span class="o">&gt;</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">maxdB</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">249</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">mindB</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">maxdB</span> <span class="o">-</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">250</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">mindB</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">mindB</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">251</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">252</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">253</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;dBReset&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">254</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">mindB</span> <span class="o">=</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">mindB</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">255</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">mindB</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">mindB</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">256</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">mindB</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">mindB</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">257</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">maxdB</span> <span class="o">=</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">258</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">259</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">260</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">261</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;cmapSelect&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">262</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;pingDisplay&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">263</span><span class="cl">    <span class="nx">states</span><span class="p">.</span><span class="nx">ping_toggle</span> <span class="o">=</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">pingDisplay</span><span class="p">.</span><span class="nx">checked</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">264</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">265</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;canvasSpeedDouble&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">266</span><span class="cl">    <span class="nx">states</span><span class="p">.</span><span class="nx">speed_double</span> <span class="o">=</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">canvasSpeedDouble</span><span class="p">.</span><span class="nx">checked</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">267</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">268</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">canvasSpeedDouble</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">269</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">pingDisplay</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">270</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">271</span><span class="cl">
</span></span><span class="line"><span class="ln">272</span><span class="cl">
</span></span><span class="line"><span class="ln">273</span><span class="cl"><span class="kd">function</span> <span class="nx">appConnectDevice</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">274</span><span class="cl">  <span class="nx">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span><span class="nx">audio</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span>
</span></span><span class="line"><span class="ln">275</span><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">stream</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">276</span><span class="cl">      <span class="nx">audioCtx</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">AudioContext</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitAudioContext</span><span class="p">)();</span>
</span></span><span class="line"><span class="ln">277</span><span class="cl">      <span class="nx">audioSource</span> <span class="o">=</span> <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">createMediaStreamSource</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">278</span><span class="cl">      <span class="nx">audioAnalyzer</span> <span class="o">=</span> <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">createAnalyser</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">279</span><span class="cl">      <span class="nx">audioSource</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">audioAnalyzer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">280</span><span class="cl">      <span class="nx">audioAnalyzer</span><span class="p">.</span><span class="nx">fftSize</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">281</span><span class="cl">      <span class="nx">audioAnalyzer</span><span class="p">.</span><span class="nx">smoothingTimeConstant</span> <span class="o">=</span> <span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">282</span><span class="cl">      <span class="nx">audioAnalyzerBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">audioAnalyzer</span><span class="p">.</span><span class="nx">frequencyBinCount</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">283</span><span class="cl">      <span class="nx">appUpdate</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">284</span><span class="cl">    <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">285</span><span class="cl">      <span class="nx">audioCtx</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">286</span><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">287</span><span class="cl">    <span class="p">})</span> 
</span></span><span class="line"><span class="ln">288</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">289</span><span class="cl">
</span></span><span class="line"><span class="ln">290</span><span class="cl">
</span></span><span class="line"><span class="ln">291</span><span class="cl"><span class="kd">function</span> <span class="nx">appUpdate</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">292</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">audioCtx</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s2">&#34;closed&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">293</span><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="ln">294</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">295</span><span class="cl">  <span class="nx">audioAnalyzer</span><span class="p">.</span><span class="nx">minDecibels</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">mindB</span><span class="p">,</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">maxdB</span><span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">296</span><span class="cl">  <span class="nx">audioAnalyzer</span><span class="p">.</span><span class="nx">maxDecibels</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">mindB</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">maxdB</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">297</span><span class="cl">
</span></span><span class="line"><span class="ln">298</span><span class="cl">  <span class="nx">audioAnalyzer</span><span class="p">.</span><span class="nx">getByteFrequencyData</span><span class="p">(</span><span class="nx">audioAnalyzerBuffer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">299</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">k</span><span class="o">&lt;</span><span class="nx">h</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">300</span><span class="cl">    <span class="nx">r</span> <span class="o">=</span> <span class="nx">k</span><span class="o">/</span><span class="p">(</span><span class="nx">h</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">301</span><span class="cl">    <span class="nx">r</span> <span class="o">/=</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">yZoom</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">302</span><span class="cl">    <span class="nx">cmaps</span><span class="p">[</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">cmapSelect</span><span class="p">].</span><span class="nx">c</span><span class="p">(</span><span class="nx">arrLinterp</span><span class="p">(</span><span class="nx">audioAnalyzerBuffer</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nx">buf</span><span class="p">[</span><span class="nx">h</span><span class="o">-</span><span class="nx">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">303</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">304</span><span class="cl">  <span class="nx">timer</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">305</span><span class="cl">  <span class="nx">canvasDraw</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">306</span><span class="cl">  <span class="nx">canvasDrawInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">307</span><span class="cl">  <span class="nx">canvasDrawSecondPing</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">308</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">audioCtx</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s2">&#34;suspended&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">309</span><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">appUpdate</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">310</span><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="ln">311</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">312</span><span class="cl">  <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">appUpdate</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">313</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">314</span><span class="cl">
</span></span><span class="line"><span class="ln">315</span><span class="cl">
</span></span><span class="line"><span class="ln">316</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasClear</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">317</span><span class="cl">  <span class="kd">let</span> <span class="nx">fill_c</span> <span class="o">=</span> <span class="s2">&#34;black&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">318</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">319</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">320</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;black&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">321</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">322</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">323</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">324</span><span class="cl">
</span></span><span class="line"><span class="ln">325</span><span class="cl">
</span></span><span class="line"><span class="ln">326</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDrawRoutinePutBuffer</span><span class="p">(</span><span class="nx">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">327</span><span class="cl">  <span class="kr">const</span> <span class="nx">imd</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">328</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">329</span><span class="cl">    <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">330</span><span class="cl">    <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">buf</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">331</span><span class="cl">    <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">buf</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">332</span><span class="cl">    <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">buf</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">333</span><span class="cl">    <span class="nx">imd</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">buf</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">334</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">335</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">imd</span><span class="p">,</span> <span class="nx">w</span><span class="o">-</span><span class="nx">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">336</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">337</span><span class="cl">
</span></span><span class="line"><span class="ln">338</span><span class="cl">
</span></span><span class="line"><span class="ln">339</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDrawRoutineShiftFrame</span><span class="p">(</span><span class="nx">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">340</span><span class="cl">  <span class="kr">const</span> <span class="nx">imd</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="o">-</span><span class="nx">offset</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">341</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">imd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">342</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">343</span><span class="cl">
</span></span><span class="line"><span class="ln">344</span><span class="cl">
</span></span><span class="line"><span class="ln">345</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDraw</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">346</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">pause</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">347</span><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="ln">348</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">349</span><span class="cl">  <span class="nx">canvasDrawRoutinePutBuffer</span><span class="p">(</span><span class="nx">y_ax_width</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">350</span><span class="cl">  <span class="nx">canvasDrawRoutineShiftFrame</span><span class="p">(</span><span class="nx">y_ax_width</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">351</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">speed_double</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">352</span><span class="cl">    <span class="nx">canvasDrawRoutineShiftFrame</span><span class="p">(</span><span class="nx">y_ax_width</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">353</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">354</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">355</span><span class="cl">
</span></span><span class="line"><span class="ln">356</span><span class="cl">
</span></span><span class="line"><span class="ln">357</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDrawSecondPing</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">358</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">states</span><span class="p">.</span><span class="nx">ping_toggle</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">359</span><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="ln">360</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">361</span><span class="cl">  <span class="nx">r</span> <span class="o">=</span> <span class="nx">timer</span><span class="p">.</span><span class="nx">progress_t</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">362</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&lt;</span> <span class="p">.</span><span class="mi">10</span> <span class="o">&amp;</span> <span class="nx">states</span><span class="p">.</span><span class="nx">ping_flag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">363</span><span class="cl">    <span class="nx">states</span><span class="p">.</span><span class="nx">ping_flag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">364</span><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">365</span><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;white&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">366</span><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">w</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="nx">y_ax_width</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">367</span><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;rgba(77, 77, 77, 0.38)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">368</span><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">w</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="nx">y_ax_width</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nx">h</span><span class="o">-</span><span class="mi">22</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">369</span><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">370</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">371</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">90</span> <span class="o">&amp;</span> <span class="o">!</span><span class="nx">states</span><span class="p">.</span><span class="nx">ping_flag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">372</span><span class="cl">    <span class="nx">states</span><span class="p">.</span><span class="nx">ping_flag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">373</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">374</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">375</span><span class="cl">
</span></span><span class="line"><span class="ln">376</span><span class="cl">
</span></span><span class="line"><span class="ln">377</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDrawInfo</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">378</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">states</span><span class="p">.</span><span class="nx">stats_visible</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">379</span><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="ln">380</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">381</span><span class="cl">  <span class="kr">const</span> <span class="nx">iw</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">382</span><span class="cl">  <span class="kr">const</span> <span class="nx">iy</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">383</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">384</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;black&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">385</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">iw</span><span class="p">,</span> <span class="nx">iy</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">386</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;white&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">387</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s2">&#34;16px monospace&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">388</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span> <span class="o">=</span> <span class="s2">&#34;middle&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">389</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">timer</span><span class="p">.</span><span class="nx">dt</span> <span class="o">+</span> <span class="s2">&#34;ms&#34;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">iy</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">390</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&#34;fps:&#34;</span> <span class="o">+</span> <span class="nx">timer</span><span class="p">.</span><span class="nx">fps</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="nx">iy</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">391</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">392</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">393</span><span class="cl">
</span></span><span class="line"><span class="ln">394</span><span class="cl">
</span></span><span class="line"><span class="ln">395</span><span class="cl"><span class="kr">const</span> <span class="nx">y_ax_freq</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">396</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;20&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">397</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;100&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">398</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;500&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">399</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">1000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;1k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">400</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">2000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;2k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">401</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">3000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;3k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">402</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">4000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;4k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">403</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">5000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;5k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">404</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">6000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;6k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">405</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">8000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;8k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">406</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">12000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;12k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">407</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">16000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;16k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">408</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">20000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;20k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">409</span><span class="cl"><span class="nx">y_ax_freq</span><span class="p">[</span><span class="mi">24000</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;24k&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">410</span><span class="cl">
</span></span><span class="line"><span class="ln">411</span><span class="cl"><span class="kd">function</span> <span class="nx">canvasDrawYAx</span><span class="p">(</span><span class="nx">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nx">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">412</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">413</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;black&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">414</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">w</span><span class="o">-</span><span class="nx">y_ax_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y_ax_width</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">415</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s2">&#34;12px monospace&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">416</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span> <span class="o">=</span> <span class="s2">&#34;middle&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">417</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">y_ax_freq</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">418</span><span class="cl">    <span class="nx">r</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">/</span> <span class="mi">24000</span> <span class="o">*</span> <span class="nx">scale</span> <span class="o">+</span> <span class="p">.</span><span class="mi">001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">419</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">r</span> <span class="o">&lt;</span> <span class="p">.</span><span class="mi">005</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">99</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">420</span><span class="cl">      <span class="nx">y</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">421</span><span class="cl">      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;white&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">422</span><span class="cl">      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">y_ax_freq</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">w</span><span class="o">-</span><span class="nx">y_ax_width</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">423</span><span class="cl">      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&#34;gray&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">424</span><span class="cl">      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">w</span><span class="o">-</span><span class="nx">y_ax_width</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">425</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">426</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">427</span><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">428</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">429</span><span class="cl">
</span></span><span class="line"><span class="ln">430</span><span class="cl">
</span></span><span class="line"><span class="ln">431</span><span class="cl"><span class="kd">function</span> <span class="nx">appClose</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">432</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">audioCtx</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">state</span> <span class="o">!==</span> <span class="s2">&#34;closed&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">433</span><span class="cl">    <span class="nx">audioCtx</span><span class="p">.</span><span class="nx">close</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">434</span><span class="cl">      <span class="nx">audioCtx</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">435</span><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="ln">436</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">437</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">438</span><span class="cl">
</span></span><span class="line"><span class="ln">439</span><span class="cl">
</span></span><span class="line"><span class="ln">440</span><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">onbeforeunload</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">441</span><span class="cl">  <span class="nx">appClose</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">442</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">443</span><span class="cl">
</span></span><span class="line"><span class="ln">444</span><span class="cl">
</span></span><span class="line"><span class="ln">445</span><span class="cl"><span class="nx">appInit</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">446</span><span class="cl">
</span></span><span class="line"><span class="ln">447</span><span class="cl"><span class="p">}</span></span></span></code></pre></div>

<script defer>window.onload = function()
{

const canvas = document.getElementById("viewport");
const ctx = canvas.getContext("2d", {"alpha":false});
const w = canvas.width;
const h = canvas.height;
const buf = Array.from({length:h}, _=>[0,0,0,0]);
const timer = new cTimer();
const inputProxy = new cInputProxy();
const states = {};
const ftoi = (v) => ~~v;
var i=0, x=0, y=0, r, l, f, n, d, a, b;
var audioCtx = null;
var audioSource = null;
var audioAnalyzer = null;
var audioAnalyzerBuffer = null;
states.running = false;
states.ping_flag = false;
states.ping_toggle = false;
states.pause = false;
states.speed_double = false;
states.stats_visible = true;
const y_ax_width = 26;

function f_p(samples, p) {
  const n = p.length;
  let sums = 0;
  return samples.map(
    (s)=>{
        sums = 0;
        for (let m=0; m<n; m++) {
          sums += s**(n-m-1) * p[m];
        }
        sums = sums > 1 ? 1 : sums;
        sums = sums < 0 ? 0 : sums;
        return sums
    }
  )
};


class cColorMap {
  constructor(p_r, p_g, p_b, n_samples=512) {
    this.n_samples = n_samples;
    this.samples = Array.from({length:n_samples}, (_, k) => k/(n_samples-1));
    this.cmap = [
      f_p(this.samples, p_r),
      f_p(this.samples, p_g),
      f_p(this.samples, p_b),
      [1],
    ];
  };
  c(v, pbuf) {
    pbuf[0] = ftoi(arrLinterp(this.cmap[0], v)*255);
    pbuf[1] = ftoi(arrLinterp(this.cmap[1], v)*255);
    pbuf[2] = ftoi(arrLinterp(this.cmap[2], v)*255);
    pbuf[3] = ftoi(arrLinterp(this.cmap[3], v)*255);
  };
};


const cmaps = {};
cmaps["inferno"] = new cColorMap(
  [ 1.6557762312002666e+00, -5.0765628176037012e+00,  3.6114437522600484e+00,  7.5501780705212251e-01, -1.0159038301211065e-02],
  [-2.0627850606099467e+00,  4.4300104345314564e+00, -1.8488324386347577e+00,  5.0539609607001779e-01, -1.5872300948496232e-03],
  [ 7.0917066940883133e+00, -6.6777021038402200e+00, -2.3104640769293701e+00,  2.5883795816309192e+00,  2.6268954622100660e-03],
  512
);
cmaps["viridis"] = new cColorMap(
  [-4.1531892247064173e+00,  1.1181547457244568e+01, -7.4602078643667138e+00,  1.2239095368718611e+00,  2.3595679795613189e-01],
  [-1.2192037749060591e+00,  2.2674937766924388e+00, -1.7332559429197238e+00,  1.5827705985707894e+00,  1.7022394516756911e-03],
  [ 8.9964455707624591e-01, -1.6228840302847096e+00, -5.5542585551383983e-01,  9.7008011432531771e-01,  3.5734815371570305e-01],
  512
);
cmaps["plasma"] = new cColorMap(
  [-9.6273453788123020e-01,  1.5159757165361241e+00, -1.7631980996589673e+00,  2.0864096598141320e+00,  6.4327924293011707e-02],
  [ 2.0752391227084925e+00, -5.1505954072860423e+00,  5.0866969551198995e+00, -1.0903805618152209e+00,  5.8351240571633545e-02],
  [-4.8259898901274623e-01,  3.2492644170332690e+00, -4.6331725031006119e+00,  1.4881970078755509e+00,  5.1847720178966550e-01],
  512
);
cmaps["jet"] = new cColorMap(
  [-8.2849271833795886e+00,  7.0881885991722209e+00,  2.9846822373834803e+00, -1.4354238409364075e+00,  7.5255535550637132e-02],
  [ 2.3359465451418828e+01, -4.7806657343420532e+01,  2.6510474721705169e+01, -2.0878131237437185e+00,  1.1843610455975373e-02],
  [-8.2849271833794944e+00,  2.6051520134345967e+01, -2.5460315065377277e+01,  7.3412023021711059e+00,  4.2777534779034276e-01],
  512
);
cmaps["gnuplot"] = new cColorMap(
  [-1.9535174042023593e+00,  4.8319508808781322e+00, -4.4768773653099547e+00,  2.4924728468434454e+00,  9.5225312839073650e-02],
  [-1.3250959501781973e-15,  1.0000000000000027e+00, -1.8564461224891389e-15,  4.3224304427169264e-16, -2.7755575615628914e-17],
  [-2.6572077195938601e+01,  6.4671486770697314e+01, -5.1953117837091135e+01,  1.4049166004537248e+01, -2.4144312918029698e-01],
  512
);
cmaps["hot"] = new cColorMap(
  [ 3.6222211750231050e+00, -4.6076535867206063e+00, -1.4142170137358256e+00,  3.4563502219789628e+00, -4.2580126325212908e-03],
  [-6.9729705138142206e+00,  8.0851782013482758e+00,  5.3252185214198289e-01, -8.1979054130229345e-01,  5.0279492097186518e-02],
  [ 5.0265294088989556e+00, -5.2167995225531216e+00,  1.3223930853779435e+00, -1.6971718038553192e-02, -6.6372020237642770e-03],
  512
);
cmaps["turbo"] = new cColorMap(
  [ 5.8137453451132089e+01, -1.5056663492057038e+02,  1.3058871182450739e+02, -4.2327689751909915e+01,  4.5973637196275892e+00,  1.3572137988693811e-01],
  [ 2.7747311504642140e+00,  4.2108563550809315e+00, -1.4019450960349118e+01,  4.8052047964775859e+00,  2.1856173378635897e+00,  9.1402612359582219e-02],
  [ 2.6818260967508394e+01, -8.8506582506478409e+01,  1.0907449945380316e+02, -6.0109675515821372e+01,  1.2592563476452922e+01,  1.0667330048676682e-01],
  512
);
cmaps["cubehelix"] = new cColorMap(
  [ 4.8656254248331940e+01, -1.1125717035559705e+02,  8.3775484585921745e+01, -2.2283644630448034e+01,  2.2214657823001218e+00,  1.2622588239722177e-02],
  [-3.0829519810075045e+01,  7.5036654525369528e+01, -6.2165754730774651e+01,  1.9757491405838131e+01, -8.7008357867253394e-01,  2.2104721942214134e-02],
  [ 3.2660119095476965e+01, -9.9042334615301982e+01,  1.0495732857887293e+02, -4.5198901073315973e+01,  7.6992286492741036e+00, -1.5298769585405037e-01],
  512
);


// custom math func - linear interpolation

function linterp(a, b, t) {
  return a + ((b - a) * t)
};


function arrLinterp(arr, t) {
  l = arr.length || arr.byteLength;
  f = (l-1)*t;
  n = ftoi(f);
  d = f % 1;
  a = arr[n];
  b = n+1 > l-1 ? a : arr[n+1];
  return linterp(a, b, d);
};

// custom structs/classes


function cTimer () {
  this.f = 0;
  this.fps = 0;
  this.t = 0;
  this.pt = 0;
  this.dt = 0;
  this.update = () => {
    this.f += 1;
    this.t = Date.now();
    this.dt = this.t - this.pt;
    this.pt = this.t;
    this.fps = this.dt > 0 ? ftoi(1 / this.dt * 1000) : NaN;
  }
  this.progress = (n_loop) => this.f % n_loop / Math.max(n_loop-1, 1)
  this.progress_t = (t_loop) => this.t % t_loop / Math.max(t_loop-1, 1)
};


function cInputProxy () {
  this.values = {};
  this.target = {};
  this.display = {};
  this.defaults = {};
  this.register = (name, _default=null, cast=(v)=>v) => {
    this.target[name] = document.getElementById(name);
    this.display[name] = this.target[name].parentElement.querySelector("#" + name + "_value");
    this.values[name] = cast(this.target[name].value);
    this.defaults[name] = _default;
    this.target[name].addEventListener("input", (event) => {
      this.values[name] = cast(event.target.value);
      if (this.display[name] !== null) {
        this.display[name].innerHTML = "" + event.target.value;
      }
    });
    if (_default !== null) {
      this.target[name].value = "" + _default;
      this.values[name] = cast(_default);
      if (this.display[name] !== null) {
        this.display[name].innerHTML = "" + _default;
      }
    }
    return this.target[name];
  };
};


// routines

function appInit() {
  ctx.fillStyle = "black";
  timer.update();
  canvasClear();
  canvasDrawYAx();
  inputProxy.register('appInitControl').addEventListener("click", (e)=>{
    if (states.running) {
      states.running = false;
      inputProxy.target.appInitControl.value = "connect device";
      appClose();
      
    } else {
      states.running = true;
      inputProxy.target.appInitControl.value = "disconnect device";
      appConnectDevice();
    }
  });
  inputProxy.target.appInitControl.value = "connect device";
  inputProxy.register('clearCanvas').addEventListener("click", (e)=>{
    canvasClear();
    canvasDrawYAx(inputProxy.values.yZoom / 100);
  });
  inputProxy.register('pauseCanvas').addEventListener("click", (e)=>{
    states.pause = !states.pause;
    if (states.pause) {
      inputProxy.target.pauseCanvas.value = "resume";
      if (audioCtx !== null) {
        audioCtx.suspend()
      };
    } else {
      inputProxy.target.pauseCanvas.value = "pause";
      if (audioCtx !== null) {
        audioCtx.resume()
      };
    }
  });
  inputProxy.register('showStatsCanvas').addEventListener("click", (e)=>{
    states.stats_visible = !states.stats_visible;
    if (states.stats_visible) {
      inputProxy.target.showStatsCanvas.value = "hide stats";
    } else {
      inputProxy.target.showStatsCanvas.value = "show stats";
    }
  });
  inputProxy.register('captureCanvas').addEventListener("click", (e)=>{
    let link = document.createElement('a');
    link.href = canvas.toDataURL('image/png');
    link.download = 'spectrogram.png';
    link.click();
  });
  inputProxy.register('yZoom', 100).addEventListener("input", (e)=>{
    canvasDrawYAx(inputProxy.values.yZoom / 100);
  });
  inputProxy.register('yZoomReset').addEventListener("click", (e)=>{
    inputProxy.target.yZoom.value = 100;
    inputProxy.values.yZoom = 100;
    inputProxy.display.yZoom.innerHTML = "100";
    canvasDrawYAx(inputProxy.values.yZoom / 100);
  });
  inputProxy.register('mindB', -120, parseInt).addEventListener("input", (e)=>{
    if (inputProxy.values.mindB > inputProxy.values.maxdB + 10) {
      inputProxy.target.maxdB.value = "" + (inputProxy.values.mindB + 10);
      inputProxy.display.maxdB.innerHTML = "" + inputProxy.target.maxdB.value; 
    }
  });
  inputProxy.register('maxdB', -20, parseInt).addEventListener("input", (e)=>{
    if (inputProxy.values.mindB > inputProxy.values.maxdB + 10) {
      inputProxy.target.mindB.value = "" + (inputProxy.values.maxdB - 10);
      inputProxy.display.mindB.innerHTML = "" + inputProxy.target.mindB.value; 
    }
  });
  inputProxy.register('dBReset').addEventListener("click", (e)=>{
    inputProxy.values.mindB = inputProxy.defaults.mindB;
    inputProxy.target.mindB.value = "" + inputProxy.defaults.mindB;
    inputProxy.display.mindB.innerHTML = "" + inputProxy.defaults.mindB;
    inputProxy.values.maxdB = inputProxy.defaults.maxdB;
    inputProxy.target.maxdB.value = "" + inputProxy.defaults.maxdB;
    inputProxy.display.maxdB.innerHTML = "" + inputProxy.defaults.maxdB;
  });
  inputProxy.register('cmapSelect');
  inputProxy.register('pingDisplay').addEventListener("click", (e)=>{
    states.ping_toggle = inputProxy.target.pingDisplay.checked;
  });
  inputProxy.register('canvasSpeedDouble').addEventListener("click", (e)=>{
    states.speed_double = inputProxy.target.canvasSpeedDouble.checked;
  });
  inputProxy.target.canvasSpeedDouble.checked = false;
  inputProxy.target.pingDisplay.checked = false;
};


function appConnectDevice() {
  navigator.mediaDevices.getUserMedia({audio: true})
    .then((stream)=>{
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      audioSource = audioCtx.createMediaStreamSource(stream);
      audioAnalyzer = audioCtx.createAnalyser();
      audioSource.connect(audioAnalyzer);
      audioAnalyzer.fftSize = 4096;
      audioAnalyzer.smoothingTimeConstant = .0;
      audioAnalyzerBuffer = new Uint8Array(audioAnalyzer.frequencyBinCount);
      appUpdate();
    }).catch((err)=>{
      audioCtx = null;
      console.error(err)
    }) 
}


function appUpdate() {
  if (audioCtx === null || audioCtx.state === "closed") {
    return
  };
  audioAnalyzer.minDecibels = Math.min(inputProxy.values.mindB, inputProxy.values.maxdB-5);
  audioAnalyzer.maxDecibels = Math.max(inputProxy.values.mindB+5, inputProxy.values.maxdB);

  audioAnalyzer.getByteFrequencyData(audioAnalyzerBuffer);
  for (let k=0; k<h; k++) {
    r = k/(h-1);
    r /= inputProxy.values.yZoom / 100;
    cmaps[inputProxy.values.cmapSelect].c(arrLinterp(audioAnalyzerBuffer, r)/255, buf[h-k-1]);
  }
  timer.update();
  canvasDraw();
  canvasDrawInfo();
  canvasDrawSecondPing();
  if (audioCtx !== null && audioCtx.state === "suspended") {
    window.requestAnimationFrame(appUpdate);
    return
  };
  window.requestAnimationFrame(appUpdate);
}


function canvasClear() {
  let fill_c = "black";
  ctx.save();
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,w,h);
  ctx.restore();
};


function canvasDrawRoutinePutBuffer(offset=1) {
  const imd = ctx.getImageData(w-1,0,1,h);
  for (i=0; i<imd.data.length; i+=4) {
    y = Math.floor(i/4);
    imd.data[i+0] = buf[y][0];
    imd.data[i+1] = buf[y][1];
    imd.data[i+2] = buf[y][2];
    imd.data[i+3] = buf[y][3];
  };
  ctx.putImageData(imd, w-offset, 0);
}


function canvasDrawRoutineShiftFrame(offset=1) {
  const imd = ctx.getImageData(1,0,w-offset,h);
  ctx.putImageData(imd, 0, 0);
}


function canvasDraw() {
  if (states.pause) {
    return
  }
  canvasDrawRoutinePutBuffer(y_ax_width+1);
  canvasDrawRoutineShiftFrame(y_ax_width+1);
  if (states.speed_double) {
    canvasDrawRoutineShiftFrame(y_ax_width+1);
  }
};


function canvasDrawSecondPing() {
  if (!states.ping_toggle) {
    return
  };
  r = timer.progress_t(1000);
  if (r < .10 & states.ping_flag) {
    states.ping_flag = false;
    ctx.save();
    ctx.fillStyle = "white";
    ctx.fillRect(w-2-y_ax_width,22,2,10);
    ctx.fillStyle = "rgba(77, 77, 77, 0.38)";
    ctx.fillRect(w-2-y_ax_width,22,2,h-22);
    ctx.restore();
  };
  if (r > .90 & !states.ping_flag) {
    states.ping_flag = true;
  };
};


function canvasDrawInfo() {
  if (!states.stats_visible) {
    return
  }
  const iw = 120;
  const iy = 18;
  ctx.save();
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, iw, iy);
  ctx.fillStyle = "white";
  ctx.font = "16px monospace";
  ctx.textBaseline = "middle";
  ctx.fillText(timer.dt + "ms", 8, iy/2);
  ctx.fillText("fps:" + timer.fps, 50, iy/2);
  ctx.restore();
};


const y_ax_freq = {};
y_ax_freq[20] = "20";
y_ax_freq[100] = "100";
y_ax_freq[500] = "500";
y_ax_freq[1000] = "1k";
y_ax_freq[2000] = "2k";
y_ax_freq[3000] = "3k";
y_ax_freq[4000] = "4k";
y_ax_freq[5000] = "5k";
y_ax_freq[6000] = "6k";
y_ax_freq[8000] = "8k";
y_ax_freq[12000] = "12k";
y_ax_freq[16000] = "16k";
y_ax_freq[20000] = "20k";
y_ax_freq[24000] = "24k";

function canvasDrawYAx(scale=1, offset=0) {
  ctx.save();
  ctx.fillStyle = "black";
  ctx.fillRect(w-y_ax_width, 0, y_ax_width, h);
  ctx.font = "12px monospace";
  ctx.textBaseline = "middle";
  for (i in y_ax_freq) {
    r = i / 24000 * scale + .001;
    if (!(r < .005) && !(r > .99)) {
      y = ftoi((1-r)*h);
      ctx.fillStyle = "white";
      ctx.fillText(y_ax_freq[i], w-y_ax_width+6, y);
      ctx.fillStyle = "gray";
      ctx.fillRect(w-y_ax_width, y, 5, 1);
    }
  }
  ctx.restore();
}


function appClose() {
  if (audioCtx !== null && audioCtx.state !== "closed") {
    audioCtx.close().then(() => {
      audioCtx = null;
    })
  }
};


window.onbeforeunload = (event) => {
  appClose();
};


appInit();

}</script>




  </div>
  

  
  <br>
  <br>
  <br>
  <br>
  <p class="tc">Built with <a a target="_blank" class="extern" href="https://gohugo.io/">Hugo</a> | previoip (c) 2025</p>
</body>

</html>


