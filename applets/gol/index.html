<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-8HTK24ZVY8"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-8HTK24ZVY8');
        }
      </script>
    
  


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/highlight.css?v=1.0.0">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">







<style>:root{--f:1em;--w:30}html{margin:0 2em;max-width:calc(var(--f)*var(--w));font-size:var(--f)}body{margin:0;padding:0;font-family:monospace;scrollbar-face-color:ThreeDFace!important;scrollbar-shadow-color:ThreeDDarkShadow!important;scrollbar-highlight-color:ThreeDHighlight!important;scrollbar-3dlight-color:ThreeDLightShadow!important;scrollbar-darkshadow-color:ThreeDDarkShadow!important;scrollbar-track-color:Scrollbar!important;scrollbar-arrow-color:ButtonText!important}small{font-size:calc(var(--f)*.82)}*{font-size:inherit}p{padding-left:calc(var(--f)*1.6)}p canvas{outline:1px solid #000;width:calc(100% - var(--f)*1.6)}a{color:#1c69e5;text-decoration:underline}a:hover{color:#2072f5;text-decoration:none}a:active{color:#0062ff;text-decoration:none;background-color:var(--tx-c-hover)}blockquote{opacity:.75;background-color:#e9e61c68}div.mermaid .edgeLabel{padding:.2rem}img,div.mermaid svg{margin:auto;display:block;max-width:min(100%,calc(var(--f)*var(--w)));min-width:100px;background-color:#282a36;border-radius:.6rem}code:not([class]){background-color:#8e98d575;padding:0 .2em;border-radius:.2em}div.highlight pre{padding:1rem;border-radius:.6rem;overflow:scroll;overflow-y:auto;overflow-x:auto}div.highlight pre code span{margin-block-end:.1em}.disabled,.failed{pointer-events:none}.tc{padding-left:0;padding-right:0;text-align:center}.o50{opacity:.5}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:#43454ce6;border-radius:3px}::-webkit-scrollbar-thumb{background:#c1cdf6e6;border-radius:3px}input,select,textarea{font:inherit}#control div{display:flex;align-items:center;margin-top:.6em}#control input,#control select,#control textarea{display:inline-block;margin:0 .5em}#control textarea{resize:vertical}#control p{margin:0;width:2rem}</style>


  <title>
Conway&#39;s game of life (64x64) &ndash; dumb by default
</title>
</head>

<body><div style="background-color: #69696969;">
  <br>
  <h1 class="tc">dumb by default</h1>
  
<nav class="tc">
[<a href="/">Home</a>]&nbsp;[<a href="/about/">About</a>]&nbsp;[<a href="/posts/">Posts</a>]&nbsp;[<a href="/resources/">Resources</a>]&nbsp;[<a href="/applets/">Applets</a>]&nbsp;
</nav><hr>
</div><p style="padding: 0;">


<span>dir: <i>








<a href="/">Home</a> &sol;






<a href="/applets/">Applets</a> &sol;






<span>Conway&#39;s game of life (64x64)</span>

</i></span>




      <br>
      
      
      
      <span>published-date: 11 Jun 2025 09:25 &#43;0700</span><br>
      
      
      
      
          
    </p>
  <h1 class="tc">Conway&#39;s game of life (64x64)</h1>
  <hr>
  <div>
    

<p><canvas id="viewport" width=1080 height=1080></canvas></p>
<div id="control">
  <div>
    <input id="clearSim" type="button" value="clear">
    <input id="stepSim" type="button" value="step">
    <input id="pauseSim" type="button" value="pause">
  </div>
  <div>
    <label for="presetSelect">preset</label>
    <select name="presetSelect" id="presetSelect">
      <option value="placeholder"></option>
    </select>
    <input id="presetLoad" type="button" value="load">
  </div>
  <div>
    <label for="rleInput">rle:</label>
    <textarea id="rleInput" name="rleInput" minlength="0" maxlength="1024" size="10" rows="4" style="width:100%"></textarea>
  </div>
  <div>
    <label for="rleOffsetX">rle offset:</label>
    <input id="rleOffsetX" type="number" value="0" min="0" max="64">
    <input id="rleOffsetY" type="number" value="0" min="0" max="64">
    <input id="rleLoad" type="button" value="load">
  </div>
</div>

<div class="highlight" inject="true"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="ln">  1</span><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;viewport&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&#34;2d&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;alpha&#34;</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="kr">const</span> <span class="nx">ftoi</span> <span class="o">=</span> <span class="p">(</span><span class="nx">v</span><span class="p">)=&gt;</span><span class="o">~~</span><span class="nx">v</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="kr">const</span> <span class="nx">iwrap</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?</span><span class="nx">b</span><span class="o">+</span><span class="p">(</span><span class="nx">a</span><span class="o">%</span><span class="nx">b</span><span class="p">)</span><span class="o">:</span><span class="nx">a</span><span class="o">%</span><span class="nx">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="kr">const</span> <span class="nx">isNumeric</span> <span class="o">=</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nb">isFinite</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="kd">var</span> <span class="nx">sim</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="kd">var</span> <span class="nx">inputProxy</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="kr">const</span> <span class="nx">states</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="kd">function</span> <span class="nx">cInputProxy</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">values</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">  <span class="k">this</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">_default</span><span class="o">=</span><span class="kc">null</span><span class="p">,</span> <span class="nx">cast</span><span class="o">=</span><span class="p">(</span><span class="nx">v</span><span class="p">)=&gt;</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;#&#34;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&#34;_value&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">defaults</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;input&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">_default</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cast</span><span class="p">(</span><span class="nx">_default</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">_default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="kr">class</span> <span class="nx">ac2DMatrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  <span class="nx">itox</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">i</span> <span class="o">%</span> <span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">  <span class="nx">itoy</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">i</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">)};</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">  <span class="nx">ctoi</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">)};</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">  <span class="nx">get</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">ctoi</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)]};</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">  <span class="nx">set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">ctoi</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;};</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">  <span class="nx">map</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cb</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">])}};</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">  <span class="nx">zeros</span><span class="p">()</span> <span class="p">{</span><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">}};</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">  <span class="nx">sum</span><span class="p">()</span> <span class="p">{</span><span class="kd">let</span> <span class="nx">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="nx">s</span><span class="o">+=</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]};</span> <span class="k">return</span> <span class="nx">s</span><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">  <span class="nx">count</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span><span class="kd">let</span> <span class="nx">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buf</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">===</span><span class="nx">o</span><span class="p">){</span><span class="nx">s</span><span class="o">+=</span><span class="mi">1</span><span class="p">}};</span> <span class="k">return</span> <span class="nx">s</span><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">  <span class="nx">load2DArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">x</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">y</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">y</span><span class="p">][</span><span class="nx">x</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="nx">to2DArray</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">    <span class="kd">let</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">y</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">x</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">        <span class="nx">r</span><span class="p">[</span><span class="nx">y</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="nx">queryKernel</span><span class="p">(</span><span class="nx">mk</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">wrap</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">    <span class="kr">const</span> <span class="nx">lx</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">mk</span><span class="p">.</span><span class="nx">w</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">    <span class="kr">const</span> <span class="nx">ly</span> <span class="o">=</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">mk</span><span class="p">.</span><span class="nx">h</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">kx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">kx</span><span class="o">&lt;</span><span class="nx">mk</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span> <span class="nx">kx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">ky</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">ky</span><span class="o">&lt;</span><span class="nx">mk</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span> <span class="nx">ky</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">        <span class="kd">let</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">x</span><span class="o">+</span><span class="nx">kx</span><span class="o">-</span><span class="nx">lx</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">        <span class="kd">let</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">y</span><span class="o">+</span><span class="nx">ky</span><span class="o">-</span><span class="nx">ly</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">wrap</span><span class="o">||</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">          <span class="nx">dx</span> <span class="o">=</span> <span class="nx">iwrap</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">          <span class="nx">dy</span> <span class="o">=</span> <span class="nx">iwrap</span><span class="p">(</span><span class="nx">dy</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">        <span class="nx">mk</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">kx</span><span class="p">,</span> <span class="nx">ky</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="o">||</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">
</span></span><span class="line"><span class="ln"> 88</span><span class="cl"><span class="kr">class</span> <span class="nx">cUint8Matrix</span> <span class="kr">extends</span> <span class="nx">ac2DMatrix</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="nx">constructor</span> <span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="kr">super</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">w</span><span class="o">*</span><span class="nx">h</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">l</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">
</span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="kr">class</span> <span class="nx">ParticleSim</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="nx">constructor</span> <span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">l</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">zb</span> <span class="o">=</span> <span class="p">[</span><span class="k">new</span> <span class="nx">cUint8Matrix</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">),</span> <span class="k">new</span> <span class="nx">cUint8Matrix</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">)];</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">rules</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;white&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">({</span><span class="nx">length</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">colors</span><span class="p">.</span><span class="nx">length</span><span class="o">+</span><span class="mi">1</span><span class="p">},</span> <span class="p">()=&gt;[])</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">  <span class="nx">swpz</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">  <span class="nx">clearRenderQueue</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">n</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">length</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">k</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span><span class="k">throw</span> <span class="s2">&#34;kernel is null&#34;</span><span class="p">};</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">    <span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">    <span class="kd">let</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">    <span class="kd">let</span> <span class="nx">v</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">    <span class="nx">b</span><span class="p">.</span><span class="nx">zeros</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">clearRenderQueue</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">      <span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">itox</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">      <span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">itoy</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">      <span class="nx">a</span><span class="p">.</span><span class="nx">queryKernel</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">      <span class="nx">v</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">      <span class="nx">v</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">rules</span><span class="p">[</span><span class="nx">v</span><span class="p">](</span><span class="k">this</span><span class="p">.</span><span class="nx">k</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">[</span><span class="nx">v</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">      <span class="nx">b</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">itox</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="nx">b</span><span class="p">.</span><span class="nx">itoy</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">swpz</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">  <span class="nx">setCell</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">iwrap</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">),</span> <span class="nx">iwrap</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">),</span> <span class="nx">v</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">[</span><span class="nx">v</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">.</span><span class="nx">ctoi</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">  <span class="nx">render</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">    <span class="kr">const</span> <span class="nx">rx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">w</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">    <span class="kr">const</span> <span class="nx">ry</span> <span class="o">=</span> <span class="p">(</span><span class="nx">h</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">    <span class="kr">const</span> <span class="nx">px</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">n</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">colors</span><span class="p">[(</span><span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="k">this</span><span class="p">.</span><span class="nx">colors</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">          <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderQueue</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">pop</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">          <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">rx</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">.</span><span class="nx">itox</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">+</span><span class="nx">px</span><span class="p">,</span> <span class="nx">ry</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">z</span><span class="p">.</span><span class="nx">itoy</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="o">+</span><span class="nx">px</span><span class="p">,</span> <span class="nx">rx</span><span class="o">-</span><span class="nx">px</span><span class="p">,</span> <span class="nx">ry</span><span class="o">-</span><span class="nx">px</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl">        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">  <span class="nx">reset</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">zeros</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">zb</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">zeros</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">
</span></span><span class="line"><span class="ln">167</span><span class="cl">
</span></span><span class="line"><span class="ln">168</span><span class="cl"><span class="kr">const</span> <span class="nx">rules</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl"><span class="nx">rules</span><span class="p">[</span><span class="s1">&#39;B3/S23&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sim</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">  <span class="nx">sim</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cUint8Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">  <span class="nx">sim</span><span class="p">.</span><span class="nx">rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">    <span class="kd">let</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">k</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl">    <span class="k">return</span> <span class="nx">c</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">  <span class="nx">sim</span><span class="p">.</span><span class="nx">rules</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">    <span class="kd">let</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">k</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="nx">c</span><span class="o">-</span><span class="mi">1</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">c</span><span class="o">-</span><span class="mi">1</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">178</span><span class="cl">  <span class="p">};</span>  
</span></span><span class="line"><span class="ln">179</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">
</span></span><span class="line"><span class="ln">181</span><span class="cl">
</span></span><span class="line"><span class="ln">182</span><span class="cl"><span class="kd">function</span> <span class="nx">validateRLE</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">  <span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s/g</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">184</span><span class="cl">  <span class="kd">let</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">185</span><span class="cl">  <span class="kd">let</span> <span class="nx">chr</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">    <span class="nx">chr</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl">    <span class="nx">ret</span> <span class="o">&amp;&amp;=</span> <span class="p">(</span><span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;$&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;b&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;o&#34;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">isNumeric</span><span class="p">(</span><span class="nx">chr</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>  <span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">189</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl">  <span class="k">return</span> <span class="nx">ret</span>
</span></span><span class="line"><span class="ln">191</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">192</span><span class="cl">
</span></span><span class="line"><span class="ln">193</span><span class="cl"><span class="kd">function</span> <span class="nx">parseRLE</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">194</span><span class="cl">  <span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s/g</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">195</span><span class="cl">  <span class="kd">let</span> <span class="nx">chr</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">196</span><span class="cl">  <span class="kd">let</span> <span class="nx">num</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">197</span><span class="cl">  <span class="kd">let</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">198</span><span class="cl">  <span class="kd">let</span> <span class="nx">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">199</span><span class="cl">  <span class="kd">let</span> <span class="nx">off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">200</span><span class="cl">  <span class="kd">let</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="ln">201</span><span class="cl">  <span class="kr">const</span> <span class="nx">flushNum</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">202</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">num</span> <span class="o">===</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">203</span><span class="cl">      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">204</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">205</span><span class="cl">    <span class="nx">tmp</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">206</span><span class="cl">    <span class="nx">num</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">207</span><span class="cl">    <span class="k">return</span> <span class="nx">tmp</span>
</span></span><span class="line"><span class="ln">208</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">209</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">210</span><span class="cl">    <span class="nx">chr</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">211</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;!&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">212</span><span class="cl">      <span class="k">break</span>
</span></span><span class="line"><span class="ln">213</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isNumeric</span><span class="p">(</span><span class="nx">chr</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">214</span><span class="cl">      <span class="nx">num</span> <span class="o">+=</span> <span class="nx">chr</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">215</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;$&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">216</span><span class="cl">      <span class="nx">row</span> <span class="o">+=</span> <span class="nx">flushNum</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">217</span><span class="cl">      <span class="nx">off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">218</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;b&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">219</span><span class="cl">      <span class="nx">off</span> <span class="o">+=</span> <span class="nx">flushNum</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">220</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">chr</span> <span class="o">===</span> <span class="s2">&#34;o&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">221</span><span class="cl">      <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">flushNum</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">222</span><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">tmp</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">223</span><span class="cl">        <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">off</span><span class="p">,</span> <span class="nx">row</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">224</span><span class="cl">        <span class="nx">off</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">225</span><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="ln">226</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">227</span><span class="cl">      <span class="k">throw</span> <span class="s2">&#34;rule undefined for token &#34;</span> <span class="o">+</span> <span class="nx">chr</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">228</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">229</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">230</span><span class="cl">  <span class="k">return</span> <span class="nx">ret</span>
</span></span><span class="line"><span class="ln">231</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">232</span><span class="cl">
</span></span><span class="line"><span class="ln">233</span><span class="cl"><span class="kr">const</span> <span class="nx">presets</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="ln">234</span><span class="cl"><span class="kr">const</span> <span class="nx">e1ul</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
</span></span><span class="line"><span class="ln">235</span><span class="cl"><span class="kr">const</span> <span class="nx">e1dr</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
</span></span><span class="line"><span class="ln">236</span><span class="cl">
</span></span><span class="line"><span class="ln">237</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;placeholder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">238</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="ln">239</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p1dr</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">240</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p2dr</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">241</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p1ur</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">242</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p2ur</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">243</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p1dl</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">244</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p2dl</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">245</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p1ul</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">246</span><span class="cl"><span class="kr">const</span> <span class="nx">g1p2ul</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">247</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">248</span><span class="cl">  <span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider1&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">([[</span> <span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">00</span><span class="p">,</span> <span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="p">],</span> <span class="p">...(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">5</span> <span class="o">?</span> <span class="nx">g1p1dr</span><span class="o">:</span> <span class="nx">g1p2dr</span><span class="p">)])</span>
</span></span><span class="line"><span class="ln">249</span><span class="cl">  <span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider1&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">([[</span> <span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">32</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="o">-</span><span class="mi">8</span><span class="p">],</span> <span class="p">...(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">5</span> <span class="o">?</span> <span class="nx">g1p1ul</span><span class="o">:</span> <span class="nx">g1p2ul</span><span class="p">)])</span>
</span></span><span class="line"><span class="ln">250</span><span class="cl">  <span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider1&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">([[</span><span class="o">-</span><span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">32</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="p">],</span> <span class="p">...(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">5</span> <span class="o">?</span> <span class="nx">g1p1ur</span><span class="o">:</span> <span class="nx">g1p2ur</span><span class="p">)])</span>
</span></span><span class="line"><span class="ln">251</span><span class="cl">  <span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider1&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">([[</span><span class="o">-</span><span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="o">+</span><span class="mi">8</span><span class="o">-</span><span class="mi">8</span> <span class="p">,</span> <span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="o">-</span><span class="mi">8</span><span class="p">],</span> <span class="p">...(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">5</span> <span class="o">?</span> <span class="nx">g1p1dl</span><span class="o">:</span> <span class="nx">g1p2dl</span><span class="p">)])</span>
</span></span><span class="line"><span class="ln">252</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">253</span><span class="cl">
</span></span><span class="line"><span class="ln">254</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="ln">255</span><span class="cl"><span class="kr">const</span> <span class="nx">g2p1</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">256</span><span class="cl"><span class="kr">const</span> <span class="nx">g2p2</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">257</span><span class="cl"><span class="kr">const</span> <span class="nx">g2p3</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">258</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider2&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">([[</span><span class="nx">i</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="o">+</span><span class="mi">0</span><span class="p">],</span> <span class="p">...</span><span class="nx">g2p1</span><span class="p">])};</span>
</span></span><span class="line"><span class="ln">259</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider2&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">([[</span><span class="nx">i</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="o">+</span><span class="mi">8</span><span class="p">],</span> <span class="p">...</span><span class="nx">g2p2</span><span class="p">])};</span>
</span></span><span class="line"><span class="ln">260</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;glider2&#39;</span><span class="p">].</span><span class="nx">push</span><span class="p">([[</span><span class="nx">i</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span><span class="mi">20</span><span class="o">+</span><span class="mi">16</span><span class="p">],</span> <span class="p">...</span><span class="nx">g2p3</span><span class="p">])};</span>
</span></span><span class="line"><span class="ln">261</span><span class="cl">
</span></span><span class="line"><span class="ln">262</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;gosper-gun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">22</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">34</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">35</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">263</span><span class="cl">  <span class="p">[</span><span class="mi">21</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">34</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">35</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">17</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">22</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">264</span><span class="cl">  <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span><span class="mi">60</span><span class="p">],...</span><span class="nx">e1ul</span><span class="p">]];</span>
</span></span><span class="line"><span class="ln">265</span><span class="cl">
</span></span><span class="line"><span class="ln">266</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;simkin-gun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">14</span><span class="p">,</span><span class="mi">24</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">22</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">23</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">267</span><span class="cl">  <span class="p">[</span><span class="mi">25</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">26</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">27</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">28</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">31</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">32</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">22</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">23</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">27</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">31</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">32</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">26</span><span class="p">,</span><span class="mi">13</span><span class="p">]],</span>
</span></span><span class="line"><span class="ln">268</span><span class="cl">  <span class="p">[[</span><span class="mi">54</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="o">+</span><span class="mi">20</span><span class="p">],...</span><span class="nx">e1ul</span><span class="p">],[[</span><span class="mi">7</span><span class="o">-</span><span class="mi">24</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="mi">24</span><span class="p">],...</span><span class="nx">e1dr</span><span class="p">]]</span>
</span></span><span class="line"><span class="ln">269</span><span class="cl">
</span></span><span class="line"><span class="ln">270</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;r-pentomino&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">271</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;diehard&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">272</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;acorn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">273</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;inf1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">274</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;inf2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">275</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;86P6H3V0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">16</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">25</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">26</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">27</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">28</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">276</span><span class="cl">  <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">19</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">23</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">28</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">29</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">18</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">277</span><span class="cl">  <span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">23</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">26</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">28</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">30</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">17</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">23</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">278</span><span class="cl">  <span class="p">[</span><span class="mi">28</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">30</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">31</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">18</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">23</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">27</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">32</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">17</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">279</span><span class="cl">  <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">18</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">20</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">31</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">32</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">18</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">18</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">22</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">280</span><span class="cl">  <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">21</span><span class="p">,</span><span class="mi">10</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">281</span><span class="cl"><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;74P8H2V0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">24</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">282</span><span class="cl">  <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">283</span><span class="cl">  <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">284</span><span class="cl">  <span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">12</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">13</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">17</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">17</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">17</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">18</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">18</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">18</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">19</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">285</span><span class="cl">  <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">19</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">19</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">19</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">20</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">20</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]]];</span>
</span></span><span class="line"><span class="ln">286</span><span class="cl">
</span></span><span class="line"><span class="ln">287</span><span class="cl">
</span></span><span class="line"><span class="ln">288</span><span class="cl"><span class="c1">// https://conwaylife.com/forums/viewtopic.php?&amp;p=156408#p156408 p89
</span></span></span><span class="line"><span class="ln">289</span><span class="cl"><span class="c1"></span><span class="nx">presets</span><span class="p">[</span><span class="s1">&#39;hassler-unamed (&gt;:3)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span> <span class="p">...</span><span class="nx">parseRLE</span><span class="p">(</span><span class="s2">&#34;14bo2$14b3o$14bo2bo$14bo2bo12bo$28b3o$17b2o8bo$18bo8b2o5b2o$34bo$&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">290</span><span class="cl">                                                         <span class="s2">&#34;25bo6bobo$26bo5b2o$24bo$23b2ob2o$14b3o3b2ob3o2bo$ob3o8bobo6b3o3bo&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">291</span><span class="cl">                                                         <span class="s2">&#34;$2bo10b2o8bob3o$2bo10bo10b3o$3b2obo$6b2o2$13bo$13bo11b2o$14bo11bo&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">292</span><span class="cl">                                                         <span class="s2">&#34;$12b4o7b3o$11b4obo6bo$9bo3bob2o4bobo$10bobo2b2o4b2o$6b2o4bo2bo$5b&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">293</span><span class="cl">                                                         <span class="s2">&#34;obo5b2o$5bo$4b2o2$9b2o$10bo$7b3o$7bo!&#34;</span><span class="p">)]]</span>
</span></span><span class="line"><span class="ln">294</span><span class="cl">
</span></span><span class="line"><span class="ln">295</span><span class="cl"><span class="kd">function</span> <span class="nx">loadCoos</span><span class="p">(</span><span class="nx">sim</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">296</span><span class="cl">  <span class="kd">let</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">297</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">298</span><span class="cl">    <span class="nx">sim</span><span class="p">.</span><span class="nx">setCell</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">o</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">o</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">299</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">300</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">301</span><span class="cl">
</span></span><span class="line"><span class="ln">302</span><span class="cl"><span class="kd">function</span> <span class="nx">loadPreset</span><span class="p">(</span><span class="nx">sim</span><span class="p">,</span> <span class="nx">kind</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">303</span><span class="cl">  <span class="nx">sim</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">304</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">presets</span><span class="p">[</span><span class="nx">kind</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">305</span><span class="cl">    <span class="nx">loadCoos</span><span class="p">(</span><span class="nx">sim</span><span class="p">,</span> <span class="nx">presets</span><span class="p">[</span><span class="nx">kind</span><span class="p">][</span><span class="nx">j</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">306</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">307</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">308</span><span class="cl">    <span class="nx">sim</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">309</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">310</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">311</span><span class="cl">
</span></span><span class="line"><span class="ln">312</span><span class="cl">
</span></span><span class="line"><span class="ln">313</span><span class="cl"><span class="kd">function</span> <span class="nx">appInit</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">314</span><span class="cl">  <span class="nx">inputProxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cInputProxy</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">315</span><span class="cl">  <span class="nx">sim</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ParticleSim</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">316</span><span class="cl">  <span class="nx">rules</span><span class="p">[</span><span class="s1">&#39;B3/S23&#39;</span><span class="p">](</span><span class="nx">sim</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">317</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;clearSim&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">318</span><span class="cl">    <span class="nx">sim</span><span class="p">.</span><span class="nx">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">319</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">320</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;stepSim&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">321</span><span class="cl">    <span class="nx">simStep</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">322</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">323</span><span class="cl">      <span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">324</span><span class="cl">      <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">pauseSim</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;resume&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">325</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">326</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">327</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;pauseSim&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">328</span><span class="cl">    <span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">329</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">330</span><span class="cl">      <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;pause&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">331</span><span class="cl">      <span class="nx">loop</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">332</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">333</span><span class="cl">      <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;resume&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">334</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">335</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">336</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;presetSelect&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">337</span><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">338</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">339</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">340</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">presets</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">341</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">===</span> <span class="s1">&#39;placeholder&#39;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">342</span><span class="cl">    <span class="kd">let</span> <span class="nx">opt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">343</span><span class="cl">    <span class="nx">opt</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">k</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">344</span><span class="cl">    <span class="nx">opt</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">k</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">345</span><span class="cl">    <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">346</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">347</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;rleOffsetX&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">348</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;rleOffsetY&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">349</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;rleInput&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">350</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;rleLoad&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">351</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">validateRLE</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">rleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">352</span><span class="cl">      <span class="nx">sim</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">353</span><span class="cl">      <span class="nx">loadCoos</span><span class="p">(</span><span class="nx">sim</span><span class="p">,</span> <span class="p">[[</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">rleOffsetX</span><span class="p">,</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">rleOffsetY</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">354</span><span class="cl">                     <span class="p">...</span><span class="nx">parseRLE</span><span class="p">(</span><span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">rleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">)])</span>
</span></span><span class="line"><span class="ln">355</span><span class="cl">      <span class="nx">sim</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">356</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">357</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">358</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;presetLoad&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="ln">359</span><span class="cl">    <span class="nx">loadPreset</span><span class="p">(</span><span class="nx">sim</span><span class="p">,</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">360</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln">361</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">362</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">presetSelect</span> <span class="o">=</span> <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">presetSelect</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">363</span><span class="cl">  <span class="nx">inputProxy</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">rleInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;15bo$13b2o$13b2o$16bo$13b2obo$14bo$14bobo$15b2o$15bo$19bo$9b3o6b2o$10b2o5b3o$&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">364</span><span class="cl">                                     <span class="s2">&#34;11bo$3b2ob2o17bob2o$o6b2o14b3ob2o$b2ob3o14b2o6bo$b2obo17b2ob2o$18bo$10b3o5b2o&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">365</span><span class="cl">                                     <span class="s2">&#34;$10b2o6b3o$10bo$14bo$13b2o$13bobo$15bo$13bob2o$13bo$15b2o$15b2o$14bo!&#34;</span>
</span></span><span class="line"><span class="ln">366</span><span class="cl">
</span></span><span class="line"><span class="ln">367</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">368</span><span class="cl">
</span></span><span class="line"><span class="ln">369</span><span class="cl">
</span></span><span class="line"><span class="ln">370</span><span class="cl">
</span></span><span class="line"><span class="ln">371</span><span class="cl"><span class="kd">function</span> <span class="nx">simStep</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">372</span><span class="cl">  <span class="nx">sim</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">373</span><span class="cl">  <span class="nx">sim</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">374</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">375</span><span class="cl">
</span></span><span class="line"><span class="ln">376</span><span class="cl">
</span></span><span class="line"><span class="ln">377</span><span class="cl"><span class="kd">let</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">378</span><span class="cl"><span class="kd">function</span> <span class="nx">loop</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">379</span><span class="cl">  <span class="nx">c</span> <span class="o">%=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">380</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">simStep</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">381</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">states</span><span class="p">.</span><span class="nx">running</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">382</span><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">loop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">383</span><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="ln">384</span><span class="cl">  <span class="nx">c</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">385</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">386</span><span class="cl">
</span></span><span class="line"><span class="ln">387</span><span class="cl"><span class="nx">appInit</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">388</span><span class="cl"><span class="nx">loop</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">389</span><span class="cl">
</span></span><span class="line"><span class="ln">390</span><span class="cl"><span class="p">};</span></span></span></code></pre></div>

<script defer>window.onload = function()
{

const canvas = document.getElementById("viewport");
const ctx = canvas.getContext("2d", {"alpha": false});
const ftoi = (v)=>~~v;
const iwrap = (a, b) => a<0?b+(a%b):a%b;
const isNumeric = (v) => !isNaN(parseFloat(v)) && isFinite(v);
var sim = null;
var inputProxy = null;
var timer = null;
const states = {};
states.running = 1;

function cInputProxy () {
  this.values = {};
  this.target = {};
  this.display = {};
  this.defaults = {};
  this.register = (name, _default=null, cast=(v)=>v) => {
    this.target[name] = document.getElementById(name);
    this.display[name] = this.target[name].parentElement.querySelector("#" + name + "_value");
    this.values[name] = cast(this.target[name].value);
    this.defaults[name] = _default;
    this.target[name].addEventListener("input", (event) => {
      this.values[name] = cast(event.target.value);
      if (this.display[name] !== null) {
        this.display[name].innerHTML = "" + event.target.value;
      };
    });
    if (_default !== null) {
      this.target[name].value = "" + _default;
      this.values[name] = cast(_default);
      if (this.display[name] !== null) {
        this.display[name].innerHTML = "" + _default;
      };
    };
    return this.target[name];
  };
};


class ac2DMatrix {
  itox(i) {return i % this.w};
  itoy(i) {return ftoi(i / this.w)};
  ctoi(x, y) {return x + (y * this.w)};
  get(x, y) {return this.buf[this.ctoi(x, y)]};
  set(x, y, v) {this.buf[this.ctoi(x, y)] = v;};
  map(cb) {for (let i=0; i<this.l; i++){this.buf[i] = cb(this.buf[i])}};
  zeros() {for (let i=0; i<this.l; i++) {this.buf[i] = 0}};
  sum() {let s=0; for (let i=0; i<this.l; i++) {s+=this.buf[i]}; return s};
  count(o) {let s=0; for (let i=0; i<this.l; i++) {if(this.buf[i]===o){s+=1}}; return s};
  load2DArray(arr) {
    for (let x=0; x<this.w; x++) {
      for (let y=0; y<this.h; y++) {
        this.set(x, y, arr[y][x]);
      };
    };
  };
  to2DArray() {
    let r = []
    for (let y=0; y<this.h; y++) {
      r.push([]);
      for (let x=0; x<this.w; x++) {
        r[y].push(this.get(x, y));
      };
    };
    return r;
  };
  queryKernel(mk, x, y, wrap) {
    const lx = ftoi(mk.w/2);
    const ly = ftoi(mk.h/2);
    for (let kx=0; kx<mk.w; kx++) {
      for (let ky=0; ky<mk.h; ky++) {
        let dx = x+kx-lx;
        let dy = y+ky-ly;
        if (wrap||false) {
          dx = iwrap(dx, this.w)
          dy = iwrap(dy, this.h)
        };
        mk.set(kx, ky, this.get(dx, dy) || null)
      };
    };
  };
};


class cUint8Matrix extends ac2DMatrix {
  constructor (w, h) {
    super();
    this.w = w; this.h = h; this.l = w*h;
    this.buf = new Uint8Array(this.l);
  };
};


class ParticleSim {
  constructor (w, h) {
    this.w = w; this.h = h, this.l=this.w*this.h;
    this.zb = [new cUint8Matrix(this.w, this.h), new cUint8Matrix(this.w, this.h)];
    this.z = this.zb[0];
    this.k = null;
    this.rules = {};
    this.colors = ["white"];
    this.renderQueue = Array.from({length:this.colors.length+1}, ()=>[])
  };
  swpz() {
    this.z = this.zb[1];
    this.zb[1] = this.zb[0];
    this.zb[0] = this.z;
  };
  clearRenderQueue() {
    for (let n=0; n<this.renderQueue.length; n++) {
      if (this.renderQueue[n].length){
        this.renderQueue[n].length = 0;
      };
    };
  };
  update() {
    if (this.k === null) {throw "kernel is null"};
    let a = this.zb[0];
    let b = this.zb[1];
    let v = null;
    b.zeros();
    this.clearRenderQueue()
    for (let i=0; i<a.l; i++) {
      let x = a.itox(i);
      let y = a.itoy(i);
      a.queryKernel(this.k, x, y, true);
      v = a.get(x,y);
      v = this.rules[v](this.k);
      if (v > 0) {
        this.renderQueue[v].push(i);
      };
      b.set(b.itox(i), b.itoy(i), v);
    };
    this.swpz();
  };
  setCell(x, y, v) {
    this.z.set(iwrap(x, this.w), iwrap(y, this.h), v);
    this.renderQueue[v].push(this.z.ctoi(x, y))
  };
  render(ctx, w, h) {
    const rx = (w-1) / this.w;
    const ry = (h-1) / this.h;
    const px = 2;
    var i;
    ctx.clearRect(0,0,w,h);
    for (let n=0; n<this.renderQueue.length; n++) {
      if (this.renderQueue[n].length > 0) {
        ctx.beginPath();
        ctx.fillStyle = this.colors[(n+1)%this.colors.length]
        while (this.renderQueue[n].length > 0) {
          i = this.renderQueue[n].pop();
          ctx.rect(rx*this.z.itox(i)+px, ry*this.z.itoy(i)+px, rx-px, ry-px)
        };
        ctx.fill();
      };
    };
  };
  reset() {
    this.zb[0].zeros();
    this.zb[1].zeros();
  };
};


const rules = {};
rules['B3/S23'] = (sim) => {
  sim.k = new cUint8Matrix(3, 3);
  sim.rules[0] = (k) => {
    let c = k.count(1);
    return c === 3 ? 1 : 0;
  };
  sim.rules[1] = (k) => {
    let c = k.count(1);
    return (c-1 === 2 || c-1 === 3) ? 1 : 0;
  };  
};


function validateRLE(s) {
  s = s.replace(/\s/g, "");
  let ret = true;
  let chr = "";
  for (let i=0; i<s.length; i++) {
    chr = s.charAt(i);
    ret &&= (chr === "$") || (chr === "b") || (chr === "o") || isNumeric(chr) || (i === s.length - 1 &&  chr === "!");
  }
  return ret
}

function parseRLE(s) {
  s = s.replace(/\s/g, "");
  let chr = "";
  let num = "";
  let tmp = 0;
  let row = 0;
  let off = 0;
  let ret = [];
  const flushNum = () => {
    if (num === "") {
      return 1;
    };
    tmp = parseInt(num);
    num = "";
    return tmp
  };
  for (let i=0; i<s.length; i++) {
    chr = s.charAt(i);
    if (chr === "!") {
      break
    } else if (isNumeric(chr)) {
      num += chr;
    } else if (chr === "$") {
      row += flushNum();
      off = 0;
    } else if (chr === "b") {
      off += flushNum();
    } else if (chr === "o") {
      tmp = flushNum();
      for (let j=0; j<tmp; j++) {
        ret.push([off, row]);
        off += 1;
      };
    } else {
      throw "rule undefined for token " + chr;
    };
  };
  return ret
};

const presets = {};
const e1ul = [[0,0],[1,0],[0,1],[2,1],[2,2],[2,3],[3,3]]
const e1dr = [[0,0],[0,1],[1,1],[2,1],[3,2],[2,3],[3,3]]

presets['placeholder'] = [[[0,0]]];
presets['glider1'] = [];
const g1p1dr = [[1,0], [2,2], [2,1], [1,2], [0,2]];
const g1p2dr = [[0,0], [1,1], [2,1], [0,2], [1,2]];
const g1p1ur = [[0,0], [1,0], [1,1], [2,1], [0,2]];
const g1p2ur = [[0,0], [1,0], [2,0], [2,1], [1,2]];
const g1p1dl = [[1,0], [0,1], [0,2], [1,2], [2,2]];
const g1p2dl = [[2,0], [0,1], [1,1], [1,2], [2,2]];
const g1p1ul = [[0,0], [1,0], [2,0], [0,1], [1,2]];
const g1p2ul = [[0,1], [1,0], [1,1], [2,0], [2,2]];
for (let i=0; i<4; i++) {
  presets['glider1'].push([[ i*16+00, i*16], ...(Math.random() > .5 ? g1p1dr: g1p2dr)])
  presets['glider1'].push([[ i*16+32-8, i*16-8], ...(Math.random() > .5 ? g1p1ul: g1p2ul)])
  presets['glider1'].push([[-i*16+32-8, i*16], ...(Math.random() > .5 ? g1p1ur: g1p2ur)])
  presets['glider1'].push([[-i*16+8-8 , i*16-8], ...(Math.random() > .5 ? g1p1dl: g1p2dl)])
};

presets['glider2'] = [];
const g2p1 = [[1,1], [4,1], [5,2], [1,3], [5,3], [2,4], [3,4], [4,4], [5,4]];
const g2p2 = [[4,1], [2,2], [6,2], [7,3], [2,4], [7,4], [3,5], [4,5], [5,5], [6,5], [7,5]];
const g2p3 = [[4,1], [5,1], [2,2], [7,2], [8,3], [2,4], [8,4], [3,5], [4,5], [5,5], [6,5], [7,5], [8,5]];
for (let i=0; i<8; i++) {presets['glider2'].push([[i*8, 20+0], ...g2p1])};
for (let i=0; i<8; i++) {presets['glider2'].push([[i*8, 20+8], ...g2p2])};
for (let i=0; i<4; i++) {presets['glider2'].push([[i*16,20+16], ...g2p3])};

presets['gosper-gun'] = [[[1,1],[24,0],[22,1],[24,1],[12,2],[13,2],[20,2],[21,2],[34,2],[35,2],[11,3],[15,3],[20,3],[21,3],
  [21,3],[34,3],[35,3],[0,4],[1,4],[10,4],[16,4],[20,4],[21,4],[0,5],[1,5],[1,5],[10,5],[14,5],[16,5],[17,5],[22,5],[24,5],
  [10,6],[16,6],[24,6],[11,7],[15,7],[12,8],[13,8]], [[10,60],...e1ul]];

presets['simkin-gun'] = [[[14,24],[0,0],[1,0],[7,0],[8,0],[0,1],[1,1],[7,1],[8,1],[4,3],[5,3],[4,4],[5,4],[22,9],[23,9],
  [25,9],[26,9],[21,10],[27,10],[21,11],[28,11],[31,11],[32,11],[21,12],[22,12],[23,12],[27,12],[31,12],[32,12],[26,13]],
  [[54+20,60+20],...e1ul],[[7-24,0-24],...e1dr]]

presets['r-pentomino'] = [[[0,0],[1,1], [2,2], [3,2], [2,1], [2,0]]];
presets['diehard'] = [[[28,28], [7, 1], [1, 2], [2, 2], [2, 3], [6, 3], [7, 3], [8, 3]]];
presets['acorn'] = [[[28,28], [1,3], [2,3], [2,1], [4,2], [5,3], [6,3], [7,3]]];
presets['inf1'] = [[[28,28], [7,1], [5,2], [7,2], [8,2], [5,3], [7,3], [5,4], [3,5], [3,6], [1,6]]];
presets['inf2'] = [[[28,28], [1,1], [2,1], [3,1], [5,1], [1,2], [4,3], [5,3], [2,4], [3,4], [5,4], [1,5], [3,5], [5,5]]];
presets['86P6H3V0'] = [[[16,0],[5,0],[6,0],[7,0],[25,0],[26,0],[27,0],[4,1],[8,1],[12,1],[20,1],[24,1],[28,1],[3,2],[4,2],
  [9,2],[11,2],[12,2],[13,2],[19,2],[20,2],[21,2],[23,2],[28,2],[29,2],[2,3],[4,3],[6,3],[7,3],[9,3],[13,3],[14,3],[18,3],
  [19,3],[23,3],[25,3],[26,3],[28,3],[30,3],[1,4],[2,4],[4,4],[9,4],[11,4],[14,4],[15,4],[17,4],[18,4],[21,4],[23,4],
  [28,4],[30,4],[31,4],[0,5],[5,5],[9,5],[14,5],[18,5],[23,5],[27,5],[32,5],[14,6],[15,6],[16,6],[17,6],[18,6],[0,7],[1,7],
  [11,7],[12,7],[14,7],[18,7],[20,7],[21,7],[31,7],[32,7],[11,8],[14,8],[18,8],[21,8],[10,9],[14,9],[16,9],[18,9],[22,9],
  [11,10],[21,10]]];
presets['74P8H2V0'] = [[[24,0],[5,0],[7,0],[9,0],[4,1],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[4,2],[10,2],[5,3],[9,3],[5,4],
  [9,4],[3,5],[4,5],[10,5],[11,5],[5,6],[9,6],[2,7],[4,7],[6,7],[8,7],[10,7],[12,7],[4,8],[6,8],[8,8],[10,8],[1,9],[2,9],
  [4,9],[6,9],[8,9],[10,9],[12,9],[13,9],[1,10],[5,10],[6,10],[8,10],[9,10],[13,10],[0,12],[1,12],[5,12],[9,12],[13,12],
  [14,12],[5,13],[9,13],[6,14],[7,14],[8,14],[4,16],[9,16],[10,16],[3,17],[5,17],[8,17],[9,17],[6,18],[9,18],[11,18],[3,19],
  [6,19],[9,19],[11,19],[4,20],[6,20],[10,20]]];


// https://conwaylife.com/forums/viewtopic.php?&p=156408#p156408 p89
presets['hassler-unamed (>:3)'] = [[[12,12], ...parseRLE("14bo2$14b3o$14bo2bo$14bo2bo12bo$28b3o$17b2o8bo$18bo8b2o5b2o$34bo$" +
                                                         "25bo6bobo$26bo5b2o$24bo$23b2ob2o$14b3o3b2ob3o2bo$ob3o8bobo6b3o3bo" +
                                                         "$2bo10b2o8bob3o$2bo10bo10b3o$3b2obo$6b2o2$13bo$13bo11b2o$14bo11bo" +
                                                         "$12b4o7b3o$11b4obo6bo$9bo3bob2o4bobo$10bobo2b2o4b2o$6b2o4bo2bo$5b" +
                                                         "obo5b2o$5bo$4b2o2$9b2o$10bo$7b3o$7bo!")]]

function loadCoos(sim, arr) {
  let o = arr[0];
  for (let i=1; i<arr.length; i++) {
    sim.setCell(arr[i][0] + o[0], arr[i][1] + o[1], 1);
  };
};

function loadPreset(sim, kind) {
  sim.reset();
  for (let j=0; j<presets[kind].length; j++) {
    loadCoos(sim, presets[kind][j]);
  };
  if (states.running === 0) {
    sim.render(ctx, canvas.width, canvas.height);
  };
};


function appInit() {
  inputProxy = new cInputProxy();
  sim = new ParticleSim(64, 64);
  rules['B3/S23'](sim)
  inputProxy.register('clearSim').addEventListener('click', (e)=>{
    sim.reset()
  });
  inputProxy.register('stepSim').addEventListener('click', (e)=>{
    simStep()
    if (states.running === 1) {
      states.running = 0;
      inputProxy.target.pauseSim.value = 'resume';
    };
  });
  inputProxy.register('pauseSim').addEventListener('click', (e)=>{
    states.running ^= 1;
    if (states.running === 1) {
      e.target.value = 'pause';
      loop();
    } else {
      e.target.value = 'resume';
    };
  });
  inputProxy.register('presetSelect');
  while (inputProxy.target.presetSelect.firstChild) {
    inputProxy.target.presetSelect.removeChild(inputProxy.target.presetSelect.lastChild);
  };
  for (let k in presets) {
    if (k === 'placeholder') continue;
    let opt = document.createElement('option');
    opt.value = k;
    opt.innerHTML = k;
    inputProxy.target.presetSelect.append(opt);
  };
  inputProxy.register('rleOffsetX', 0, parseInt);
  inputProxy.register('rleOffsetY', 0, parseInt);
  inputProxy.register('rleInput');
  inputProxy.register('rleLoad').addEventListener('click', (e)=>{
    if (validateRLE(inputProxy.target.rleInput.value)) {
      sim.reset();
      loadCoos(sim, [[inputProxy.values.rleOffsetX,inputProxy.values.rleOffsetY],
                     ...parseRLE(inputProxy.target.rleInput.value)])
      sim.render(ctx, canvas.width, canvas.height);
    }
  });
  inputProxy.register('presetLoad').addEventListener('click', (e)=>{
    loadPreset(sim, inputProxy.values.presetSelect);
  });
  inputProxy.target.presetSelect.value = inputProxy.target.presetSelect.firstChild.value;
  inputProxy.values.presetSelect = inputProxy.target.presetSelect.firstChild.value;
  inputProxy.target.rleInput.value = "15bo$13b2o$13b2o$16bo$13b2obo$14bo$14bobo$15b2o$15bo$19bo$9b3o6b2o$10b2o5b3o$" +
                                     "11bo$3b2ob2o17bob2o$o6b2o14b3ob2o$b2ob3o14b2o6bo$b2obo17b2ob2o$18bo$10b3o5b2o" +
                                     "$10b2o6b3o$10bo$14bo$13b2o$13bobo$15bo$13bob2o$13bo$15b2o$15b2o$14bo!"

};



function simStep() {
  sim.update();
  sim.render(ctx, canvas.width, canvas.height);
};


let c = 0;
function loop() {
  c %= 2;
  if (c === 0) simStep();
  if (states.running === 1) {
    window.requestAnimationFrame(loop);
  };
  c += 1;
};

appInit()
loop()

};</script>




  </div>
  

  
  <br>
  <br>
  <br>
  <br>
  <p class="tc">Built with <a a target="_blank" class="extern" href="https://gohugo.io/">Hugo</a> | previoip (c) 2025</p>
</body>

</html>


